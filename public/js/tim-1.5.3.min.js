function timInitializeMap(e,t){null==e&&(e="");var n=document.getElementById("tim_googleMap"+e);if(null!==n&&"undefined"!=typeof google){var i=document.getElementById("timMapType"+e);if(null!==i)"waypoints"===i.value?timGoogleRouteWayPointsMap(n,t):"multiple"===i.value&&timLoadMultiLocationMap(n,t);else{var a=document.getElementById("tim_geoLat"+e).value,o=document.getElementById("tim_geoLng"+e).value,r=document.getElementById("tim_geoZoom"+e).value,m=new google.maps.LatLng(a,o),l={center:m,zoom:parseInt(r),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},d=new google.maps.Map(n,l);new google.maps.Marker({position:m}).setMap(d),google.maps.event.trigger(d,"resize")}}}function timGoogleRouteWayPointsMap(e,t){var n=new google.maps.DirectionsRenderer,i=new google.maps.DirectionsService,a={zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Map(e,a);n.setMap(o),calculateAndDisplayRoute(i,n,t)}function calculateAndDisplayRoute(e,n,t){var i={lat:t.departure.lat,lng:t.departure.lng},a={lat:t.arrival.lat,lng:t.arrival.lng},o=[];if(t.waypoints&&0<t.waypoints.length)for(var r=0;r<t.waypoints.length;r++){var m=t.waypoints[r],l=!!m.stop_on_route;o.push({location:new google.maps.LatLng(m.location.lat,m.location.lng),stopover:l})}e.route({origin:i,destination:a,waypoints:o,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING},function(e,t){"OK"===t?n.setDirections(e):window.alert("Directions request failed due to "+t)})}function timLoadMultiLocationMap(e,t){if(void 0!==navigator.geolocation){coords=timGroupLocations(t),new google.maps.LatLng;var n={mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(e,n),a=[];for(r=0;r<coords.length;r++)a.push(new google.maps.LatLng(coords[r].lat,coords[r].lng));for(var o=new google.maps.LatLngBounds,r=0;r<a.length;r++){o.extend(a[r]);var m=new google.maps.Marker({map:i,position:a[r]});if(0<coords[r].locations.length){for(var l="",d=0;d<coords[r].locations.length;d++)l+='<li title="Day '+coords[r].locations[d].day_number+" - "+coords[r].locations[d].name+'">'+coords[r].locations[d].day_number+"</li>";new google.maps.InfoWindow({content:'<div class="tim_map_labels"><ul>'+l+"</ul></div>"}).open(i,m)}}i.fitBounds(o);var c=!0,u="";if(1<t.length)for(r=0;r<t.length;r++){var s=t[r];if(s.lat&&u&&u!==s.lat){c=!1;break}u=s.lat}if(1===t.length||c)var p=google.maps.event.addListener(i,"idle",function(){8<i.getZoom()&&i.setZoom(8),google.maps.event.removeListener(p)})}else alert("Your browser doesnt support the Geolocation API")}function timGroupLocations(e){for(var t,n,i,a=[],o=[],r=e.length,m=0;m<r;m++)a[(t=e[m]).lat]||(a[t.lat]={lat:t.lat,lng:t.lng,locations:[]});for(var l in a)for(n=a[l].lat,m=0;m<r;m++)i={day_number:(t=e[m]).day_number,name:t.name},n===t.lat&&a[l].locations.push(i);for(var l in a)o.push(a[l]);var d=a[e[r-1].lat]={lat:e[r-1].lat,lng:e[r-1].lng,locations:[]};return o.push(d),o}function timAjaxContent(e,t){var n={action:"open_modal",f_nonce:timData.f_nonce,option:e,lang:document.getElementById("timCL").value};t&&(n.id=t),timPostAjax(timData.ajaxurl,n,function(e){openModal(e)})}function openModal(e,t){var n={content:e,type:"ajax",autoSize:!1,maxWidth:1100,maxHeight:800,width:"95%",afterShow:function(){timLoadModalSlider()}};t&&(t.preventCloseOutside&&(n.helpers={overlay:{closeClick:!1}}),t.hideCloseBtn&&(n.closeBtn=!1),t.autoSize&&(n.autoSize=!0)),jQuery.fancybox.open(n)}function timLoadModalSlider(){jQuery("div.tim_detail_slider_modal").length&&setTimeout(function(){new Swiper(".tim_detail_slider_modal",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}})},500)}function timLoadSwiper(){new Swiper(".tim-detail-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}}),new Swiper(".tim-rooms-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),new Swiper(".tim-carrousel-slider",{pagination:".swiper-pagination",nextButton:".swiper-button-next",prevButton:".swiper-button-prev",paginationClickable:!0,grabCursor:!1,spaceBetween:20,slidesPerView:3,breakpoints:{992:{slidesPerView:2,spaceBetween:20},768:{slidesPerView:1,spaceBetween:20},320:{slidesPerView:1,spaceBetween:10}},preloadImages:!1,lazy:!0})}function timTabContent(e,t,n){var i,a,o;for(a=document.getElementsByClassName("tim_tab_content"),i=0;i<a.length;i++)a[i].style.display="none";if(!n){for(o=document.getElementsByClassName("tablink"),i=0;i<a.length;i++)void 0!==o[i]&&(o[i].className=o[i].className.replace(" active",""));e.currentTarget.className+=" active"}document.getElementById(t).style.display="block","timTabMap"==t&&timInitializeMap("Tab")}function timToggleContent(e){var t=document.getElementById(e);"none"===t.style.display?t.style.display="block":t.style.display="none"}function timScrollTo(e){return document.getElementById(e).scrollIntoView({behavior:"smooth"}),!1}function timShowErrorLabelApi(e){var t=document.getElementById("timGuestEmail");t.classList.remove("tim_error_input"),t.classList.add("tim_error_input"),t.insertAdjacentHTML("afterend",'<div id="timGuestEmailErrorMsg" class="tim_error_input_msg">'+e+"</div>"),t.focus()}function timLoadData(e,t){var n={action:e,f_nonce:timData.f_nonce,lang:t||document.getElementById("timCL").value},i=document.getElementById("timLoadDataResult");timPostAjax(timData.ajaxurl,n,function(e){i.innerHTML=e})}function timCheckLoginForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value,n=document.getElementById("timCustomerPassword").value;if(e=validateEmail("timCustomerEmail",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var i={action:"create_client_login_api",f_nonce:timData.f_nonce,email:t,password:n,lang:document.getElementById("timCL").value},a=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,i,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),a.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>"):location.reload(),timHideSpinner("tim_spinner")})}function timLogout(){var e={action:"client_logout",f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,e,function(e){location.reload()})}function timCheckSignupForm(){setButton();var e=0,t=document.getElementById("timCustomerName").value,n=document.getElementById("timCustomerLastName").value,i=document.getElementById("timCustomerEmail").value,a=document.getElementById("timCustomerPhoneNumber").value,o=document.getElementById("timCustomerPhoneCode").value,r=document.getElementById("timCustomerCountry").value,m=document.getElementById("timGuestTaxIdCode").value,l=document.getElementById("timGuestTaxIdNumber").value,d=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timGuestTaxIdCode",e),e=validateInput("timGuestTaxIdNumber",e),e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var c=r.split("-")[0],u={action:"create_client_signup_api",f_nonce:timData.f_nonce,name:t,last_name:n,tax_id_code:m,tax_id_number:l,email:i,phone_number:a,phone_code:o,country_id:c,password:d,lang:document.getElementById("timCL").value},s=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,u,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors)t=e.errors[n].join(", ");s.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else location.reload();timHideSpinner("tim_spinner")})}function timSelectCountry(e,t){var n=document.getElementById("tim"+[t]+"PhoneNumber"),i=document.getElementById("tim"+[t]+"PhoneCode");n.value="",i.value="",n.disabled=!e;var a=e.split("-")[1];i.value=a,jQuery("#tim"+[t]+"PhoneNumber").inputmask({mask:"("+i.value+") 9{0,20}",autoUnmask:!0,removeMaskOnSubmit:!0,greedy:!1})}function timCheckPasswordRecoveryForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value;if(e=validateEmail("timCustomerEmail",e))return setButton(1),!1;var n={action:"create_client_password_api",f_nonce:timData.f_nonce,email:t,lang:document.getElementById("timCL").value},i=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),i.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />"):(timLoadData("load_edit_password_form"),document.getElementById("timClientEmail").value=e.email),timHideSpinner("tim_spinner")})}function timCheckUpdatePassword(){setButton();var e=0,t=document.getElementById("timCustomerCode").value,n=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timCustomerCode",e))return setButton(1),!1;var i=document.getElementById("timClientEmail").value,a={action:"update_client_password_api",f_nonce:timData.f_nonce,email:i,code:t,password:n,lang:document.getElementById("timCL").value},o=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,a,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors)setButton(1),o.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>";else{timLoadData("load_login_form");var t=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_success">'+t+".</div><br />"}timHideSpinner("tim_spinner")})}function timCheckUpdateClientProfile(){setButton();var e=0,t=document.getElementById("timCustomerId").value,n=document.getElementById("timCustomerName").value,i=document.getElementById("timCustomerLastName").value,a=document.getElementById("timCustomerEmail").value,o=document.getElementById("timCustomerPhoneNumber").value,r=document.getElementById("timCustomerPhoneCode").value,m=document.getElementById("timCustomerCountry").value;if(e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var l=m.split("-")[0],d={action:"update_client_profile_api",f_nonce:timData.f_nonce,id:t,name:n,last_name:i,email:a,phone_number:o,phone_code:r,country_id:l,lang:document.getElementById("timCL").value},c=document.getElementById("timClientProfileFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,d,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors)t=e.errors[n].join(", ");c.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var i=document.getElementById("timLabelProfileUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+i+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timCloseAlert(e){document.getElementById(e).innerHTML=""}function timCheckUpdateClientPassword(){setButton();var e=0,t=document.getElementById("timCustomerId").value,n=document.getElementById("timCustomerPassword").value;if(document.getElementById("timCustomerPasswordConfirmation").value,e=validateInput("timCustomerPasswordConfirmation",e),e=validatePasswordConfirmation("timCustomerPassword","timCustomerPasswordConfirmation",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var i={action:"update_client_profile_password_api",f_nonce:timData.f_nonce,id:t,password:n,lang:document.getElementById("timCL").value},a=document.getElementById("timClientPasswordFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,i,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors)t=e.errors[n].join(", ");a.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var i=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+i+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timCustomerPassword").value="",document.getElementById("timCustomerPasswordConfirmation").value="",timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timProcessSecondaryPriceList(e){var t={action:"accept_secondary_price_list",option:e,f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,t,function(){location.reload()})}function validateInput(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var i=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")}t=1}return t}function validateEmail(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var i=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")}t=1}else/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(n.value)||(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(i=document.getElementById(e+"Invalid").value,n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")),t=1);return t}function validatePhone(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var i=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")}t=1}else/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(n.value)||(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(i=document.getElementById(e+"Invalid").value,n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")),t=1);return t}function validateTaxIdNumber(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var i=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")}t=1}else{var a;switch(document.getElementById("timGuestTaxIdCode").value){case"01":a=9;break;case"02":case"03":case"04":a=10;break;case"06":a=9}n.value.length<a&&(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(i=document.getElementById(e+"Invalid").value,n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+i+"</div>")),t=1)}return t}function validatePasswordConfirmation(e,t,n){var i=document.getElementById(e),a=getElementById(t),o=document.getElementById("timClientPasswordFormErrorMsg");if((o.innerHTML="")!=i.value&&""!=a.value&&i.value!=a.value){if(i.className="tim_error_input",a.className="tim_error_input",document.getElementById(id+"Error")){var r=getElementById(id+"Error").value;o.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+r+"</div>"}n=1}return n}function setButton(e){if(void 0!==document.getElementsByClassName("timSendButton")[0]){var t=!e;document.getElementsByClassName("timSendButton")[0].disabled=t}}function timShowSpinner(e){document.getElementsByClassName(e)[0]&&(document.getElementsByClassName(e)[0].style.display="inline")}function timHideSpinner(e){document.getElementsByClassName(e)[0]&&(document.getElementsByClassName(e)[0].style.display="none")}function timRemoveItemFromArray(e,t,n){var i=timFindArrayIndex(e,t,n);return e.splice(i,1),e}function timFindItemInArray(e,t,n){for(var i=0;i<e.length;i++)if(e[i][t]===n)return e[i];return null}function timFindArrayIndex(e,t,n){for(var i=0;i<e.length;i++)if(e[i][t]===n)return i;return null}function setTimePicker(e,t){var n={timeSeparator:":"};t&&(n.now=t),jQuery("."+e).wickedpicker(n)}function timConvertTimeToDB(e){var t=e.split(" "),n=t[0].split(":"),i=n[0],a=n[1];if(i<10&&(i="0"+i),"PM"===t[1])switch(i){case"01":i="13";break;case"02":i="14";break;case"03":i="15";break;case"04":i="16";break;case"05":i="17";break;case"06":i="18";break;case"07":i="19";break;case"07":i="20";break;case"09":i="21";break;case"10":i="22";break;case"11":i="23";break;case"12":i="24"}return i+":"+a}function timParseDate(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])}function timGetDiffInDays(e,t){return Math.round((t-e)/864e5)}function increaseDate(e,t){var n=e.split("-"),i=new Date(parseInt(n[0],10),parseInt(n[1],10)-1,parseInt(n[2],10));return i.setDate(i.getDate()+1),n[0]=""+i.getFullYear(),n[1]=""+(i.getMonth()+1),n[1].length<2&&(n[1]="0"+n[1]),n[2]=""+i.getDate(),n[2].length<2&&(n[2]="0"+n[2]),n.join("-")}function getTodayDate(){var e=new Date,t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+"-"+n+"-"+t}function timFormatHour(e){var t=e,n=+t.substr(0,2),i=n<12?" AM":" PM";return(n%12||12)+t.substr(2,3)+i}function timFormatHour24(e){var t=e.split(":"),n=t[0];return t[1],value=(e="00:00"==e?"12:00":e)+" "+(n<"12"?"AM":"12"==n?"MD":"PM"),value}function timRoundNum(e,t){return e=isNaN(e)?0:e,t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)}function timOnlyNumbers(e){if(e.keyCode?code=e.keyCode:e.which&&(code=e.which),8==code||9==code||13==code)return!0;var t=String.fromCharCode(code);return"0"<=t&&t<="9"}function timCurrencyFormat(e,t){return t=t||2,e.toFixed(t).replace(/\.?0*$/g,"")}function timPostAjax(e,t,n){var i="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){3<a.readyState&&200==a.status&&n(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(i),a}function setTaxIdNumberMask(e){var t,n=jQuery("#timGuestTaxIdNumber");if(n.val(""),e){var i;switch(t=!1,e){case"01":i="9 9999 9999";break;case"02":i="9 999 999 999";break;case"03":i="999999999999"}n.inputmask({mask:i,autoUnmask:!0,removeMaskOnSubmit:!0})}else t=!0;n.prop("disabled",t)}function timAddItemToOrder(e){var t=document.getElementById("timUserCurrency").value,n=document.getElementById("departureTime");n&&(e.departure_time=timConvertTimeToDB(n.value)),document.getElementById("timProviderId")&&(e.provider_id=document.getElementById("timProviderId").value);var i={action:"add_item_to_order_api",f_nonce:timData.f_nonce,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:e};if(document.getElementById("timAvailabilityResult")){var a=document.getElementById("timAvailabilityResult");a.style.opacity=.5}timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,i,function(e){if("false"==e)return!1;timHideSpinner("tim_spinner"),document.getElementById("timAvailabilityResult")&&(a.style.opacity=1),window.location=document.getElementById("timHomeUrl").value+"checkout/"})}function timOpenEditItemFromOrder(e,t,n){var i={action:"open_modal",f_nonce:timData.f_nonce,option:"cart",id:e,type:t,pLId:n,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,i,function(e){openModal(e)})}function timUpdateItemFromOrder(e){var t={action:"update_item_from_order_api",f_nonce:timData.f_nonce,bookingItemData:e,lang:document.getElementById("timCL").value};jQuery.post(timData.ajaxurl,t,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,jQuery.fancybox.close(),timUpdateChekoutTotals()})}function timApplyPlacesToItemOrder(e){var t={booking_item_id:e},n=document.getElementById("timPickupPlaceId_"+e).value;n&&(t.pickup_place_id=n);var i=document.getElementById("timDropoffPlaceId_"+e).value;i&&(t.dropoff_place_id=i);var a={action:"apply_places_to_order_api",f_nonce:timData.f_nonce,bookingItemData:t,lang:document.getElementById("timCL").value};jQuery.post(timData.ajaxurl,a,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,timUpdateChekoutTotals();var t=document.getElementById("timPaymentGateway").value,n=document.getElementById("timBookingTotalAmount").value;switch(t){case"bac_ecommerce":case"bcr_ecommerce":document.getElementById("timPaymentGatewayAmount").value=n}})}function timRemoveItemFromOrder(e){var t={action:"remove_item_from_order_api",f_nonce:timData.f_nonce,bookingItemId:e,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,t,function(e){if("false"==e)return!1;var t=document.getElementById("timTotalBookingItems").value-1;1<t?(document.getElementById("timCartDetail").innerHTML=e,document.getElementById("timBTI").innerHTML=t,document.getElementById("timOTI")&&(document.getElementById("timOTI").innerHTML=t),timUpdateChekoutTotals()):(timShowSpinner("tim_spinner"),location.reload())})}function timUpdateChekoutTotals(){var e={action:"get_booking_totals_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,lang:document.getElementById("timCL").value};timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,e,function(e){document.getElementById("timCheckoutTotals").innerHTML=e;var t=document.getElementById("timValidCart").value,n=document.getElementById("paymentForm"),i=document.getElementById("paymentFormInvalid");t&&(n.style.display="block",i.style.display="none",document.getElementById("timGuestName").disabled=!1,document.getElementById("timGuestLastName").disabled=!1,document.getElementById("timGuestEmail").disabled=!1,document.getElementById("timGuestCountry").disabled=!1,document.getElementById("timNotes").disabled=!1),timHideSpinner("tim_spinner")})}function timSelectPickupPlace(e,t){var n=!0,i=!0;if("both"==e||"pickup"==e){var a=document.getElementById("timPickupPlaceId_"+t).value;a&&null!=a||(n=!1)}if("both"==e||"dropoff"==e){var o=document.getElementById("timDropoffPlaceId_"+t).value;o&&null!=o||(i=!1)}n&&i&&(document.getElementById("timPickupPlaceId_"+t).disabled=!0,document.getElementById("timDropoffPlaceId_"+t).disabled=!0,timApplyPlacesToItemOrder(t))}function timUnavailableProductDates(e){var t=document.getElementById("unavailableDates")?JSON.parse(document.getElementById("unavailableDates").value):[],n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();i<10&&(i="0"+i),a<10&&(a="0"+a);var o=n+"-"+i+"-"+a;return-1!=jQuery.inArray(o,t)?[!1,"disabled",""]:[!0,"",""]}function timProductDatePicker(n,e,t,i,a){jQuery.datepicker.setDefaults(jQuery.datepicker.regional[""+t]);var o=jQuery("#timFrom");if("hotel"===n)var r=jQuery("#timTo");var m,l="yy-mm-dd";if(o.datepicker({firstDay:1,minDate:0,numberOfMonths:e,altField:"#timFromDB",altFormat:l,onSelect:function(){if(_(),i||"hotel"===n){if(r){var e=o.datepicker("getDate"),t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);r.datepicker("option","minDate",t),setTimeout(function(){document.getElementById("timTo").focus()},10),document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}}else switch(n){case"tour":timCheckTourRates();break;case"transportation":timCheckTransportationRates()}}}).datepicker("widget").wrap('<div class="tim-datepicker"/>'),i){var d=(m=i.split("-"))[0],c=m[1]-1,u=m[2];o.datepicker("setDate",new Date(d,c,u))}else{var s=o.datepicker("getDate");s.setDate(s.getDate()+1),o.datepicker("setDate",s)}if("hotel"===n){var p=o.datepicker("getDate"),g=p?new Date(p.getFullYear(),p.getMonth(),p.getDate()+1):"+1D";r.datepicker({minDate:g,numberOfMonths:1,altField:"#timToDB",altFormat:l,onSelect:function(){document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}})}a&&(d=(m=a.split("-"))[0],c=m[1]-1,u=m[2],r.datepicker("setDate",new Date(d,c,u)));function _(){if(document.getElementById("timAvailabilityFor")){var e=timLabels.availabilityFor+": <b>"+o.val()+"</b>";document.getElementById("timAvailabilityFor").innerHTML=e}}"package"!==n&&_()}function timVerifyOrderForm(){setButton();var e=0,t=document.getElementById("timOrderId").value,n=document.getElementById("timCustomerEmail").value;if(e=validateInput("timOrderId",e=validateEmail("timCustomerEmail",e)))return setButton(1),!1;var i=document.getElementById("timCL").value,a={action:"verify_order_api",f_nonce:timData.f_nonce,bookingNumber:t,clientEmail:n,lang:document.getElementById("timCL").value},o=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,a,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).error)setButton(1),o.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+e.error+"</div>";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=view&oid="+e.id+"&onm="+e.booking_number+"&lng="+i}})}function timCheckTourRates(e){if(document.getElementById("timFromDB").value){var t=document.getElementById("timUserCurrency").value,n=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),i=(new Date).toISOString(),a=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_tour_rates_api",f_nonce:timData.f_nonce,currentUTCDate:i,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:{booking_type:"tour",start_date:document.getElementById("timFromDB").value,adults:parseInt(a),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),tour_id:document.getElementById("timTourId").value,tour_content_id:document.getElementById("timTourContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTourRatesEdit(e,l,n)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),document.getElementById("timTourDefaultPickupPlaceId")&&(l.bookingItemData.pickup_place_id=document.getElementById("timTourDefaultPickupPlaceId").value),document.getElementById("timTourDefaultDropoffPlaceId")&&(l.bookingItemData.dropoff_place_id=document.getElementById("timTourDefaultDropoffPlaceId").value),timCheckTourRatesAdd(l,n)),document.getElementById("timTourOptionsPrices")&&(document.getElementById("timTourOptionsPrices").style.display="block")}}function timCheckTourRatesAdd(H,O){var F=document.getElementById("timTourOptions");F.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,H,function(e){var t=timLabels,n="";if("false"==e)n='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),a=i.tour_options,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded;if(H.bookingItemData.exchange_rate_value=r.exchangeRateValue,H.spl_accepted&&(H.bookingItemData.spl_accepted=!0),H.bookingItemData.priceListIdByProvider=i.priceListIdByProvider,a){for(var l=H.bookingItemData.adults,d=H.bookingItemData.children,c=H.bookingItemData.infants,u=H.bookingItemData.seniors,s=l+d+c+u,p=!1,g=!1,_=(JSON.parse(document.getElementById("unavailableDates").value),document.getElementById("timFromDB"),[]),v=0;v<a.length;v++)if((I=a[v]).available_schedules=[],I.unavailable_schedules=[],_.push(I),0<I.schedules.length)for(var y=0;y<I.schedules.length;y++)(E=I.schedules[y]).is_available&&E.isCutOffValid?I.available_schedules.push(E):I.unavailable_schedules.push(E);for(v=0;v<_.length;v++){var I;if(0<(I=_[v]).available_schedules.length){var b="";for(y=0;y<I.available_schedules.length;y++){var f,E=I.available_schedules[y];H.bookingItemData.subtotal_price=0;var B=E.date_rates;H.bookingItemData.tour_option_id=I.id,H.bookingItemData.tour_option_schedule_id=E.id,H.bookingItemData.departure_time=E.departure,H.bookingItemData.quantity=s,H.bookingItemData.adult_price=0<l?applyExchangeRateConversion(B.adult_price,r):0,H.bookingItemData.child_price=0<d?applyExchangeRateConversion(B.child_price,r):0,H.bookingItemData.infant_price=0<c?applyExchangeRateConversion(B.infant_price,r):0,H.bookingItemData.senior_price=0<u?applyExchangeRateConversion(B.senior_price,r):0;var h=setDayPrice(B,"per_person",l,d,c,u,r),k=setBasePrice(h,m,o),D=k*(B.client_commission_percentage/100),x=k-D,C=0+x,T=getProductTaxesTotalPercentage(o),P=getProductTaxesTotalExonerationPercentage(o),L=T-P;H.bookingItemData.sale_taxes=setProductTaxesAmounts(C,o);var R=getProductTaxesTotalAmount(H.bookingItemData.sale_taxes),w=getProductTaxesTotalExonerationAmount(H.bookingItemData.sale_taxes),S=R-w,N=C+S;H.bookingItemData.item_price=timRoundNum(h),H.bookingItemData.base_price=timRoundNum(k),H.bookingItemData.commission_price_percentage=B.client_commission_percentage,H.bookingItemData.commission_price=timRoundNum(D),H.bookingItemData.net_price=timRoundNum(x),H.bookingItemData.pickup_price=0,H.bookingItemData.dropoff_price=0,H.bookingItemData.discount_price=timRoundNum(0),H.bookingItemData.subtotal_price=timRoundNum(C),H.bookingItemData.tax_price_percentage=T,H.bookingItemData.tax_price=timRoundNum(R),H.bookingItemData.tax_exoneration_price_percentage=P,H.bookingItemData.tax_exoneration_price=timRoundNum(w),H.bookingItemData.net_tax_price_percentage=L,H.bookingItemData.net_tax_price=timRoundNum(S),H.bookingItemData.total_price=timRoundNum(N);var A=m?H.bookingItemData.total_price:H.bookingItemData.subtotal_price;E.is_available&&E.isCutOffValid&&0<A?(f=s>=E.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(H.bookingItemData)+")'>"+t.book+"</a>":'<br /><span class="tim_error_input_msg"><b>'+t.errorMinPaxRequired+": "+E.min_pax_required+"</b></span>",p=!0):f='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",B.day&&(g=!0);var M=0<A?O+timCurrencyFormat(A):"-",j=t.hours;b+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+t.departure+"</span>"+timFormatHour(E.departure)+'</div><div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+E.duration+" <small>"+j+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+M+'</div><div class="tim-book">'+f+"</div></div>"}n+='<div class="tim-options-wrapper"><div class="tim-option-title">'+I.name+'</div><div class="tim-option-body">'+b+"</div></div>"}if(0<I.unavailable_schedules.length){for(b="",y=0;y<I.unavailable_schedules.length;y++)E=I.unavailable_schedules[y],f='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",M="-",j=t.hours,b+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+t.departure+"</span>"+timFormatHour(E.departure)+'</div><div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+E.duration+" <small>"+j+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+M+'</div><div class="tim-book">'+f+"</div></div>";n+='<div class="tim-options-wrapper"><div class="tim-option-title">'+I.name+'</div><div class="tim-option-body">'+b+"</div></div>"}}p||g||(n='<div style="text-align:center;"><b>'+t.errorNotOptionsAvailable+"</b></div>")}else n='<div style="text-align:center;"><b>No rates found</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTourOptions").innerHTML=n,F.style.opacity=1})}function timCheckTourRatesEdit(e,w,S){var t=document.getElementById("timPickupPlaceId"),n=t.value;if(t.classList.remove("tim_error_input"),!n||null==n)return t.classList.add("tim_error_input"),t.focus(),!1;var i=document.getElementById("timDropOffPlaceId"),a=i.value;if(i.classList.remove("tim_error_input"),!a||null==a)return i.classList.add("tim_error_input"),i.focus(),!1;var o=document.forms.tim_update_cart.elements.schedule.value.split("-"),r=o[0],m=o[1],l=o[2];w.bookingItemData.booking_item_id=e,w.bookingItemData.tour_option_id=r,w.bookingItemData.tour_option_schedule_id=m,w.bookingItemData.departure_time=l,w.bookingItemData.pickup_place_id=n,w.bookingItemData.dropoff_place_id=a;var N=document.getElementById("timAvailabilityResult");N.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,w,function(e){if("false"==e)return!1;var t=timLabels,n=JSON.parse(e);if(n.error){var i='<br /><div class="tim_alert tim_alert_danger"><b>'+n.error+"</b></div>";N.innerHTML=i}else{var a=n.tour_options,o=n.saleTaxes,r=n.documentDateExchangeRate,m=n.taxesIncluded,l=n.booking,d=a.date_rates,c=w.bookingItemData.adults,u=w.bookingItemData.children,s=w.bookingItemData.infants,p=w.bookingItemData.seniors;w.bookingItemData.adult_price=0<c?applyExchangeRateConversion(d.adult_price,r):0,w.bookingItemData.child_price=0<u?applyExchangeRateConversion(d.child_price,r):0,w.bookingItemData.infant_price=0<s?applyExchangeRateConversion(d.infant_price,r):0,w.bookingItemData.senior_price=0<p?applyExchangeRateConversion(d.senior_price,r):0;var g=setDayPrice(d,"per_person",c,u,s,p,r),_=setBasePrice(g,m,o),v=_*(d.client_commission_percentage/100),y=_-v,I=applyExchangeRateConversion(a.pickup_price,r),b=applyExchangeRateConversion(a.dropoff_price,r),f=0,E=y+I+b-f,B=getProductTaxesTotalPercentage(o),h=getProductTaxesTotalExonerationPercentage(o),k=B-h;l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?E-=f=E*(l.discount_coupon.value/100):E=(g+I+b-(f=applyExchangeRateConversion(l.discount_coupon.value,r)))/(k/100+1)),w.bookingItemData.sale_taxes=setProductTaxesAmounts(E,o);var D=getProductTaxesTotalAmount(w.bookingItemData.sale_taxes),x=getProductTaxesTotalExonerationAmount(w.bookingItemData.sale_taxes),C=D-x,T=E+C;w.bookingItemData.item_price=timRoundNum(g),w.bookingItemData.base_price=timRoundNum(_),w.bookingItemData.commission_price_percentage=d.client_commission_percentage,w.bookingItemData.commission_price=timRoundNum(v),w.bookingItemData.net_price=timRoundNum(y),w.bookingItemData.pickup_price=I,w.bookingItemData.dropoff_price=b,w.bookingItemData.discount_price=timRoundNum(f),w.bookingItemData.subtotal_price=timRoundNum(E),w.bookingItemData.tax_price_percentage=B,w.bookingItemData.tax_price=timRoundNum(D),w.bookingItemData.tax_exoneration_price_percentage=h,w.bookingItemData.tax_exoneration_price=timRoundNum(x),w.bookingItemData.net_tax_price_percentage=k,w.bookingItemData.net_tax_price=timRoundNum(C),w.bookingItemData.total_price=timRoundNum(T);var P=m?w.bookingItemData.total_price:w.bookingItemData.subtotal_price,L=w.bookingItemData.pickup_price+w.bookingItemData.dropoff_price,R='<div class="tim_align_right" style="font-size:14px;">';L&&(R=m?"<br />"+R+"(+) "+t.transportation+"<br />":"<br />"+R+"<hr />"+t.subtotal+": <b>"+S+w.bookingItemData.net_price+"</b><br /><small>(+) "+t.transportation+":</small> "+S+L+"<br />"),R=R+"<br /><hr /><b>"+t.totalPrice+": "+S+timCurrencyFormat(P)+"</b><br /><br /><button type='button' class='tim-btn tim-btn-lg' onclick='timUpdateItemFromOrder("+JSON.stringify(w.bookingItemData)+")'>"+t.updateOrder+"</button></div>",N.innerHTML=R}timHideSpinner("tim_spinner")})}function timCheckTransportationRates(e){if(document.getElementById("timFromDB").value){var t=document.getElementById("timUserCurrency").value,n=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),i=(new Date).toISOString(),a=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_transportation_rates_api",f_nonce:timData.f_nonce,currentUTCDate:i,lang:document.getElementById("timCL").value,currency_id:t,scheduleType:document.getElementById("timTransportationScheduleType").value,bookingItemData:{booking_type:"transportation",start_date:document.getElementById("timFromDB").value,adults:parseInt(a),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),transportation_id:document.getElementById("timTransportationId").value,transportation_content_id:document.getElementById("timTransportationContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTransportationRatesEdit(e,l,n)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),timCheckTransportationRatesAdd(l,n)),document.getElementById("timTransportationOptionsPrices")&&(document.getElementById("timTransportationOptionsPrices").style.display="block")}}function timCheckTransportationRatesAdd(O,F){var G=document.getElementById("timAvailabilityResult");G.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,O,function(e){var t=timLabels,n="";if("false"==e)n='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),a=i.transportation_schedules,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded;O.bookingItemData.exchange_rate_value=r.exchangeRateValue,O.spl_accepted&&(O.bookingItemData.spl_accepted=!0),O.bookingItemData.priceListIdByProvider=i.priceListIdByProvider;var l=!0,d=t.departure;if("open"===O.scheduleType&&(l=!1,d=t.selectTime),a){var c,u=O.bookingItemData.adults,s=O.bookingItemData.children,p=O.bookingItemData.infants,g=O.bookingItemData.seniors,_=u+s+p+g,v=!1,y=!1,I=(JSON.parse(document.getElementById("unavailableDates").value),document.getElementById("timFromDB"),"");if(0<a.length)for(var b=0;b<a.length;b++){var f,E=a[b],B="";O.bookingItemData.subtotal_price=0;var h=E.date_rates;O.bookingItemData.transportation_schedule_id=E.id,O.bookingItemData.departure_time=E.departure,O.bookingItemData.quantity=1,c="per_service","fixed"===O.scheduleType&&(O.bookingItemData.quantity=_,c="per_person",O.bookingItemData.adult_price=0<u?applyExchangeRateConversion(h.adult_price,r):0,O.bookingItemData.child_price=0<s?applyExchangeRateConversion(h.child_price,r):0,O.bookingItemData.infant_price=0<p?applyExchangeRateConversion(h.infant_price,r):0,O.bookingItemData.senior_price=0<g?applyExchangeRateConversion(h.senior_price,r):0);var k=setDayPrice(h,c,u,s,p,g,r),D=setBasePrice(k,m,o),x=D*(h.client_commission_percentage/100),C=D-x,T=0+C,P=getProductTaxesTotalPercentage(o),L=getProductTaxesTotalExonerationPercentage(o),R=P-L;O.bookingItemData.sale_taxes=setProductTaxesAmounts(T,o);var w=getProductTaxesTotalAmount(O.bookingItemData.sale_taxes),S=getProductTaxesTotalExonerationAmount(O.bookingItemData.sale_taxes),N=w-S,A=T+N;O.bookingItemData.item_price=timRoundNum(k),O.bookingItemData.base_price=timRoundNum(D),O.bookingItemData.commission_price_percentage=h.client_commission_percentage,O.bookingItemData.commission_price=timRoundNum(x),O.bookingItemData.net_price=timRoundNum(C),O.bookingItemData.pickup_price=0,O.bookingItemData.dropoff_price=0,O.bookingItemData.discount_price=timRoundNum(0),O.bookingItemData.subtotal_price=timRoundNum(T),O.bookingItemData.tax_price_percentage=P,O.bookingItemData.tax_price=timRoundNum(w),O.bookingItemData.tax_exoneration_price_percentage=L,O.bookingItemData.tax_exoneration_price=timRoundNum(S),O.bookingItemData.net_tax_price_percentage=R,O.bookingItemData.net_tax_price=timRoundNum(N),O.bookingItemData.total_price=timRoundNum(A);var M=m?O.bookingItemData.total_price:O.bookingItemData.subtotal_price;E.is_available&&E.isCutOffValid&&0<M?(f=_>=E.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(O.bookingItemData)+")'>"+t.book+"</a>":'<span class="tim_error_input_msg"><b>'+t.errorMinPaxRequired+": "+E.min_pax_required+"</b></span>",v=!0):(f='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",B=" tim_text_disabled"),h.day&&(y=!0),I+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+d+"</span>",I+=l?timFormatHour(E.departure):B?"-":'<input type="text" id="departureTime" name="departureTime" class="timepicker" />',I+="</div>";var j=t.hours,H=0<M?F+timCurrencyFormat(M):"-";I+='<div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+E.duration+" <small>"+j+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+H+'</div><div class="tim-book">'+f+"</div>",I+="</div>"}else I+='<div class="tim-option-content"><b>* '+t.errorSelectEarlierDate+"</b></div>";n+='<div class="tim-options-wrapper"><div class="tim-option-body">'+I+"</div></div>",v||y||(n='<div style="text-align:center;"><b>'+t.errorNotOptionsAvailable+"</b></div>")}else n='<div style="text-align:center;"><b>No rates found.</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTransportationSchedules").innerHTML=n,l||setTimePicker("timepicker"),G.style.opacity=1})}function timCheckTransportationRatesEdit(e,N,A){var t=document.getElementById("timPickupPlaceId"),n=t.value;if(t.classList.remove("tim_error_input"),!n||null==n)return t.classList.add("tim_error_input"),t.focus(),!1;var i=document.getElementById("timDropOffPlaceId"),a=i.value;if(i.classList.remove("tim_error_input"),!a||null==a)return i.classList.add("tim_error_input"),i.focus(),!1;var o,r,m=document.forms.tim_update_cart;if(r=document.getElementById("departureTime").value)o=document.getElementById("timScheduleId").value,r=timConvertTimeToDB(r);else{var l=m.elements.schedule.value.split("-");o=l[0],r=l[1]}N.bookingItemData.booking_item_id=e,N.bookingItemData.transportation_schedule_id=o,N.bookingItemData.departure_time=r,N.bookingItemData.pickup_place_id=n,N.bookingItemData.dropoff_place_id=a;var M=document.getElementById("timAvailabilityResult");M.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,N,function(e){if("false"==e)return!1;var t=timLabels,n=JSON.parse(e);if(n.error){var i='<br /><div class="tim_alert tim_alert_danger"><b>'+e.error+"</b></div>";M.innerHTML=i}else{var a=n.transportation_schedules,o=n.saleTaxes,r=n.documentDateExchangeRate,m=n.taxesIncluded,l=n.booking,d=a.date_rates,c=N.bookingItemData.adults,u=N.bookingItemData.children,s=N.bookingItemData.infants,p=N.bookingItemData.seniors,g=c+u+s+p;N.bookingItemData.quantity=1;var _="per_service";"fixed"===N.scheduleType&&(N.bookingItemData.quantity=g,_="per_person",N.bookingItemData.adult_price=0<c?applyExchangeRateConversion(d.adult_price,r):0,N.bookingItemData.child_price=0<u?applyExchangeRateConversion(d.child_price,r):0,N.bookingItemData.infant_price=0<s?applyExchangeRateConversion(d.infant_price,r):0,N.bookingItemData.senior_price=0<p?applyExchangeRateConversion(d.senior_price,r):0);var v=setDayPrice(d,_,c,u,s,p,r),y=setBasePrice(v,m,o),I=y*(d.client_commission_percentage/100),b=y-I,f=applyExchangeRateConversion(a.pickup_price,r),E=applyExchangeRateConversion(a.dropoff_price,r),B=0,h=b+f+E-B,k=getProductTaxesTotalPercentage(o),D=getProductTaxesTotalExonerationPercentage(o),x=k-D;l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?h-=B=h*(l.discount_coupon.value/100):h=(v+f+E-(B=applyExchangeRateConversion(l.discount_coupon.value,r)))/(x/100+1)),N.bookingItemData.sale_taxes=setProductTaxesAmounts(h,o);var C=getProductTaxesTotalAmount(N.bookingItemData.sale_taxes),T=getProductTaxesTotalExonerationAmount(N.bookingItemData.sale_taxes),P=C-T,L=h+P;N.bookingItemData.item_price=timRoundNum(v),N.bookingItemData.base_price=timRoundNum(y),N.bookingItemData.commission_price_percentage=d.client_commission_percentage,N.bookingItemData.commission_price=timRoundNum(I),N.bookingItemData.net_price=timRoundNum(b),N.bookingItemData.pickup_price=f,N.bookingItemData.dropoff_price=E,N.bookingItemData.discount_price=timRoundNum(B),N.bookingItemData.subtotal_price=timRoundNum(h),N.bookingItemData.tax_price_percentage=k,N.bookingItemData.tax_price=timRoundNum(C),N.bookingItemData.tax_exoneration_price_percentage=D,N.bookingItemData.tax_exoneration_price=timRoundNum(T),N.bookingItemData.net_tax_price_percentage=x,N.bookingItemData.net_tax_price=timRoundNum(P),N.bookingItemData.total_price=timRoundNum(L);var R=m?N.bookingItemData.total_price:N.bookingItemData.subtotal_price,w=N.bookingItemData.pickup_price+N.bookingItemData.dropoff_price,S='<div class="tim_align_right" style="font-size:14px;">';w&&(S=m?"<br />"+S+"(+) "+t.transportation+"<br />":"<br />"+S+"<hr />"+t.subtotal+": <b>"+A+N.bookingItemData.net_price+"</b><br /><small>(+) "+t.transportation+":</small> "+A+w+"<br />"),S=S+"<br /><hr /><b>"+t.totalPrice+": "+A+timCurrencyFormat(R)+"</b><br /><br /><button type='button' class='tim-btn tim-btn-lg' onclick='timUpdateItemFromOrder("+JSON.stringify(N.bookingItemData)+")'>"+t.updateOrder+"</button></div>",M.innerHTML=S}timHideSpinner("tim_spinner")})}function timSearchTransportation(){setButton();var e=0;if(e=validateInput("timDepartureLocation",e),e=validateInput("timArrivalLocation",e),e=validateInput("timFrom",e),e=validateInput("timDepartureTime",e))return setButton(1),!1;var t=document.getElementById("timUserCurrency").value,P=document.getElementById("timUserCurrencySymbol").value,n=(new Date).toISOString(),o=document.getElementById("timFromDB").value,L=parseInt(document.getElementById("timAdults").value),R=parseInt(document.getElementById("timChildren").value),w=parseInt(document.getElementById("timInfants").value),i={action:"search_transportations_rates_api",f_nonce:timData.f_nonce,currentUTCDate:n,lang:document.getElementById("timCL").value,currency_id:t,departureLocationId:document.getElementById("timDepartureLocation").value,arrivalLocationId:document.getElementById("timArrivalLocation").value,start_date:o,departure_time:document.getElementById("timDepartureTime").value,adults:L,children:R,infants:w};timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,i,function(e){timHideSpinner("tim_spinner"),setButton(1);var h=timLabels,t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var n=JSON.parse(e),i=n.transportations,k=n.documentDateExchangeRate,D=n.taxesIncluded,x={booking_type:"transportation",start_date:o,adults:L,children:R,infants:w,seniors:0,exchange_rate_value:k.exchangeRateValue},a="";if(0<i.length){var C,T=L+R+w+0;i.forEach(function(e){x.transportation_id=e.transportation_id,x.transportation_content_id=e.transportation_content_id,x.provider_id=e.provider_id,x.priceListIdByProvider=e.priceListIdByProvider;var v,y,I,b,f=e.saleTaxes,E=e.schedule_type,B="";e.transportation_schedules.forEach(function(e){if(x.subtotal_price=0,e.is_available&&e.isCutOffValid){b=e.date_rates,x.transportation_schedule_id=e.id,x.departure_time=e.departure,x.quantity=1,C="per_service","fixed"===E&&(x.quantity=T,C="per_person",x.adult_price=0<L?applyExchangeRateConversion(b.adult_price,k):0,x.child_price=0<R?applyExchangeRateConversion(b.child_price,k):0,x.infant_price=0<w?applyExchangeRateConversion(b.infant_price,k):0,x.senior_price=0);var t=setDayPrice(b,C,L,R,w,0,k),n=setBasePrice(t,D,f),i=n*(b.client_commission_percentage/100),a=n-i,o=0+a,r=getProductTaxesTotalPercentage(f),m=getProductTaxesTotalExonerationPercentage(f),l=r-m;x.sale_taxes=setProductTaxesAmounts(o,f);var d=getProductTaxesTotalAmount(x.sale_taxes),c=getProductTaxesTotalExonerationAmount(x.sale_taxes),u=d-c,s=o+u;x.item_price=timRoundNum(t),x.base_price=timRoundNum(n),x.commission_price_percentage=b.client_commission_percentage,x.commission_price=timRoundNum(i),x.net_price=timRoundNum(a),x.pickup_price=0,x.dropoff_price=0,x.discount_price=timRoundNum(0),x.subtotal_price=timRoundNum(o),x.tax_price_percentage=r,x.tax_price=timRoundNum(d),x.tax_exoneration_price_percentage=m,x.tax_exoneration_price=timRoundNum(c),x.net_tax_price_percentage=l,x.net_tax_price=timRoundNum(u),x.total_price=timRoundNum(s);var p=D?x.total_price:x.subtotal_price;y=T>=e.min_pax_required?"<a href='javascript:void(0)' class='tim-btn' onclick='timAddItemToOrder("+JSON.stringify(x)+")'>"+h.book+"</a>":'<span class="tim_error_input_msg"><b>'+h.errorMinPaxRequired+": "+e.min_pax_required+"</b></span>"}else y='<br /><span class="tim_label tim_label_md tim_label_danger">'+h.errorNotAvailable+"</span>";v="fixed"===E?h.fixed:h.open,I="fixed"===E?timFormatHour(e.departure):document.getElementById("timDepartureTime").value;var g=h.hours,_=0<p?P+timCurrencyFormat(p):"-";B+='<tr><td class="tim_align_center">'+v+'</td><td class="tim_align_center">'+e.duration+" <small>"+g+'</small></td><td class="tim_align_center">'+I+'</td><td class="tim_align_center"><b>'+_+'</b></td><td class="tim_align_center">'+y+"</td>"}),a+='<h3 class="tim_align_center">'+e.transportation_content_name+'</h3><table class="tim_table tim_table_no_border"><thead><tr><th class="tim_align_center">'+h.scheduleType+'</th><th class="tim_align_center">'+h.duration+'</th><th class="tim_align_center">'+h.pickupTime+'</th><th class="tim_align_center" style="width: 100px;">'+h.price+'</th><th class="tim_align_center" style="width: 210px;"></th></tr></thead><tbody>'+B+"</tbody></table><br />"})}else a='<div style="text-align:center;"><b>No rates found.</b></div>';t+=a}document.getElementById("timTransportations").innerHTML=t})}function timSelectTransportationDeparture(t){document.getElementById("timDepartureLocation");var e=document.getElementById("timArrivalLocation"),n=timFromLocations.filter(function(e){return e.id!==t}),i='<option value="">-- '+timLabels.select+" --</option>";""!==t?(e.disabled=!1,0<(n=timFromLocations.filter(function(e){return e.departure_location_id===t})).length?n.forEach(function(e){i+='<option value="'+e.id+'">'+e.name+"</option>"}):i+='<option value="">'+timLabels.errorNotAvailable+"</option>"):e.disabled=!0,e.innerHTML=i}var timRoomsSelected;function timCheckHotelAvailability(){var e=0;e=validateInput("timTo",e),e=validateInput("timFrom",e);var t=getTodayDate(),n=document.getElementById("timFromDB").value,i=document.getElementById("timToDB").value;if(n&&(n<t||i<=n))alert("Invalid date");else{if(e)return!1;var D=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",a=document.getElementById("timUserCurrency").value,x=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),o=(new Date).toISOString(),C={action:"check_hotel_availability_api",f_nonce:timData.f_nonce,currentUTCDate:o,lang:document.getElementById("timCL").value,currency_id:a,bookingItemData:{booking_type:"hotel",start_date:n,end_date:i,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value}};if(D){var T=timBookedRooms;C.booking_id=document.getElementById("timBookingId").value,C.price_list_id=document.getElementById("timBookingPriceListId").value,C.bookingItemData.booking_item_id=D}else document.getElementById("timSPLAccepted")&&(C.spl_accepted=document.getElementById("timSPLAccepted").value);var P=timLabels,L=document.getElementById("timAvailabilityResult");L.style.opacity=.5,document.getElementById("timAvailabilityResultMsg").style.display="none",timShowSpinner("tim_travel_form_spinner"),jQuery.post(timData.ajaxurl,C,function(e){var t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var n=JSON.parse(e),i=n.hotel_rooms,a={saleTaxes:n.saleTaxes,documentDateExchangeRate:n.documentDateExchangeRate,taxesIncluded:n.taxesIncluded,priceListIdByProvider:n.priceListIdByProvider,booking:n.booking};C.spl_accepted&&(a.spl_accepted=!0),timRoomsSelected=[];for(var o,r,m,l,d,c,u,s,p,g,_="",v="",y="",I="",b="",f="",E=0;E<i.length;E++){if(r=(o=i[E]).id,m=o.min_availability,u="",p=2,g=s=0,D&&0<o.date_rates.length){for(var B=0;B<T.length;B++)if(T[B].id===r){var h=(u=T[B]).unitsPerRoom;s=u.unitsPerRoom,p=u.units[0].adults,g=u.units[0].children;break}m+=h}if((v="")!==o.logo.url&&null!==o.logo.url&&(v+='<img src="'+o.logo.url+'" alt="'+o.name+'" class="tim-table-product-image" />'),l=o.bed_configuration?" ("+o.bed_configuration+")":"",v+='<div class="tim_table_td_title">'+o.name+'</div><i class="fa fa-bed"></i> <b>'+o.occupancy_type.name+"</b>"+l+"<br />",o.wifi&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.wifi+"</span>"),o.not_smoking&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.notSmoking+"</span>"),y="",0<m&&(y=x+timCurrencyFormat(o.price_from)),m<5&&(y+='<div style="font-size: 11px; color: #f00;">',y+=0<m?P.only+" <b>"+m+"</b> "+P.left:P.notAvailable,y+="</div>"),I='<div class="tim_pax_selector">',I+="<label>"+P.rooms+"</label>",0<m+s){for(c=9<m?9:m,I+="<select id='timUnitsPerRoom_"+r+"'",I+=" onchange='timAddHotelRoomUnit("+JSON.stringify(o)+", "+JSON.stringify(u)+", true, "+JSON.stringify(a)+")' class='tim_select_highlighted'>",d=0;d<=c;d++)I+='<option value="'+d+'"'+(d===s?" selected":"")+">"+d+"</option>";I+="</select>"}else I+="-";if(I+="</div>",b='<div class="tim_pax_selector">',b+="<label>"+P.adults+"</label>",0<m+s){for(b+="<select id='timAdults_"+r+"[0]' name='timAdults_"+r+"[0]' disabled",b+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(o)+", 0, "+JSON.stringify(a)+")'>",d=1;d<=o.max_occupancy;d++)b+='<option value="'+d+'"'+(d===p?" selected":"")+">"+d+"</option>";b+="</select>"}else b+="-";if(b+="</div>",f='<div class="tim_pax_selector">',f+="<label>"+P.children+"</label>",0<m+s&&2<o.max_occupancy&&o.children_allowed){for(f+="<select id='timChildren_"+r+"[0]' name='timChildren_"+r+"[0]' disabled",f+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(a)+")'>",d=0;d<=o.max_children_occupancy;d++)f+='<option value="'+d+'"'+(d===g?" selected":"")+">"+d+"</option>";f+="</select>"}else f+="-";f+="</div>";var k="-";o.children_allowed&&(k='<div title="test"><i class="fa fa-child"></i> '+o.max_children_occupancy+"</div>"),_+='<tr class="tim_table_tr_align_top"><td>'+v+'</td><td data-th="'+P.priceFrom+'">'+y+'</td><td data-th="'+P.max+'"><i class="fa fa-user"></i> '+o.max_occupancy+k+'</td><td data-th="'+P.rooms+'"><div class="tim_room_selector_wrapper"><div class="tim_rooms_selector">'+I+'</div><div class="tim_paxes_selector"><div>'+b+f+'</div><div id="timAdditionalPaxContainer_'+r+'"></div></div></div></td></tr>'}t='<div class="tim_clr"><div class="tim_col_9"><table class="tim_table tim_table_no_border tim_table_align_top"><thead><tr><th>'+P.roomType+'</th><th style="width: 100px;" class="tim_align_center">'+P.priceFrom+'</th><th style="width: 60px;" class="tim_align_center">'+P.max+'</th><th style="width: 210px;" class="tim_align_center">'+P.rooms+"</th></tr></thead><tbody>"+_+'</tbody></table></div><div class="tim_col_3"><div class="tim-totals-box-wrapper"><div class="tim-totals-box-title">'+P.accommodations+'</div><div class="tim-totals-box"><div id="timTotalsBoxResult">'+P.enterOneRoom+"</div></div></div></div></div>"}if(timHideSpinner("tim_travel_form_spinner"),L.style.opacity=1,L.innerHTML=t,D&&0<o.date_rates.length){for(E=0;E<i.length;E++)for(r=(o=i[E]).id,B=0;B<T.length;B++)if(T[B].id===r){u=T[B],document.getElementById("timUnitsPerRoom_"+r).value=u.unitsPerRoom,timAddHotelRoomUnit(o,u,!1,a);break}calculateHotelRoomsTotalPrice(a)}})}}function timAddHotelRoomUnit(e,t,n,i){var a,o=e.id,r=parseInt(document.getElementById("timUnitsPerRoom_"+o).value),m="",l="",d="",c=(timLabels,!(0<r));if(document.querySelector('[name="timAdults_'+o+'[0]"]').disabled=c,document.querySelector('[name="timChildren_'+o+'[0]"]')&&(document.querySelector('[name="timChildren_'+o+'[0]"]').disabled=c),0===r)timRemoveItemFromArray(timRoomsSelected,"id",o);else{var u=timFindItemInArray(timRoomsSelected,"id",o);u?u.unitsPerRoom=r:(e.unitsPerRoom=r,timRoomsSelected.push(e))}if(1<r)for(var s,p,g=1;g<r;g++){for(s=t&&t.units[g]?t.units[g].adults:2,p=t&&t.units[g]?t.units[g].children:0,l='<div class="tim_pax_selector">',l+="<select id='timAdults_"+o+"["+g+"]' name='timAdults_"+o+"["+g+"]'",l+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(e)+", "+g+", "+JSON.stringify(i)+")'>",a=1;a<=e.max_occupancy;a++)l+='<option value="'+a+'"'+(a===s?" selected":"")+">"+a+"</option>";if(l+="</select>",l+="</div>",d='<div class="tim_pax_selector">',2<e.max_occupancy&&e.children_allowed){for(d+="<select id='timChildren_"+o+"["+g+"]' name='timChildren_"+o+"["+g+"]'",d+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(i)+")'>",a=0;a<=e.max_children_occupancy;a++)d+='<option value="'+a+'"'+(a===p?" selected":"")+">"+a+"</option>";d+="</select>"}else d+="<label>-</label>";m+="<div>"+l+(d+="</div>")+"</div>"}document.getElementById("timAdditionalPaxContainer_"+o).innerHTML=m,n&&calculateHotelRoomsTotalPrice(i)}function timCheckHotelRoomUnitPax(e,t,n){var i=e.id,a=document.querySelector('[name="timAdults_'+i+"["+t+']"]').value;if(2<e.max_occupancy&&e.children_allowed){var o=document.querySelector('[name="timChildren_'+i+"["+t+']"]'),r=parseInt(e.max_occupancy)-parseInt(a),m=r>e.max_children_occupancy?e.max_children_occupancy:r;if(0<m){for(var l=o.length;l<=m;l++){var d=new Option(l,l);o.add(d,void 0)}if(o.length-1>=m){for(l=o.length-1;m<l;l--)o.remove(l);o.value>m&&(o.value=0)}}else o.innerHTML='<option value="0" selected>0</option>'}calculateHotelRoomsTotalPrice(n)}function calculateHotelRoomsTotalPrice(e){for(var t,n,i,a,o,r,m,l=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",d=document.getElementById("timFromDB").value,c=document.getElementById("timToDB").value,u=(document.getElementById("timUserCurrency").value,document.getElementById("timUserCurrencyCode").value),s=document.getElementById("timUserCurrencySymbol").value,p=timGetDiffInDays(timParseDate(d),timParseDate(c)),g=totalPricePerRoom=0,_=0,v=0,y=0,I=0,b=0,f=!1,E=[],B="",h=0;h<timRoomsSelected.length;h++)if(o=timRoomsSelected[h],r=o.id,0<o.unitsPerRoom){for(g+=o.unitsPerRoom,m=0;m<o.unitsPerRoom;m++)a=m+1,n=parseInt(document.querySelector('[name="timAdults_'+r+"["+m+']"]').value)||0,i=document.querySelector('[name="timChildren_'+r+"["+m+']"]')?parseInt(document.querySelector('[name="timChildren_'+r+"["+m+']"]').value):0,_+=n,v+=i,o.date_rates.forEach(function(e){y=getRatePerRoomOccupancy(n,i,e,"price"),E.push({day:e.day,unit_number:a,adults:n,children:i,item_price:y,hotel_id:document.getElementById("timHotelId").value,hotel_room_id:r}),I+=y,b=e.client_commission_percentage});B+=o.name+" (x"+o.unitsPerRoom+")<br />"}var k=timLabels;if(0<g){var D={booking_type:"hotel",start_date:d,end_date:c,quantity:g,adults:_,children:v,infants:0,seniors:0,total_rooms:g,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value,booking_item_hotel_dates:E};e.spl_accepted&&(D.spl_accepted=!0);var x=e.saleTaxes,C=e.documentDateExchangeRate,T=e.taxesIncluded,P=e.booking,L=applyExchangeRateConversion(I,C),R=setBasePrice(L,T,x),w=R*(b/100),S=R-w,N=0,A=0+S-N,M=getProductTaxesTotalPercentage(x),j=getProductTaxesTotalExonerationPercentage(x),H=M-j;P&&P.discount_coupon_id&&("percentage"==P.discount_coupon.discount_type?A-=N=A*(P.discount_coupon.value/100):A=(L+0+0-(N=applyExchangeRateConversion(P.discount_coupon.value,C)))/(H/100+1)),D.sale_taxes=setProductTaxesAmounts(A,x);var O=getProductTaxesTotalAmount(D.sale_taxes),F=getProductTaxesTotalExonerationAmount(D.sale_taxes),G=O-F,U=A+G;D.item_price=timRoundNum(L),D.base_price=timRoundNum(R),D.commission_price_percentage=b,D.commission_price=timRoundNum(w),D.net_price=timRoundNum(S),D.pickup_price=0,D.dropoff_price=0,D.discount_price=timRoundNum(N),D.subtotal_price=timRoundNum(A),D.tax_price_percentage=M,D.tax_price=timRoundNum(O),D.tax_exoneration_price_percentage=j,D.tax_exoneration_price=timRoundNum(F),D.net_tax_price_percentage=H,D.net_tax_price=timRoundNum(G),D.total_price=timRoundNum(U);var q=T?D.total_price:D.subtotal_price;D.exchange_rate_value=C.exchangeRateValue,D.priceListIdByProvider=e.priceListIdByProvider;var J;J=l?(D.booking_item_id=l,"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timUpdateItemFromOrder("+JSON.stringify(D)+")' disabled>"+k.updateOrder+"</button>"):"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timAddItemToOrder("+JSON.stringify(D)+")' disabled>"+k.bookNow+"</button>",k=timLabels;var Q="";0<D.tax_price_percentage&&(Q+='<div style="tim-totals-price-note">+'+k.taxes.toLowerCase()+"</div>");var V="";v&&(V=" / <b>"+k.children+":</b> "+v),t="<ul><li>"+B+"</li><li>&nbsp;</li><li><b>"+k.adults+":</b> "+_+V+"</li><li><b>"+k.roomNights+":</b> "+p+'</li><li class="tim-totals-price"><div class="tim-totals-price-label">'+k.totalPrice+'</div><div class="tim-totals-price-amount">'+u+" <span>"+s+timCurrencyFormat(q)+"</span></div>"+Q+"</li></ul>"+J}else t=k.enterOneRoom,f=!0;var z=document.querySelector(".tim-totals-box-wrapper");z.classList.add("tim-transition-in"),setTimeout(function(){z.classList.remove("tim-transition-in"),z.classList.add("tim-transition-out")},500),document.getElementById("timTotalsBoxResult").innerHTML=t,document.getElementById("timAddItemBtn")&&(document.getElementById("timAddItemBtn").disabled=f)}function timCheckPackageRates(){}function timCheckPackageForm(){setButton();var e=0,t=document.getElementById("timFromDB").value,n=document.getElementById("timAdults").value,i=document.getElementById("timChildren").value,a=document.getElementById("timInfants").value,o=document.getElementById("timCustomerName").value,r=document.getElementById("timCustomerEmail").value,m=document.getElementById("timCustomerComments").value,l=getTodayDate();if(t&&t<=l)alert("Invalid date");else{if(e=validateInput("timCustomerName",e=validateEmail("timCustomerEmail",e)),e=validateInput("timAdults",e),e=validateInput("timFrom",e))return setButton(1),!1;var d={action:"check_package_request_api",f_nonce:timData.f_nonce,package_id:document.getElementById("timPackageId").value,package_date:t,adults:parseInt(n),children:parseInt(i),infants:parseInt(a),name:o,email:r,comments:m,lang:document.getElementById("timCL").value};timShowSpinner("tim_travel_form_spinner"),timPostAjax(timData.ajaxurl,d,function(e){if("false"==e)return!1;var t=document.getElementById("timRequestPackageFormMsg"),n=document.getElementById("timLabelRequestPackageSent").value;t.innerHTML='<br /><div class="tim_alert tim_alert_lg tim_alert_success">'+n+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timRequestPackageFormMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timFrom").value="",document.getElementById("timAdults").value="",document.getElementById("timChildren").value=0,document.getElementById("timInfants").value=0,document.getElementById("timCustomerName").value="",document.getElementById("timCustomerEmail").value="",document.getElementById("timCustomerComments").value="",timHideSpinner("tim_spinner")})}}function setDayPrice(e,t,n,i,a,o,r){return applyExchangeRateConversion("per_person"===t?n*e.adult_price+i*e.child_price+a*e.infant_price+o*e.senior_price:e.service_price,r)}function setBasePrice(e,t,n){return t&&n?e/((n.reduce(function(e,t){return e+t.value},0)-n.reduce(function(e,t){return t.exoneration?t.exoneration.percentage:0},0))/100+1):e}function setProductTaxesAmounts(t,e){return 0===e.length?e:e.map(function(e){return e.amount="percentage"===e.computation_type?t*(e.value/100):e.value,"percentage"===e.computation_type&&e.exoneration&&(e.exoneration.amount=t*(e.exoneration.percentage/100)),e})}function getProductTaxesTotalPercentage(e){return 0===e.length?0:e.reduce(function(e,t){return e+t.value},0)}function getProductTaxesTotalAmount(e){return 0===e.length?0:timRoundNum(e.reduce(function(e,t){return e+t.amount},0))}function getProductTaxesTotalExonerationPercentage(e){return 0===e.length?0:e.reduce(function(e,t){return e+(t.exoneration?t.exoneration.percentage:0)},0)}function getProductTaxesTotalExonerationAmount(e){return 0===e.length?0:timRoundNum(e.reduce(function(e,t){return e+(t.exoneration?t.exoneration.amount:0)},0))}function applyExchangeRateConversion(e,t){if(0===e)return e;var n;switch(t.conversion){case"multiply":n=e*t.value;break;case"divide":n=e/t.value;break;default:n=e*t.value[0]/t.value[1]}return timRoundNum(n)}function getRatePerRoomOccupancy(e,t,n,i){var a=0;switch(e){case 1:a=n["single_"+i];break;case 2:a=n["double_"+i];break;case 3:a=n["triple_"+i];break;case 4:a=n["quadruple_"+i];break;default:a=n["quadruple_"+i]+(e-4)*n["additional_person_"+i]}return a+t*n["child_"+i]}function timSelectPaymentGateway(t,e){var n={action:"load_payment_form",f_nonce:timData.f_nonce,option:t,lang:e,policiesAccepted:document.getElementById("timPoliciesAccepted").value};timShowSpinner("tim_travel_form_spinner");var i=document.getElementById("timPaymentBox");i.innerHTML="",timPostAjax(timData.ajaxurl,n,function(e){i.innerHTML=e,"bac_ecommerce"===t||"paypal"===t&&loadPaypalPayment(),document.getElementById("timPaymentGateway").value=t,timHideSpinner("tim_travel_form_spinner")})}function timValidatePolicies(e){document.getElementById("timPoliciesAccepted").value=e.checked,document.getElementById("timPaymentBtn")&&(document.getElementById("timPaymentBtn").disabled=!e.checked)}function timProcessBacEcommercePayment(){setButton();var e=0;if(e=validateCreditCardExpirationDate("expDate",e=validateInput("cvv",e=validateCreditCardNumber("ccnumber",e=timValidateClientDetails()))),e=timValidatePickupPlacesSelected(e=validateInput("ccName",e)))return setButton(1),!1;var t=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),n={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:t,pg:"bac"},i=document.getElementById("timClientId").value;i&&(n.client_id=i),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bac";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bac_endpoint").value,n.submit()})}function timProcessBcrEcommercePayment(){if(setButton(),timValidatePickupPlacesSelected(timValidateClientDetails()))return setButton(1),!1;var e=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),t={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:e,pg:"bcr"},n=document.getElementById("timClientId").value;n&&(t.client_id=n),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bcr";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bcr_endpoint").value,n.submit()})}function timProcessPayLaterPayment(){if(setButton(),timValidatePickupPlacesSelected(timValidateClientDetails()))return setButton(1),!1;var n=document.getElementById("timCL").value,e={action:"process_pay_later_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,notes:document.getElementById("timNotes").value,lang:n,payment_gateway:document.getElementById("timPaymentGateway").value},t=document.getElementById("timClientId").value;t&&(e.client_id=t);var i=document.getElementById("timCustomerBookingFormErrorMsg");i.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,e,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).errors)setButton(1),i.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=done&oid="+e.id+"&onm="+e.booking_number+"&lng="+n}})}function loadPaypalPayment(){var n=document.getElementById("timCL").value,e=(function(){switch(n){case"es":0;break;case"de":0;break;default:0}}(),document.getElementById("timApiUrl").value),i=document.getElementById("timBookingId").value,a=document.getElementById("timSubdomain").value,o=document.getElementById("timCompanyApiKey").value,r=document.getElementById("timDomainApiKey").value,t=e+"/create_paypal_payment",m=e+"/execute_paypal_payment",l=document.getElementById("timPaymentGateway").value,d=document.getElementById("timCustomerBookingFormErrorMsg");function c(e){console.log("toggleButton");var t,n,i,a,o=!0;return document.getElementById("timGuestName").value&&document.getElementById("timGuestLastName").value&&(i=!0,(a=document.getElementById("timGuestEmail").value)&&/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(a)||(i=!1),i)&&(t=!0,(n=document.getElementById("timGuestPhoneNumber").value)&&/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(n)||(t=!1),t)&&document.getElementById("timGuestCountry").value&&document.getElementById("timGuestTaxIdCode").value&&document.getElementById("timGuestTaxIdNumber").value||(o=!1),o?e.enable():e.disable()}d.innerHTML="";var u=document.getElementById("timClientId").value;paypal.Buttons({style:{size:"medium",color:"blue",shape:"pill",label:"checkout"},validate:function(e){var t;if(document.getElementById("timIsClientLogged").value)return e.enable();c(e),t=function(){c(e)},jQuery("#timGuestName").on("change",t),jQuery("#timGuestLastName").on("change",t),jQuery("#timGuestEmail").on("change",t),jQuery("#timGuestPhoneNumber").on("change",t),jQuery("#timGuestCountry").on("change",t),jQuery("#timGuestTaxIdCode").on("change",t),jQuery("#timGuestTaxIdNumber").on("change",t)},onClick:function(){setButton();var e=timValidateClientDetails(0);return!(e=timValidatePickupPlacesSelected(e))||(setButton(1),!1)},createOrder:function(){var e={sub:a,cak:o,dak:r,id:i,payment_gateway:l,email:document.getElementById("timGuestEmail").value,lang:n};return u&&(e.client_id=u),fetch(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return e.id})},onApprove:function(e){var t={orderID:e.orderID,sub:a,cak:o,dak:r,id:i,payment_gateway:l,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,notes:document.getElementById("timNotes").value,lang:n};return u&&(t.client_id=u),timShowSpinner("tim_spinner"),fetch(m,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(t){if(t.errors)return timHideSpinner("tim_spinner"),d.innerHTML='<div class="tim_alert tim_alert_danger">'+t.errors+"</div><br />",void(t.emailInUse&&document.getElementById("timGuestEmail").classList.add("tim_error_input"));var e={action:"paypal_order_completed",f_nonce:timData.f_nonce,bookingItemData:t};document.getElementById("tim_checkout_form").reset(),timPostAjax(timData.ajaxurl,e,function(){timHideSpinner("tim_spinner");var e=document.getElementById("timHomeUrl").value+"order/";window.location=e+"?act=done&oid="+t.id+"&onm="+t.booking_number+"&lng="+n})})}}).render("#paypal-button")}function timValidateClientDetails(e){return document.getElementById("timIsClientLogged").value||(e=validateInput("timGuestName",e),e=validateInput("timGuestLastName",e),e=validateEmail("timGuestEmail",e=validatePhone("timGuestPhoneNumber",e=validateInput("timGuestCountry",e)))),e}function validateCreditCardNumber(e,t){var n=document.getElementById(e);n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove();var i=0;if(""==n.value)i=1;else{var a="";n.value.match(/^(?:4[0-9]{12}(?:[0-9]{3})?)$/)?a="Visa":n.value.match(/^(?:5[1-5][0-9]{14})$/)?a="Mastercad":n.value.match(/^(?:3[47][0-9]{13})$/)?a="American Express":n.value.match(/^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/)?a="Discover":n.value.match(/^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/)?a="Dinersclub":n.value.match(/^(?:(?:2131|1800|35\d{3})\d{11})$/)?a="Jcb":i=1}return i?(n.classList.add("tim_error_input"),1):(document.getElementById("ccType").value=a,t)}function validateCreditCardExpirationDate(e,t){var n=document.getElementById("expMonth"),i=document.getElementById("expYear");n.classList.remove("tim_error_input"),i.classList.remove("tim_error_input");var a=(new Date).getDate(),o=n.value+"/"+a+"/"+i.value,r=setCurrentDate();if(document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),Date.parse(r)>Date.parse(o))return n.classList.add("tim_error_input"),i.classList.add("tim_error_input"),1;var m=n.value+i.value.substr(-2);return document.getElementById("ccexp").value=m,t}function timValidatePickupPlacesSelected(e){return document.getElementById("invalidCardMsg").style.display="none",document.getElementById("timValidCart").value?e:(document.getElementById("invalidCardMsg").style.display="block",1)}function setCurrentDate(){var e=new Date,t=e.getDate();t<10&&(t="0"+t);var n=e.getMonth()+1;return n<10&&(n="0"+n),n+"/"+t+"/"+e.getFullYear()}function timApplyDiscountCoupon(){var n=document.getElementById("timApplyCodeBtn");n.disable=!0;var e=0;if(e=validateInput("timCouponCode",e))return n.disable=!1;var t={action:"apply_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,coupon_code:document.getElementById("timCouponCode").value,lang:document.getElementById("timCL").value},i=document.getElementById("timCouponCodeInvalid");i.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){if(timHideSpinner("tim_spinner"),"error"!==e)document.getElementById("timCheckoutTotals").innerHTML=e;else{n.disable=!1;var t=document.getElementById("timLabelErrorCoupon").value;i.innerHTML='<div class="tim_error_input_msg">'+t+"</div>"}})}function timDeleteDiscountCoupon(){var e={action:"delete_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,e,function(e){"error"!==e&&(document.getElementById("timCheckoutTotals").innerHTML=e)})}!function(n){n(function(){n("a.tim_fancybox").length&&n("a.tim_fancybox").fancybox(),n('.tim_list_search_filter_form select[name="sort"]').change(function(){"all"!==n(this).val()&&n(".tim_list_search_filter_form").submit()}),n(".tim-currency-value").click(function(){var e=n(this).attr("id"),t={action:"set_currency_value",f_nonce:timData.f_nonce,currency_code:e};n.post(timData.ajaxurl,t,function(e){location.reload()})}),n("#tim-tab-map").click(function(e){setTimeout(timInitializeMap,1e3)}),n(".tim-tabs .tim-tabs-links a").on("click",function(e){var t=n(this).attr("href");n(".tim-tabs "+t).show().siblings().hide(),n(this).parent("li").addClass("active").siblings().removeClass("active"),e.preventDefault()}),n(".swipper.tim-tabs-links a").click(function(){timLoadSwiper()})})}(jQuery);var TIM_TIMEOUT_WARNING_ID,TIM_TIMEOUT_NOW_ID,isTimerWarningModalOpened=!1;function timSetBookingTimers(){0!=parseInt(document.getElementById("timBTI").value)&&(document.addEventListener("mousemove",timResetTimer,!1),document.addEventListener("mousedown",timResetTimer,!1),document.addEventListener("keypress",timResetTimer,!1),document.addEventListener("touchmove",timResetTimer,!1),document.addEventListener("onscroll",timResetTimer,!1),timStartBookingTimer())}function timStartBookingTimer(){var e=document.getElementById("timTO").value;isTimerWarningModalOpened=!1,TIM_TIMEOUT_WARNING_ID=setTimeout("timExecuteTimeOutWarning()",60*e*1e3)}function timResetTimer(){isTimerWarningModalOpened||(timClearTimers(),timStartBookingTimer())}function timClearTimers(){clearTimeout(TIM_TIMEOUT_WARNING_ID),clearTimeout(TIM_TIMEOUT_NOW_ID)}function timExecuteTimeOutWarning(){var e=document.getElementById("timBID").value;clearTimeout(TIM_TIMEOUT_WARNING_ID),TIM_TIMEOUT_NOW_ID=setTimeout("timExecuteTimeOutNow('"+e+"')",6e4),document.createElement("div").id="booking-inactivity";var t={action:"open_modal",f_nonce:timData.f_nonce,option:"booking-inactivity",id:e};timPostAjax(timData.ajaxurl,t,function(e){openModal(e,{autoSize:!0,preventCloseOutside:!0,hideCloseBtn:!0})}),isTimerWarningModalOpened=!0}function timExecuteTimeOutNow(e){timCancelBooking(e,!0)}function timContinueWithBooking(e){jQuery.fancybox.close("booking-inactivity"),timClearTimers(),timSetBookingTimers(e)}function timCancelBooking(e,t){var n={action:"delete_booking_api",f_nonce:timData.f_nonce,bookingId:e,lang:document.getElementById("timCL").value};t&&(n.deletedBySystem=!0),jQuery.post(timData.ajaxurl,n,function(e){if("false"==e)return!1;timClearTimers(),jQuery.fancybox.close("booking-inactivity"),window.location=document.getElementById("timHomeUrl").value})}