function timSelectPaymentGateway(t,e){var n={action:"load_payment_form",f_nonce:timData.f_nonce,option:t,lang:e};timShowSpinner("tim_travel_form_spinner");var m=document.getElementById("timPaymentBox");m.innerHTML="",timPostAjax(timData.ajaxurl,n,function(e){m.innerHTML=e,"bac_ecommerce"===t?document.getElementById("ccnumber").focus():"paypal"===t&&loadPaypalPayment(),document.querySelector(".tim-policies").style.display="inline-block",timHideSpinner("tim_travel_form_spinner")})}function timProcessBacEcommercePayment(){setButton();var e=0;if(e=validateCreditCardNumber("ccnumber",e=timValidateClientDetails()),e=validateCreditCardExpirationDate("expDate",e=validateInput("cvv",e)),e=validateInput("ccName",e))return setButton(1),!1;var t=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),n={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:t,pg:"bac"},m=document.getElementById("timClientId").value;m&&(n.client_id=m),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bac";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bac_endpoint").value,n.submit()})}function timProcessBcrEcommercePayment(){setButton();if(timValidateClientDetails())return setButton(1),!1;var e=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),t={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:e,pg:"bcr"},n=document.getElementById("timClientId").value;n&&(t.client_id=n),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bcr";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bcr_endpoint").value,n.submit()})}function timProcessPayLaterPayment(){setButton();if(timValidateClientDetails())return setButton(1),!1;var n=document.getElementById("timCL").value,e={action:"process_pay_later_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:n,payment_gateway:document.getElementById("timPaymentGateway").value},t=document.getElementById("timClientId").value;t&&(e.client_id=t);var m=document.getElementById("timCustomerBookingFormErrorMsg");m.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,e,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).errors)setButton(1),m.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=done&oid="+e.id+"&onm="+e.booking_number+"&lng="+n}})}function loadPaypalPayment(){var n=document.getElementById("timCL").value,e=(function(e){var t;switch(e){case"es":t="es_ES";break;case"de":t="de_DE";break;default:t="en_US"}}(n),document.getElementById("timApiUrl").value),m=document.getElementById("timBookingId").value,a=document.getElementById("timSubdomain").value,i=document.getElementById("timCompanyApiKey").value,o=document.getElementById("timDomainApiKey").value,t=e+"/create_paypal_payment",u=e+"/execute_paypal_payment",d=document.getElementById("timPaymentGateway").value,l=document.getElementById("timCustomerBookingFormErrorMsg");function r(e){var t=!0;return document.getElementById("timGuestName").value&&document.getElementById("timGuestLastName").value&&function(){var e=!0,t=document.getElementById("timGuestEmail").value;if(t){/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(t)||(e=!1)}else e=!1;return e}()&&function(){var e=!0,t=document.getElementById("timGuestPhoneNumber").value;if(t){/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(t)||(e=!1)}else e=!1;return e}()&&document.getElementById("timGuestCountry").value&&document.getElementById("timGuestTaxIdCode").value&&document.getElementById("timGuestTaxIdNumber").value||(t=!1),t?e.enable():e.disable()}l.innerHTML="";var c=document.getElementById("timClientId").value;paypal.Buttons({style:{size:"medium",color:"blue",shape:"pill",label:"checkout"},validate:function(e){var t;if(document.getElementById("timIsClientLogged").value)return e.enable();r(e),t=function(){r(e)},jQuery("#timGuestName").on("change",t),jQuery("#timGuestLastName").on("change",t),jQuery("#timGuestEmail").on("change",t),jQuery("#timGuestPhoneNumber").on("change",t),jQuery("#timGuestCountry").on("change",t),jQuery("#timGuestTaxIdCode").on("change",t),jQuery("#timGuestTaxIdNumber").on("change",t)},onClick:function(){return setButton(),!timValidateClientDetails(0)||(setButton(1),!1)},createOrder:function(){var e={sub:a,cak:i,dak:o,id:m,payment_gateway:d,email:document.getElementById("timGuestEmail").value,lang:n};return c&&(e.client_id=c),fetch(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return e.id})},onApprove:function(e){var t={orderID:e.orderID,sub:a,cak:i,dak:o,id:m,payment_gateway:d,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:n};return c&&(t.client_id=c),timShowSpinner("tim_spinner"),fetch(u,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(t){if(t.errors)return timHideSpinner("tim_spinner"),l.innerHTML='<div class="tim_alert tim_alert_danger">'+t.errors+"</div><br />",void(t.emailInUse&&document.getElementById("timGuestEmail").classList.add("tim_error_input"));var e={action:"paypal_order_completed",f_nonce:timData.f_nonce,bookingItemData:t};document.getElementById("tim_checkout_form").reset(),timPostAjax(timData.ajaxurl,e,function(){timHideSpinner("tim_spinner");var e=document.getElementById("timHomeUrl").value+"order/";window.location=e+"?act=done&oid="+t.id+"&onm="+t.booking_number+"&lng="+n})})}}).render("#paypal-button")}function timValidateClientDetails(e){return document.getElementById("timIsClientLogged").value||(e=validateInput("timGuestName",e),e=validateInput("timGuestLastName",e),e=validateInput("timGuestCountry",e),e=validatePhone("timGuestPhoneNumber",e),e=validateEmail("timGuestEmail",e),e=validateInput("timGuestTaxIdCode",e),e=validateTaxIdNumber("timGuestTaxIdNumber",e)),e}function validateCreditCardNumber(e,t){var n=document.getElementById(e);n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove();var m=0;if(""==n.value)m=1;else{var a="";n.value.match(/^(?:4[0-9]{12}(?:[0-9]{3})?)$/)?a="Visa":n.value.match(/^(?:5[1-5][0-9]{14})$/)?a="Mastercad":n.value.match(/^(?:3[47][0-9]{13})$/)?a="American Express":n.value.match(/^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/)?a="Discover":n.value.match(/^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/)?a="Dinersclub":n.value.match(/^(?:(?:2131|1800|35\d{3})\d{11})$/)?a="Jcb":m=1}return m?(n.classList.add("tim_error_input"),1):(document.getElementById("ccType").value=a,t)}function validateCreditCardExpirationDate(e,t){var n=document.getElementById("expMonth"),m=document.getElementById("expYear");n.classList.remove("tim_error_input"),m.classList.remove("tim_error_input");var a=(new Date).getDate(),i=n.value+"/"+a+"/"+m.value,o=setCurrentDate();if(document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),Date.parse(o)>Date.parse(i))return n.classList.add("tim_error_input"),m.classList.add("tim_error_input"),1;var u=n.value+m.value.substr(-2);return document.getElementById("ccexp").value=u,t}function setCurrentDate(){var e=new Date,t=e.getDate();t<10&&(t="0"+t);var n=e.getMonth()+1;return n<10&&(n="0"+n),e=n+"/"+t+"/"+e.getFullYear()}function timApplyDiscountCoupon(){var n=document.getElementById("timApplyCodeBtn");n.disable=!0;var e=0;if(e=validateInput("timCouponCode",e))return n.disable=!1;var t={action:"apply_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,coupon_code:document.getElementById("timCouponCode").value,lang:document.getElementById("timCL").value},m=document.getElementById("timCouponCodeInvalid");m.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){if(timHideSpinner("tim_spinner"),"error"!==e)document.getElementById("timCheckoutTotals").innerHTML=e;else{n.disable=!1;var t=document.getElementById("timLabelErrorCoupon").value;m.innerHTML='<div class="tim_error_input_msg">'+t+"</div>"}})}function timDeleteDiscountCoupon(){var e={action:"delete_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,e,function(e){"error"!==e&&(document.getElementById("timCheckoutTotals").innerHTML=e)})}