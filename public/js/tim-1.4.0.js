// Public
function timInitializeMap(e,t){null==e&&(e="");var n=document.getElementById("tim_googleMap"+e);if(null!==n&&"undefined"!=typeof google){var a=document.getElementById("timMapType"+e);if(null!==a)"waypoints"===a.value?timGoogleRouteWayPointsMap(n,t):"multiple"===a.value&&timLoadMultiLocationMap(n,t);else{var i=document.getElementById("tim_geoLat"+e).value,r=document.getElementById("tim_geoLng"+e).value,o=document.getElementById("tim_geoZoom"+e).value,m=new google.maps.LatLng(i,r),l={center:m,zoom:parseInt(o),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},s=new google.maps.Map(n,l);new google.maps.Marker({position:m}).setMap(s),google.maps.event.trigger(s,"resize")}}}function timGoogleRouteWayPointsMap(e,t){var n=new google.maps.DirectionsRenderer,a=new google.maps.DirectionsService,i={zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.Map(e,i);n.setMap(r),calculateAndDisplayRoute(a,n,t)}function calculateAndDisplayRoute(e,n,t){var a={lat:t.departure.lat,lng:t.departure.lng},i={lat:t.arrival.lat,lng:t.arrival.lng},r=[];if(t.waypoints&&0<t.waypoints.length)for(var o=0;o<t.waypoints.length;o++){var m=t.waypoints[o],l=!!m.stop_on_route;r.push({location:new google.maps.LatLng(m.location.lat,m.location.lng),stopover:l})}e.route({origin:a,destination:i,waypoints:r,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING},function(e,t){"OK"===t?n.setDirections(e):window.alert("Directions request failed due to "+t)})}function timLoadMultiLocationMap(e,t){if(void 0!==navigator.geolocation){coords=timGroupLocations(t);var n={zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.Map(e,n),i=[];for(o=0;o<coords.length;o++)i.push(new google.maps.LatLng(coords[o].lat,coords[o].lng));for(var r=new google.maps.LatLngBounds,o=0;o<i.length;o++){r.extend(i[o]);var m=new google.maps.Marker({map:a,position:i[o]});if(0<coords[o].locations.length){for(var l="",s=0;s<coords[o].locations.length;s++)l+='<li title="Day '+coords[o].locations[s].day_number+" - "+coords[o].locations[s].name+'">'+coords[o].locations[s].day_number+"</li>";new google.maps.InfoWindow({content:'<div class="tim_map_labels"><ul>'+l+"</ul></div>"}).open(a,m)}}new google.maps.Polyline({map:a,path:i,strokeColor:"#0000FF",strokeOpacity:.7,strokeWeight:2});a.fitBounds(r)}else alert("Your browser doesnt support the Geolocation API")}function timGroupLocations(e){for(var t,n,a,i=[],r=[],o=e.length,m=0;m<o;m++)i[(t=e[m]).lat]||(i[t.lat]={lat:t.lat,lng:t.lng,locations:[]});for(var l in i){n=i[l].lat;for(m=0;m<o;m++)a={day_number:(t=e[m]).day_number,name:t.name},n===t.lat&&i[l].locations.push(a);0}for(var l in i)r.push(i[l]);var s=i[e[o-1].lat]={lat:e[o-1].lat,lng:e[o-1].lng,locations:[]};return r.push(s),r}function timAjaxContent(e,t){var n={action:"open_modal",f_nonce:timData.f_nonce,option:e,lang:document.getElementById("timCL").value};t&&(n.id=t),timPostAjax(timData.ajaxurl,n,function(e){openModal(e)})}function openModal(e,t){var n={content:e,type:"ajax",autoSize:!1,maxWidth:1100,maxHeight:800,width:"95%",afterShow:function(){timLoadModalSlider()}};t&&(t.preventCloseOutside&&(n.helpers={overlay:{closeClick:!1}}),t.hideCloseBtn&&(n.closeBtn=!1),t.autoSize&&(n.autoSize=!0)),jQuery.fancybox.open(n)}function timLoadModalSlider(){jQuery("div.tim_detail_slider_modal").length&&setTimeout(function(){new Swiper(".tim_detail_slider_modal",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}})},500)}function timLoadSwiper(){new Swiper(".tim-detail-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}}),new Swiper(".tim-rooms-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),new Swiper(".tim-carrousel-slider",{pagination:".swiper-pagination",nextButton:".swiper-button-next",prevButton:".swiper-button-prev",paginationClickable:!0,grabCursor:!1,spaceBetween:20,slidesPerView:3,breakpoints:{992:{slidesPerView:2,spaceBetween:20},768:{slidesPerView:1,spaceBetween:20},320:{slidesPerView:1,spaceBetween:10}}})}function timTabContent(e,t,n){var a,i,r;for(i=document.getElementsByClassName("tim_tab_content"),a=0;a<i.length;a++)i[a].style.display="none";if(!n){for(r=document.getElementsByClassName("tablink"),a=0;a<i.length;a++)void 0!==r[a]&&(r[a].className=r[a].className.replace(" active",""));e.currentTarget.className+=" active"}document.getElementById(t).style.display="block","timTabMap"==t&&timInitializeMap("Tab")}function timToggleContent(e){var t=document.getElementById(e);"none"===t.style.display?t.style.display="block":t.style.display="none"}function timScrollTo(e){return document.getElementById(e).scrollIntoView({behavior:"smooth"}),!1}function timShowErrorLabelApi(e){var t=document.getElementById("timGuestEmail");t.classList.remove("tim_error_input"),t.classList.add("tim_error_input"),t.insertAdjacentHTML("afterend",'<div id="timGuestEmailErrorMsg" class="tim_error_input_msg">'+e+"</div>"),t.focus()}function timLoadData(e,t){var n={action:e,f_nonce:timData.f_nonce,lang:t||document.getElementById("timCL").value},a=document.getElementById("timLoadDataResult");timPostAjax(timData.ajaxurl,n,function(e){a.innerHTML=e})}function timCheckLoginForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value,n=document.getElementById("timCustomerPassword").value;if(e=validateEmail("timCustomerEmail",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var a={action:"create_client_login_api",f_nonce:timData.f_nonce,email:t,password:n,lang:document.getElementById("timCL").value},i=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,a,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),i.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>"):location.reload(),timHideSpinner("tim_spinner")})}function timLogout(){var e={action:"client_logout",f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,e,function(e){location.reload()})}function timCheckSignupForm(){setButton();var e=0,t=document.getElementById("timCustomerName").value,n=document.getElementById("timCustomerLastName").value,a=document.getElementById("timCustomerEmail").value,i=document.getElementById("timCustomerPhoneNumber").value,r=document.getElementById("timCustomerPhoneCode").value,o=document.getElementById("timCustomerCountry").value,m=document.getElementById("timGuestTaxIdCode").value,l=document.getElementById("timGuestTaxIdNumber").value,s=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timGuestTaxIdCode",e),e=validateInput("timGuestTaxIdNumber",e),e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var u=o.split("-")[0],d={action:"create_client_signup_api",f_nonce:timData.f_nonce,name:t,last_name:n,tax_id_code:m,tax_id_number:l,email:a,phone_number:i,phone_code:r,country_id:u,password:s,lang:document.getElementById("timCL").value},c=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,d,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors){t=e.errors[n].join(", ")}c.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else location.reload();timHideSpinner("tim_spinner")})}function timSelectCountry(e,t){var n=document.getElementById("tim"+[t]+"PhoneNumber"),a=document.getElementById("tim"+[t]+"PhoneCode");n.value="",a.value="",n.disabled=!e;var i=e.split("-")[1];a.value=i,jQuery("#tim"+[t]+"PhoneNumber").inputmask({mask:"("+a.value+") 9{0,20}",autoUnmask:!0,removeMaskOnSubmit:!0,greedy:!1})}function timCheckPasswordRecoveryForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value;if(e=validateEmail("timCustomerEmail",e))return setButton(1),!1;var n={action:"create_client_password_api",f_nonce:timData.f_nonce,email:t,lang:document.getElementById("timCL").value},a=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),a.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />"):(timLoadData("load_edit_password_form"),document.getElementById("timClientEmail").value=e.email),timHideSpinner("tim_spinner")})}function timCheckUpdatePassword(){setButton();var e=0,t=document.getElementById("timCustomerCode").value,n=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timCustomerCode",e))return setButton(1),!1;var a=document.getElementById("timClientEmail").value,i={action:"update_client_password_api",f_nonce:timData.f_nonce,email:a,code:t,password:n,lang:document.getElementById("timCL").value},r=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,i,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors)setButton(1),r.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>";else{timLoadData("load_login_form");var t=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_success">'+t+".</div><br />"}timHideSpinner("tim_spinner")})}function timCheckUpdateClientProfile(){setButton();var e=0,t=document.getElementById("timCustomerId").value,n=document.getElementById("timCustomerName").value,a=document.getElementById("timCustomerLastName").value,i=document.getElementById("timCustomerEmail").value,r=document.getElementById("timCustomerPhoneNumber").value,o=document.getElementById("timCustomerPhoneCode").value,m=document.getElementById("timCustomerCountry").value;if(e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var l=m.split("-")[0],s={action:"update_client_profile_api",f_nonce:timData.f_nonce,id:t,name:n,last_name:a,email:i,phone_number:r,phone_code:o,country_id:l,lang:document.getElementById("timCL").value},u=document.getElementById("timClientProfileFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,s,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors){t=e.errors[n].join(", ")}u.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var a=document.getElementById("timLabelProfileUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+a+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timCloseAlert(e){document.getElementById(e).innerHTML=""}function timCheckUpdateClientPassword(){setButton();var e=0,t=document.getElementById("timCustomerId").value,n=document.getElementById("timCustomerPassword").value;document.getElementById("timCustomerPasswordConfirmation").value;if(e=validateInput("timCustomerPasswordConfirmation",e),e=validatePasswordConfirmation("timCustomerPassword","timCustomerPasswordConfirmation",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var a={action:"update_client_profile_password_api",f_nonce:timData.f_nonce,id:t,password:n,lang:document.getElementById("timCL").value},i=document.getElementById("timClientPasswordFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,a,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var n in e.errors){t=e.errors[n].join(", ")}i.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var a=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+a+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timCustomerPassword").value="",document.getElementById("timCustomerPasswordConfirmation").value="",timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timProcessSecondaryPriceList(e){var t={action:"accept_secondary_price_list",option:e,f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,t,function(){location.reload()})}function validateInput(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var a=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}return t}function validateEmail(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var a=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}else{if(!/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(n.value)){if(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")){a=document.getElementById(e+"Invalid").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}}return t}function validatePhone(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var a=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}else{if(!/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(n.value)){if(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")){a=document.getElementById(e+"Invalid").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}}return t}function validateTaxIdNumber(e,t){var n=document.getElementById(e);if(n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==n.value||0==n.value){if(n.classList.add("tim_error_input"),document.getElementById(e+"Error")){var a=document.getElementById(e+"Error").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}else{var i;switch(document.getElementById("timGuestTaxIdCode").value){case"01":i=9;break;case"02":case"03":case"04":i=10;break;case"06":i=9}if(n.value.length<i){if(n.classList.add("tim_error_input"),document.getElementById(e+"Invalid")){a=document.getElementById(e+"Invalid").value;n.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+a+"</div>")}t=1}}return t}function validatePasswordConfirmation(e,t,n){var a=document.getElementById(e),i=getElementById(t),r=document.getElementById("timClientPasswordFormErrorMsg");if((r.innerHTML="")!=a.value&&""!=i.value&&a.value!=i.value){if(a.className="tim_error_input",i.className="tim_error_input",document.getElementById(id+"Error")){var o=getElementById(id+"Error").value;r.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+o+"</div>"}n=1}return n}function setButton(e){if(void 0!==document.getElementsByClassName("timSendButton")[0]){var t=!e;document.getElementsByClassName("timSendButton")[0].disabled=t}}function timShowSpinner(e){document.getElementsByClassName(e)[0].style.display="inline"}function timHideSpinner(e){document.getElementsByClassName(e)[0].style.display="none"}function timRemoveItemFromArray(e,t,n){var a=timFindArrayIndex(e,t,n);return e.splice(a,1),e}function timFindItemInArray(e,t,n){for(var a=0;a<e.length;a++)if(e[a][t]===n)return e[a];return null}function timFindArrayIndex(e,t,n){for(var a=0;a<e.length;a++)if(e[a][t]===n)return a;return null}function setTimePicker(e,t){var n={timeSeparator:":"};t&&(n.now=t),jQuery("."+e).wickedpicker(n)}function timConvertTimeToDB(e){var t=e.split(" "),n=t[0].split(":"),a=n[0],i=n[1];if(a<10&&(a="0"+a),"PM"===t[1])switch(a){case"01":a="13";break;case"02":a="14";break;case"03":a="15";break;case"04":a="16";break;case"05":a="17";break;case"06":a="18";break;case"07":a="19";break;case"07":a="20";break;case"09":a="21";break;case"10":a="22";break;case"11":a="23";break;case"12":a="24"}return a+":"+i}function timParseDate(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])}function timGetDiffInDays(e,t){return Math.round((t-e)/864e5)}function increaseDate(e,t){var n=e.split("-"),a=new Date(parseInt(n[0],10),parseInt(n[1],10)-1,parseInt(n[2],10));return a.setDate(a.getDate()+1),n[0]=""+a.getFullYear(),n[1]=""+(a.getMonth()+1),n[1].length<2&&(n[1]="0"+n[1]),n[2]=""+a.getDate(),n[2].length<2&&(n[2]="0"+n[2]),n.join("-")}function getTodayDate(){var e=new Date,t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0");return e=e.getFullYear()+"-"+n+"-"+t}function timFormatHour(e){var t=e.split(":"),n=t[0];t[1];return value=(e="00:00"==e?"12:00":e)+" "+(n<"12"?"AM":"12"==n?"MD":"PM"),value}function timRoundNum(e,t){return e=isNaN(e)?0:e,t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)}function timOnlyNumbers(e){if(e.keyCode?code=e.keyCode:e.which&&(code=e.which),8==code||9==code||13==code)return!0;var t=String.fromCharCode(code);return"0"<=t&&t<="9"}function timCurrencyFormat(e,t){return t=t||2,e.toFixed(t).replace(/\.?0*$/g,"")}function timPostAjax(e,t,n){var a="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return i.open("POST",e),i.onreadystatechange=function(){3<i.readyState&&200==i.status&&n(i.responseText)},i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(a),i}!function(n){n(function(){n("a.tim_fancybox").length&&n("a.tim_fancybox").fancybox(),n('.tim_list_search_filter_form select[name="sort"]').change(function(){"all"!==n(this).val()&&n(".tim_list_search_filter_form").submit()}),n(".tim-currency-value").click(function(){var e=n(this).attr("id"),t={action:"set_currency_value",f_nonce:timData.f_nonce,currency_code:e};n.post(timData.ajaxurl,t,function(e){location.reload()})}),n("#tim-tab-map").click(function(e){setTimeout(timInitializeMap,1e3)}),n(".tim-tabs .tim-tabs-links a").on("click",function(e){var t=n(this).attr("href");n(".tim-tabs "+t).show().siblings().hide(),n(this).parent("li").addClass("active").siblings().removeClass("active"),e.preventDefault()}),n(".swipper.tim-tabs-links a").click(function(){timLoadSwiper()})})}(jQuery);

// Order
function setTaxIdNumberMask(e){var t,i=jQuery("#timGuestTaxIdNumber");if(i.val(""),e){var a;switch(t=!1,e){case"01":a="9 9999 9999";break;case"02":a="9 999 999 999";break;case"03":a="999999999999"}i.inputmask({mask:a,autoUnmask:!0,removeMaskOnSubmit:!0})}else t=!0;i.prop("disabled",t)}function timAddItemToOrder(e){var t=document.getElementById("timUserCurrency").value,i=document.getElementById("departureTime");i&&(e.departure_time=timConvertTimeToDB(i.value)),document.getElementById("timProviderId")&&(e.provider_id=document.getElementById("timProviderId").value);var a={action:"add_item_to_order_api",f_nonce:timData.f_nonce,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:e};if(document.getElementById("timAvailabilityResult")){var n=document.getElementById("timAvailabilityResult");n.style.opacity=.5}timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,a,function(e){if("false"==e)return!1;timHideSpinner("tim_spinner"),document.getElementById("timAvailabilityResult")&&(n.style.opacity=1),window.location=document.getElementById("timHomeUrl").value+"cart/"})}function timOpenEditItemFromOrder(e,t,i){var a={action:"open_modal",f_nonce:timData.f_nonce,option:"cart",id:e,type:t,pLId:i,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,a,function(e){openModal(e)})}function timUpdateItemFromOrder(e){var t={action:"update_item_from_order_api",f_nonce:timData.f_nonce,bookingItemData:e,lang:document.getElementById("timCL").value};timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,t,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,timHideSpinner("tim_spinner"),jQuery.fancybox.close()})}function timApplyPlacesToItemOrder(e){var t={booking_item_id:e},i=document.getElementById("timPickupPlaceId_"+e).value;i&&(t.pickup_place_id=i);var a=document.getElementById("timDropoffPlaceId_"+e).value;a&&(t.dropoff_place_id=a);var n={action:"apply_places_to_order_api",f_nonce:timData.f_nonce,bookingItemData:t,lang:document.getElementById("timCL").value};timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,n,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,timHideSpinner("tim_spinner")})}function timRemoveItemFromOrder(e){timShowSpinner("tim_spinner");var t={action:"remove_item_from_order_api",f_nonce:timData.f_nonce,bookingItemId:e,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,t,function(e){if("false"==e)return!1;timHideSpinner("tim_spinner");var t=document.getElementById("timTotalBookingItems").value-1;document.getElementById("timCartDetail").innerHTML=e,document.getElementById("timBTI").innerHTML=t,document.getElementById("timOTI")&&(document.getElementById("timOTI").innerHTML=t)})}function timSelectPickupPlace(e,t){var i=!0,a=!0;if("both"==e||"pickup"==e){var n=document.getElementById("timPickupPlaceId_"+t).value;n&&null!=n||(i=!1)}if("both"==e||"dropoff"==e){var o=document.getElementById("timDropoffPlaceId_"+t).value;o&&null!=o||(a=!1)}i&&a&&(document.getElementById("addPlaces_"+t).disabled=!1)}function timUnavailableProductDates(e){var t=document.getElementById("unavailableDates")?JSON.parse(document.getElementById("unavailableDates").value):[],i=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();a<10&&(a="0"+a),n<10&&(n="0"+n);var o=i+"-"+a+"-"+n;return-1!=jQuery.inArray(o,t)?[!1,"disabled",""]:[!0,"",""]}function timProductDatePicker(i,e,t,a,n){jQuery.datepicker.setDefaults(jQuery.datepicker.regional[""+t]);var o=jQuery("#timFrom");if("hotel"===i)var r=jQuery("#timTo");var m="yy-mm-dd";if(o.datepicker({firstDay:1,minDate:0,numberOfMonths:e,altField:"#timFromDB",altFormat:m,onSelect:function(){if(_(),a||"hotel"===i){if(r){var e=o.datepicker("getDate"),t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);r.datepicker("option","minDate",t),setTimeout(function(){document.getElementById("timTo").focus()},10),document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}}else switch(i){case"tour":timCheckTourRates();break;case"transportation":timCheckTransportationRates()}}}).datepicker("widget").wrap('<div class="tim-datepicker"/>'),a){var l=(p=a.split("-"))[0],c=p[1]-1,d=p[2];o.datepicker("setDate",new Date(l,c,d))}if("hotel"===i){var s=o.datepicker("getDate"),u=s?new Date(s.getFullYear(),s.getMonth(),s.getDate()+1):"+1D";r.datepicker({minDate:u,numberOfMonths:1,altField:"#timToDB",altFormat:m,onSelect:function(){document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}})}if(n){var p;l=(p=n.split("-"))[0],c=p[1]-1,d=p[2];r.datepicker("setDate",new Date(l,c,d))}function _(){if(document.getElementById("timAvailabilityFor")){var e=timLabels.availabilityFor+": <b>"+o.val()+"</b>";document.getElementById("timAvailabilityFor").innerHTML=e}}"package"!==i&&_()}function timVerifyOrderForm(){setButton();var e=0,t=document.getElementById("timOrderId").value,i=document.getElementById("timCustomerEmail").value;if(e=validateEmail("timCustomerEmail",e),e=validateInput("timOrderId",e))return setButton(1),!1;var a=document.getElementById("timCL").value,n={action:"verify_order_api",f_nonce:timData.f_nonce,bookingNumber:t,clientEmail:i,lang:document.getElementById("timCL").value},o=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).error)setButton(1),o.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+e.error+"</div>";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=view&oid="+e.id+"&onm="+e.booking_number+"&lng="+a}})}function timCheckTourRates(e){var t=document.getElementById("timUserCurrency").value,i=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),a=(new Date).toISOString(),n=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_tour_rates_api",f_nonce:timData.f_nonce,currentUTCDate:a,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:{booking_type:"tour",start_date:document.getElementById("timFromDB").value,adults:parseInt(n),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),tour_id:document.getElementById("timTourId").value,tour_content_id:document.getElementById("timTourContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTourRatesEdit(e,l,i)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),document.getElementById("timTourDefaultPickupPlaceId")&&(l.bookingItemData.pickup_place_id=document.getElementById("timTourDefaultPickupPlaceId").value),document.getElementById("timTourDefaultDropoffPlaceId")&&(l.bookingItemData.dropoff_place_id=document.getElementById("timTourDefaultDropoffPlaceId").value),timCheckTourRatesAdd(l,i))}function timCheckTourRatesAdd(j,U){var q=document.getElementById("timTourOptions");q.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,j,function(e){var t=timLabels,i="";if("false"==e)i='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var a=JSON.parse(e),n=a.tour_options,o=a.saleTaxes,r=a.documentDateExchangeRate,m=a.taxesIncluded;if(j.bookingItemData.exchange_rate_value=r.exchangeRateValue,j.spl_accepted&&(j.bookingItemData.spl_accepted=!0),j.bookingItemData.priceListIdByProvider=a.priceListIdByProvider,n){for(var l=j.bookingItemData.adults,c=j.bookingItemData.children,d=j.bookingItemData.infants,s=j.bookingItemData.seniors,u=l+c+d+s,p=!1,_=!1,g=JSON.parse(document.getElementById("unavailableDates").value),v=document.getElementById("timFromDB"),b=0;b<n.length;b++){var I=n[b],y="";if(0<I.schedules.length)for(var f=0;f<I.schedules.length;f++){var k,D=I.schedules[f];j.bookingItemData.subtotal_price=0;var x=D.date_rates;j.bookingItemData.tour_option_id=I.id,j.bookingItemData.tour_option_schedule_id=D.id,j.bookingItemData.departure_time=D.departure,j.bookingItemData.quantity=u,j.bookingItemData.adult_price=0<l?applyExchangeRateConversion(x.adult_price,r):0,j.bookingItemData.child_price=0<c?applyExchangeRateConversion(x.child_price,r):0,j.bookingItemData.infant_price=0<d?applyExchangeRateConversion(x.infant_price,r):0,j.bookingItemData.senior_price=0<s?applyExchangeRateConversion(x.senior_price,r):0;var h=setDayPrice(x,"per_person",l,c,d,s,r),E=setBasePrice(h,m,o),B=E*(x.client_commission_percentage/100),R=E-B,T=0+R,P=getProductTaxesTotalPercentage(o),C=getProductTaxesTotalExonerationPercentage(o),S=P-C;j.bookingItemData.sale_taxes=setProductTaxesAmounts(T,o);var N=getProductTaxesTotalAmount(j.bookingItemData.sale_taxes),A=getProductTaxesTotalExonerationAmount(j.bookingItemData.sale_taxes),L=N-A,O=T+L;j.bookingItemData.item_price=timRoundNum(h),j.bookingItemData.base_price=timRoundNum(E),j.bookingItemData.commission_price_percentage=x.client_commission_percentage,j.bookingItemData.commission_price=timRoundNum(B),j.bookingItemData.net_price=timRoundNum(R),j.bookingItemData.pickup_price=0,j.bookingItemData.dropoff_price=0,j.bookingItemData.discount_price=timRoundNum(0),j.bookingItemData.subtotal_price=timRoundNum(T),j.bookingItemData.tax_price_percentage=P,j.bookingItemData.tax_price=timRoundNum(N),j.bookingItemData.tax_exoneration_price_percentage=C,j.bookingItemData.tax_exoneration_price=timRoundNum(A),j.bookingItemData.net_tax_price_percentage=S,j.bookingItemData.net_tax_price=timRoundNum(L),j.bookingItemData.total_price=timRoundNum(O);var w=m?j.bookingItemData.total_price:j.bookingItemData.subtotal_price;D.is_available&&D.isCutOffValid?(k=u>=D.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(j.bookingItemData)+")'>"+t.book+"</a>":'<br /><span class="tim_error_input_msg"><b>'+t.errorMinPaxRequired+": "+D.min_pax_required+"</b></span>",p=!0):(k='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",0),x.day&&(_=!0);var H=0<w?U+timCurrencyFormat(w):"-",F=t.hours;y+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+t.departure+"</span>"+timFormatHour(D.departure)+'</div><div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+D.duration+" <small>"+F+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+H+'</div><div class="tim-book">'+k+"</div></div>"}else y+='<div class="tim-option-content"><b>* '+t.errorSelectEarlierDate+"</b></div>";i+='<div class="tim-options-wrapper"><div class="tim-option-title">'+I.name+'</div><div class="tim-option-body">'+y+"</div></div>"}if(!p&&_){g.push(v.value);var M=increaseDate(v.value,1);v.value=M,document.getElementById("unavailableDates").value=JSON.stringify(g),jQuery("#timFrom").datepicker("option","beforeShowDay",timUnavailableProductDates).datepicker("refresh")}}else i='<div style="text-align:center;"><b>No rates found.</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTourOptions").innerHTML=i,q.style.opacity=1})}function timCheckTourRatesEdit(e,N,A){var t=document.getElementById("timPickupPlaceId"),i=t.value;if(t.classList.remove("tim_error_input"),!i||null==i)return t.classList.add("tim_error_input"),t.focus(),!1;var a=document.getElementById("timDropOffPlaceId"),n=a.value;if(a.classList.remove("tim_error_input"),!n||null==n)return a.classList.add("tim_error_input"),a.focus(),!1;var o=document.forms.tim_update_cart.elements.schedule.value.split("-"),r=o[0],m=o[1],l=o[2];N.bookingItemData.booking_item_id=e,N.bookingItemData.tour_option_id=r,N.bookingItemData.tour_option_schedule_id=m,N.bookingItemData.departure_time=l,N.bookingItemData.pickup_place_id=i,N.bookingItemData.dropoff_place_id=n;var L=document.getElementById("timAvailabilityResult");L.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,N,function(e){if("false"==e)return!1;var t=timLabels,i=JSON.parse(e);if(i.error){var a='<br /><div class="tim_alert tim_alert_danger"><b>'+i.error+"</b></div>";L.innerHTML=a}else{var n=i.tour_options,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded,l=i.booking,c=n.date_rates,d=N.bookingItemData.adults,s=N.bookingItemData.children,u=N.bookingItemData.infants,p=N.bookingItemData.seniors;N.bookingItemData.adult_price=0<d?applyExchangeRateConversion(c.adult_price,r):0,N.bookingItemData.child_price=0<s?applyExchangeRateConversion(c.child_price,r):0,N.bookingItemData.infant_price=0<u?applyExchangeRateConversion(c.infant_price,r):0,N.bookingItemData.senior_price=0<p?applyExchangeRateConversion(c.senior_price,r):0;var _=setDayPrice(c,"per_person",d,s,u,p,r),g=setBasePrice(_,m,o),v=g*(c.client_commission_percentage/100),b=g-v,I=applyExchangeRateConversion(n.pickup_price,r),y=applyExchangeRateConversion(n.dropoff_price,r),f=0,k=b+I+y-f,D=getProductTaxesTotalPercentage(o),x=getProductTaxesTotalExonerationPercentage(o),h=D-x;l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?k-=f=k*(l.discount_coupon.value/100):k=(_+I+y-(f=applyExchangeRateConversion(l.discount_coupon.value,r)))/(h/100+1)),N.bookingItemData.sale_taxes=setProductTaxesAmounts(k,o);var E=getProductTaxesTotalAmount(N.bookingItemData.sale_taxes),B=getProductTaxesTotalExonerationAmount(N.bookingItemData.sale_taxes),R=E-B,T=k+R;N.bookingItemData.item_price=timRoundNum(_),N.bookingItemData.base_price=timRoundNum(g),N.bookingItemData.commission_price_percentage=c.client_commission_percentage,N.bookingItemData.commission_price=timRoundNum(v),N.bookingItemData.net_price=timRoundNum(b),N.bookingItemData.pickup_price=I,N.bookingItemData.dropoff_price=y,N.bookingItemData.discount_price=timRoundNum(f),N.bookingItemData.subtotal_price=timRoundNum(k),N.bookingItemData.tax_price_percentage=D,N.bookingItemData.tax_price=timRoundNum(E),N.bookingItemData.tax_exoneration_price_percentage=x,N.bookingItemData.tax_exoneration_price=timRoundNum(B),N.bookingItemData.net_tax_price_percentage=h,N.bookingItemData.net_tax_price=timRoundNum(R),N.bookingItemData.total_price=timRoundNum(T);var P=m?N.bookingItemData.total_price:N.bookingItemData.subtotal_price,C=N.bookingItemData.pickup_price+N.bookingItemData.dropoff_price,S='<div class="tim_align_right" style="font-size:14px;">';C&&(S=m?"<br />"+S+"(+) "+t.transportation+"<br />":"<br />"+S+"<hr />"+t.subtotal+": <b>"+A+N.bookingItemData.net_price+"</b><br /><small>(+) "+t.transportation+":</small> "+A+C+"<br />"),S=S+"<br /><hr /><b>"+t.totalPrice+": "+A+timCurrencyFormat(P)+"</b><br /><br /><button type='button' class='tim-btn tim-btn-lg' onclick='timUpdateItemFromOrder("+JSON.stringify(N.bookingItemData)+")'>"+t.updateOrder+"</button></div>",L.innerHTML=S}timHideSpinner("tim_spinner")})}function timCheckTransportationRates(e){var t=document.getElementById("timUserCurrency").value,i=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),a=(new Date).toISOString(),n=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_transportation_rates_api",f_nonce:timData.f_nonce,currentUTCDate:a,lang:document.getElementById("timCL").value,currency_id:t,scheduleType:document.getElementById("timTransportationScheduleType").value,bookingItemData:{booking_type:"transportation",start_date:document.getElementById("timFromDB").value,adults:parseInt(n),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),transportation_id:document.getElementById("timTransportationId").value,transportation_content_id:document.getElementById("timTransportationContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTransportationRatesEdit(e,l,i)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),timCheckTransportationRatesAdd(l,i))}function timCheckTransportationRatesAdd(q,J){var Q=document.getElementById("timAvailabilityResult");Q.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,q,function(e){var t=timLabels,i="";if("false"==e)i='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var a=JSON.parse(e),n=a.transportation_schedules,o=a.saleTaxes,r=a.documentDateExchangeRate,m=a.taxesIncluded;q.bookingItemData.exchange_rate_value=r.exchangeRateValue,q.spl_accepted&&(q.bookingItemData.spl_accepted=!0),q.bookingItemData.priceListIdByProvider=a.priceListIdByProvider;var l=!0,c=t.departure;if("open"===q.scheduleType&&(l=!1,c=t.selectTime),n){var d,s=q.bookingItemData.adults,u=q.bookingItemData.children,p=q.bookingItemData.infants,_=q.bookingItemData.seniors,g=s+u+p+_,v=!1,b=!1,I=JSON.parse(document.getElementById("unavailableDates").value),y=document.getElementById("timFromDB"),f="";if(0<n.length)for(var k=0;k<n.length;k++){var D,x=n[k],h="";q.bookingItemData.subtotal_price=0;var E=x.date_rates;q.bookingItemData.transportation_schedule_id=x.id,q.bookingItemData.departure_time=x.departure,q.bookingItemData.quantity=1,d="per_service","fixed"===q.scheduleType&&(q.bookingItemData.quantity=g,d="per_person",q.bookingItemData.adult_price=0<s?applyExchangeRateConversion(E.adult_price,r):0,q.bookingItemData.child_price=0<u?applyExchangeRateConversion(E.child_price,r):0,q.bookingItemData.infant_price=0<p?applyExchangeRateConversion(E.infant_price,r):0,q.bookingItemData.senior_price=0<_?applyExchangeRateConversion(E.senior_price,r):0);var B=setDayPrice(E,d,s,u,p,_,r),R=setBasePrice(B,m,o),T=R*(E.client_commission_percentage/100),P=R-T,C=0+P,S=getProductTaxesTotalPercentage(o),N=getProductTaxesTotalExonerationPercentage(o),A=S-N;q.bookingItemData.sale_taxes=setProductTaxesAmounts(C,o);var L=getProductTaxesTotalAmount(q.bookingItemData.sale_taxes),O=getProductTaxesTotalExonerationAmount(q.bookingItemData.sale_taxes),w=L-O,H=C+w;q.bookingItemData.item_price=timRoundNum(B),q.bookingItemData.base_price=timRoundNum(R),q.bookingItemData.commission_price_percentage=E.client_commission_percentage,q.bookingItemData.commission_price=timRoundNum(T),q.bookingItemData.net_price=timRoundNum(P),q.bookingItemData.pickup_price=0,q.bookingItemData.dropoff_price=0,q.bookingItemData.discount_price=timRoundNum(0),q.bookingItemData.subtotal_price=timRoundNum(C),q.bookingItemData.tax_price_percentage=S,q.bookingItemData.tax_price=timRoundNum(L),q.bookingItemData.tax_exoneration_price_percentage=N,q.bookingItemData.tax_exoneration_price=timRoundNum(O),q.bookingItemData.net_tax_price_percentage=A,q.bookingItemData.net_tax_price=timRoundNum(w),q.bookingItemData.total_price=timRoundNum(H);var F=m?q.bookingItemData.total_price:q.bookingItemData.subtotal_price;x.is_available&&x.isCutOffValid?(D=g>=x.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(q.bookingItemData)+")'>"+t.book+"</a>":'<span class="tim_error_input_msg"><b>'+t.errorMinPaxRequired+": "+x.min_pax_required+"</b></span>",v=!0):(D='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",h=" tim_text_disabled"),E.day&&(b=!0),f+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+c+"</span>",f+=l?timFormatHour(x.departure):h?"-":'<input type="text" id="departureTime" name="departureTime" class="timepicker" />',f+="</div>";var M=t.hours,j=0<F?J+timCurrencyFormat(F):"-";f+='<div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+x.duration+" <small>"+M+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+j+'</div><div class="tim-book">'+D+"</div>",f+="</div>"}else f+='<div class="tim-option-content"><b>* '+t.errorSelectEarlierDate+"</b></div>";if(i+='<div class="tim-options-wrapper"><div class="tim-option-body">'+f+"</div></div>",!v&&b){I.push(y.value);var U=increaseDate(y.value,1);y.value=U,document.getElementById("unavailableDates").value=JSON.stringify(I),jQuery("#timFrom").datepicker("option","beforeShowDay",timUnavailableProductDates).datepicker("refresh")}}else i='<div style="text-align:center;"><b>No rates found.</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTransportationSchedules").innerHTML=i,l||setTimePicker("timepicker"),Q.style.opacity=1})}function timCheckTransportationRatesEdit(e,L,O){var t=document.getElementById("timPickupPlaceId"),i=t.value;if(t.classList.remove("tim_error_input"),!i||null==i)return t.classList.add("tim_error_input"),t.focus(),!1;var a=document.getElementById("timDropOffPlaceId"),n=a.value;if(a.classList.remove("tim_error_input"),!n||null==n)return a.classList.add("tim_error_input"),a.focus(),!1;var o,r,m=document.forms.tim_update_cart;if(r=document.getElementById("departureTime").value)o=document.getElementById("timScheduleId").value,r=timConvertTimeToDB(r);else{var l=m.elements.schedule.value.split("-");o=l[0],r=l[1]}L.bookingItemData.booking_item_id=e,L.bookingItemData.transportation_schedule_id=o,L.bookingItemData.departure_time=r,L.bookingItemData.pickup_place_id=i,L.bookingItemData.dropoff_place_id=n;var w=document.getElementById("timAvailabilityResult");w.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,L,function(e){if("false"==e)return!1;var t=timLabels,i=JSON.parse(e);if(i.error){var a='<br /><div class="tim_alert tim_alert_danger"><b>'+e.error+"</b></div>";w.innerHTML=a}else{var n=i.transportation_schedules,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded,l=i.booking,c=n.date_rates,d=L.bookingItemData.adults,s=L.bookingItemData.children,u=L.bookingItemData.infants,p=L.bookingItemData.seniors,_=d+s+u+p;L.bookingItemData.quantity=1;var g="per_service";"fixed"===L.scheduleType&&(L.bookingItemData.quantity=_,g="per_person",L.bookingItemData.adult_price=0<d?applyExchangeRateConversion(c.adult_price,r):0,L.bookingItemData.child_price=0<s?applyExchangeRateConversion(c.child_price,r):0,L.bookingItemData.infant_price=0<u?applyExchangeRateConversion(c.infant_price,r):0,L.bookingItemData.senior_price=0<p?applyExchangeRateConversion(c.senior_price,r):0);var v=setDayPrice(c,g,d,s,u,p,r),b=setBasePrice(v,m,o),I=b*(c.client_commission_percentage/100),y=b-I,f=applyExchangeRateConversion(n.pickup_price,r),k=applyExchangeRateConversion(n.dropoff_price,r),D=0,x=y+f+k-D,h=getProductTaxesTotalPercentage(o),E=getProductTaxesTotalExonerationPercentage(o),B=h-E;l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?x-=D=x*(l.discount_coupon.value/100):x=(v+f+k-(D=applyExchangeRateConversion(l.discount_coupon.value,r)))/(B/100+1)),L.bookingItemData.sale_taxes=setProductTaxesAmounts(x,o);var R=getProductTaxesTotalAmount(L.bookingItemData.sale_taxes),T=getProductTaxesTotalExonerationAmount(L.bookingItemData.sale_taxes),P=R-T,C=x+P;L.bookingItemData.item_price=timRoundNum(v),L.bookingItemData.base_price=timRoundNum(b),L.bookingItemData.commission_price_percentage=c.client_commission_percentage,L.bookingItemData.commission_price=timRoundNum(I),L.bookingItemData.net_price=timRoundNum(y),L.bookingItemData.pickup_price=f,L.bookingItemData.dropoff_price=k,L.bookingItemData.discount_price=timRoundNum(D),L.bookingItemData.subtotal_price=timRoundNum(x),L.bookingItemData.tax_price_percentage=h,L.bookingItemData.tax_price=timRoundNum(R),L.bookingItemData.tax_exoneration_price_percentage=E,L.bookingItemData.tax_exoneration_price=timRoundNum(T),L.bookingItemData.net_tax_price_percentage=B,L.bookingItemData.net_tax_price=timRoundNum(P),L.bookingItemData.total_price=timRoundNum(C);var S=m?L.bookingItemData.total_price:L.bookingItemData.subtotal_price,N=L.bookingItemData.pickup_price+L.bookingItemData.dropoff_price,A='<div class="tim_align_right" style="font-size:14px;">';N&&(A=m?"<br />"+A+"(+) "+t.transportation+"<br />":"<br />"+A+"<hr />"+t.subtotal+": <b>"+O+L.bookingItemData.net_price+"</b><br /><small>(+) "+t.transportation+":</small> "+O+N+"<br />");A=A+"<br /><hr /><b>"+t.totalPrice+": "+O+timCurrencyFormat(S)+"</b><br /><br /><button type='button' class='tim-btn tim-btn-lg' onclick='timUpdateItemFromOrder("+JSON.stringify(L.bookingItemData)+")'>"+t.updateOrder+"</button></div>";w.innerHTML=A}timHideSpinner("tim_spinner")})}function timSearchTransportation(){setButton();var e=0;if(e=validateInput("timDepartureLocation",e),e=validateInput("timArrivalLocation",e),e=validateInput("timFrom",e),e=validateInput("timDepartureTime",e))return setButton(1),!1;var t=document.getElementById("timUserCurrency").value,P=document.getElementById("timUserCurrencySymbol").value,i=(new Date).toISOString(),o=document.getElementById("timFromDB").value,C=parseInt(document.getElementById("timAdults").value),S=parseInt(document.getElementById("timChildren").value),N=parseInt(document.getElementById("timInfants").value),a={action:"search_transportations_rates_api",f_nonce:timData.f_nonce,currentUTCDate:i,lang:document.getElementById("timCL").value,currency_id:t,departureLocationId:document.getElementById("timDepartureLocation").value,arrivalLocationId:document.getElementById("timArrivalLocation").value,start_date:o,departure_time:document.getElementById("timDepartureTime").value,adults:C,children:S,infants:N};timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,a,function(e){timHideSpinner("tim_spinner"),setButton(1);var x=timLabels,t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),a=i.transportations,h=i.documentDateExchangeRate,E=i.taxesIncluded,B={booking_type:"transportation",start_date:o,adults:C,children:S,infants:N,seniors:0,exchange_rate_value:h.exchangeRateValue},n="";if(0<a.length){var R,T=C+S+N+0;a.forEach(function(e){B.transportation_id=e.transportation_id,B.transportation_content_id=e.transportation_content_id,B.provider_id=e.provider_id,B.priceListIdByProvider=e.priceListIdByProvider;var v,b,I,y,f=e.saleTaxes,k=e.schedule_type,D="";e.transportation_schedules.forEach(function(e){if(B.subtotal_price=0,e.is_available&&e.isCutOffValid){y=e.date_rates,B.transportation_schedule_id=e.id,B.departure_time=e.departure,B.quantity=1,R="per_service","fixed"===k&&(B.quantity=T,R="per_person",B.adult_price=0<C?applyExchangeRateConversion(y.adult_price,h):0,B.child_price=0<S?applyExchangeRateConversion(y.child_price,h):0,B.infant_price=0<N?applyExchangeRateConversion(y.infant_price,h):0,B.senior_price=0);var t=setDayPrice(y,R,C,S,N,0,h),i=setBasePrice(t,E,f),a=i*(y.client_commission_percentage/100),n=i-a,o=0+n,r=getProductTaxesTotalPercentage(f),m=getProductTaxesTotalExonerationPercentage(f),l=r-m;B.sale_taxes=setProductTaxesAmounts(o,f);var c=getProductTaxesTotalAmount(B.sale_taxes),d=getProductTaxesTotalExonerationAmount(B.sale_taxes),s=c-d,u=o+s;B.item_price=timRoundNum(t),B.base_price=timRoundNum(i),B.commission_price_percentage=y.client_commission_percentage,B.commission_price=timRoundNum(a),B.net_price=timRoundNum(n),B.pickup_price=0,B.dropoff_price=0,B.discount_price=timRoundNum(0),B.subtotal_price=timRoundNum(o),B.tax_price_percentage=r,B.tax_price=timRoundNum(c),B.tax_exoneration_price_percentage=m,B.tax_exoneration_price=timRoundNum(d),B.net_tax_price_percentage=l,B.net_tax_price=timRoundNum(s),B.total_price=timRoundNum(u);var p=E?B.total_price:B.subtotal_price;b=T>=e.min_pax_required?"<a href='javascript:void(0)' class='tim-btn' onclick='timAddItemToOrder("+JSON.stringify(B)+")'>"+x.book+"</a>":'<span class="tim_error_input_msg"><b>'+x.errorMinPaxRequired+": "+e.min_pax_required+"</b></span>"}else b='<br /><span class="tim_label tim_label_md tim_label_danger">'+x.errorNotAvailable+"</span>",0;v="fixed"===k?x.fixed:x.open,I="fixed"===k?timFormatHour(e.departure):document.getElementById("timDepartureTime").value;var _=x.hours,g=0<p?P+timCurrencyFormat(p):"-";D+='<tr><td class="tim_align_center">'+v+'</td><td class="tim_align_center">'+e.duration+" <small>"+_+'</small></td><td class="tim_align_center">'+I+'</td><td class="tim_align_center"><b>'+g+'</b></td><td class="tim_align_center">'+b+"</td>"}),n+='<h3 class="tim_align_center">'+e.transportation_content_name+'</h3><table class="tim_table tim_table_no_border"><thead><tr><th class="tim_align_center">'+x.scheduleType+'</th><th class="tim_align_center">'+x.duration+'</th><th class="tim_align_center">'+x.pickupTime+'</th><th class="tim_align_center" style="width: 100px;">'+x.price+'</th><th class="tim_align_center" style="width: 210px;"></th></tr></thead><tbody>'+D+"</tbody></table><br />"})}else n='<div style="text-align:center;"><b>No rates found.</b></div>';t+=n}document.getElementById("timTransportations").innerHTML=t})}var timRoomsSelected;function timCheckHotelAvailability(){var e=0;e=validateInput("timTo",e),e=validateInput("timFrom",e);var t=getTodayDate(),i=document.getElementById("timFromDB").value,a=document.getElementById("timToDB").value;if(i&&(i<t||a<=i))alert("Invalid date");else{if(e)return!1;var E=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",n=document.getElementById("timUserCurrency").value,B=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),o=(new Date).toISOString(),R={action:"check_hotel_availability_api",f_nonce:timData.f_nonce,currentUTCDate:o,lang:document.getElementById("timCL").value,currency_id:n,bookingItemData:{booking_type:"hotel",start_date:i,end_date:a,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value}};if(E){var T=timBookedRooms;R.booking_id=document.getElementById("timBookingId").value,R.price_list_id=document.getElementById("timBookingPriceListId").value,R.bookingItemData.booking_item_id=E}else document.getElementById("timSPLAccepted")&&(R.spl_accepted=document.getElementById("timSPLAccepted").value);var P=timLabels,C=document.getElementById("timAvailabilityResult");C.style.opacity=.5,document.getElementById("timAvailabilityResultMsg").style.display="none",timShowSpinner("tim_travel_form_spinner"),jQuery.post(timData.ajaxurl,R,function(e){var t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),a=i.hotel_rooms,n={saleTaxes:i.saleTaxes,documentDateExchangeRate:i.documentDateExchangeRate,taxesIncluded:i.taxesIncluded,priceListIdByProvider:i.priceListIdByProvider,booking:i.booking};R.spl_accepted&&(n.spl_accepted=!0),timRoomsSelected=[];for(var o,r,m,l,c,d,s,u,p,_,g="",v="",b="",I="",y="",f="",k=0;k<a.length;k++){if(r=(o=a[k]).id,m=o.min_availability,s="",p=2,_=u=0,E&&0<o.date_rates.length){for(var D=0;D<T.length;D++)if(T[D].id===r){var x=(s=T[D]).unitsPerRoom;u=s.unitsPerRoom,p=s.units[0].adults,_=s.units[0].children;break}m+=x}if((v="")!==o.logo.url&&null!==o.logo.url&&(v+='<img src="'+o.logo.url+'" alt="'+o.name+'" class="tim-table-product-image" />'),l=o.bed_configuration?" ("+o.bed_configuration+")":"",v+='<div class="tim_table_td_title">'+o.name+'</div><i class="fa fa-bed"></i> <b>'+o.occupancy_type.name+"</b>"+l+"<br />",o.wifi&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.wifi+"</span>"),o.not_smoking&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.notSmoking+"</span>"),b="",0<m&&(b=B+timCurrencyFormat(o.price_from)),m<5&&(b+='<div style="font-size: 11px; color: #f00;">',b+=0<m?P.only+" <b>"+m+"</b> "+P.left:P.notAvailable,b+="</div>"),I='<div class="tim_pax_selector">',I+="<label>"+P.rooms+"</label>",0<m+u){for(d=9<m?9:m,I+="<select id='timUnitsPerRoom_"+r+"'",I+=" onchange='timAddHotelRoomUnit("+JSON.stringify(o)+", "+JSON.stringify(s)+", true, "+JSON.stringify(n)+")' class='tim_select_highlighted'>",c=0;c<=d;c++)I+='<option value="'+c+'"'+(c===u?" selected":"")+">"+c+"</option>";I+="</select>"}else I+="-";if(I+="</div>",y='<div class="tim_pax_selector">',y+="<label>"+P.adults+"</label>",0<m+u){for(y+="<select id='timAdults_"+r+"[0]' name='timAdults_"+r+"[0]' disabled",y+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(o)+", 0, "+JSON.stringify(n)+")'>",c=1;c<=o.max_occupancy;c++)y+='<option value="'+c+'"'+(c===p?" selected":"")+">"+c+"</option>";y+="</select>"}else y+="-";if(y+="</div>",f='<div class="tim_pax_selector">',f+="<label>"+P.children+"</label>",0<m+u&&2<o.max_occupancy&&o.children_allowed){for(f+="<select id='timChildren_"+r+"[0]' name='timChildren_"+r+"[0]' disabled",f+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(n)+")'>",c=0;c<=o.max_children_occupancy;c++)f+='<option value="'+c+'"'+(c===_?" selected":"")+">"+c+"</option>";f+="</select>"}else f+="-";f+="</div>";var h="-";o.children_allowed&&(h='<div title="test"><i class="fa fa-child"></i> '+o.max_children_occupancy+"</div>"),g+='<tr class="tim_table_tr_align_top"><td>'+v+'</td><td data-th="'+P.priceFrom+'">'+b+'</td><td data-th="'+P.max+'"><i class="fa fa-user"></i> '+o.max_occupancy+h+'</td><td data-th="'+P.rooms+'"><div class="tim_room_selector_wrapper"><div class="tim_rooms_selector">'+I+'</div><div class="tim_paxes_selector"><div>'+y+f+'</div><div id="timAdditionalPaxContainer_'+r+'"></div></div></div></td></tr>'}t='<div class="tim_clr"><div class="tim_col_9"><table class="tim_table tim_table_no_border tim_table_align_top"><thead><tr><th>'+P.roomType+'</th><th style="width: 100px;" class="tim_align_center">'+P.priceFrom+'</th><th style="width: 60px;" class="tim_align_center">'+P.max+'</th><th style="width: 210px;" class="tim_align_center">'+P.rooms+"</th></tr></thead><tbody>"+g+'</tbody></table></div><div class="tim_col_3"><div class="tim-totals-box-wrapper"><div class="tim-totals-box-title">'+P.accommodations+'</div><div class="tim-totals-box"><div id="timTotalsBoxResult">'+P.enterOneRoom+"</div></div></div></div></div>"}if(timHideSpinner("tim_travel_form_spinner"),C.style.opacity=1,C.innerHTML=t,E&&0<o.date_rates.length){for(k=0;k<a.length;k++){r=(o=a[k]).id;for(D=0;D<T.length;D++)if(T[D].id===r){s=T[D],document.getElementById("timUnitsPerRoom_"+r).value=s.unitsPerRoom,timAddHotelRoomUnit(o,s,!1,n);break}}calculateHotelRoomsTotalPrice(n)}})}}function timAddHotelRoomUnit(e,t,i,a){var n,o=e.id,r=parseInt(document.getElementById("timUnitsPerRoom_"+o).value),m="",l="",c="",d=(timLabels,!(0<r));if(document.querySelector('[name="timAdults_'+o+'[0]"]').disabled=d,document.querySelector('[name="timChildren_'+o+'[0]"]')&&(document.querySelector('[name="timChildren_'+o+'[0]"]').disabled=d),0===r)timRemoveItemFromArray(timRoomsSelected,"id",o);else{var s=timFindItemInArray(timRoomsSelected,"id",o);s?s.unitsPerRoom=r:(e.unitsPerRoom=r,timRoomsSelected.push(e))}if(1<r)for(var u,p,_=1;_<r;_++){for(u=t&&t.units[_]?t.units[_].adults:2,p=t&&t.units[_]?t.units[_].children:0,l='<div class="tim_pax_selector">',l+="<select id='timAdults_"+o+"["+_+"]' name='timAdults_"+o+"["+_+"]'",l+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(e)+", "+_+", "+JSON.stringify(a)+")'>",n=1;n<=e.max_occupancy;n++)l+='<option value="'+n+'"'+(n===u?" selected":"")+">"+n+"</option>";if(l+="</select>",l+="</div>",c='<div class="tim_pax_selector">',2<e.max_occupancy&&e.children_allowed){for(c+="<select id='timChildren_"+o+"["+_+"]' name='timChildren_"+o+"["+_+"]'",c+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(a)+")'>",n=0;n<=e.max_children_occupancy;n++)c+='<option value="'+n+'"'+(n===p?" selected":"")+">"+n+"</option>";c+="</select>"}else c+="<label>-</label>";m+="<div>"+l+(c+="</div>")+"</div>"}document.getElementById("timAdditionalPaxContainer_"+o).innerHTML=m,i&&calculateHotelRoomsTotalPrice(a)}function timCheckHotelRoomUnitPax(e,t,i){var a=e.id,n=document.querySelector('[name="timAdults_'+a+"["+t+']"]').value;if(2<e.max_occupancy&&e.children_allowed){var o=document.querySelector('[name="timChildren_'+a+"["+t+']"]'),r=parseInt(e.max_occupancy)-parseInt(n),m=r>e.max_children_occupancy?e.max_children_occupancy:r;if(0<m){for(var l=o.length;l<=m;l++){var c=new Option(l,l);o.add(c,void 0)}if(o.length-1>=m){for(l=o.length-1;m<l;l--)o.remove(l);o.value>m&&(o.value=0)}}else o.innerHTML='<option value="0" selected>0</option>'}calculateHotelRoomsTotalPrice(i)}function calculateHotelRoomsTotalPrice(e){for(var t,i,a,n,o,r,m,l=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",c=document.getElementById("timFromDB").value,d=document.getElementById("timToDB").value,s=(document.getElementById("timUserCurrency").value,document.getElementById("timUserCurrencyCode").value),u=document.getElementById("timUserCurrencySymbol").value,p=timParseDate(c),_=timParseDate(d),g=timGetDiffInDays(p,_),v=totalPricePerRoom=0,b=0,I=0,y=0,f=0,k=0,D=!1,x=[],h="",E=0;E<timRoomsSelected.length;E++)if(o=timRoomsSelected[E],r=o.id,0<o.unitsPerRoom){for(v+=o.unitsPerRoom,m=0;m<o.unitsPerRoom;m++)n=m+1,i=parseInt(document.querySelector('[name="timAdults_'+r+"["+m+']"]').value)||0,a=document.querySelector('[name="timChildren_'+r+"["+m+']"]')?parseInt(document.querySelector('[name="timChildren_'+r+"["+m+']"]').value):0,b+=i,I+=a,o.date_rates.forEach(function(e){y=getRatePerRoomOccupancy(i,a,e,"price"),x.push({day:e.day,unit_number:n,adults:i,children:a,item_price:y,hotel_id:document.getElementById("timHotelId").value,hotel_room_id:r}),f+=y,k=e.client_commission_percentage});h+=o.name+" (x"+o.unitsPerRoom+")<br />"}var B=timLabels;if(0<v){var R={booking_type:"hotel",start_date:c,end_date:d,quantity:v,adults:b,children:I,infants:0,seniors:0,total_rooms:v,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value,booking_item_hotel_dates:x};e.spl_accepted&&(R.spl_accepted=!0);var T=e.saleTaxes,P=e.documentDateExchangeRate,C=e.taxesIncluded,S=e.booking,N=applyExchangeRateConversion(f,P),A=setBasePrice(N,C,T),L=A*(k/100),O=A-L,w=0,H=0+O-w,F=getProductTaxesTotalPercentage(T),M=getProductTaxesTotalExonerationPercentage(T),j=F-M;S&&S.discount_coupon_id&&("percentage"==S.discount_coupon.discount_type?H-=w=H*(S.discount_coupon.value/100):H=(N+0+0-(w=applyExchangeRateConversion(S.discount_coupon.value,P)))/(j/100+1)),R.sale_taxes=setProductTaxesAmounts(H,T);var U=getProductTaxesTotalAmount(R.sale_taxes),q=getProductTaxesTotalExonerationAmount(R.sale_taxes),J=U-q,Q=H+J;R.item_price=timRoundNum(N),R.base_price=timRoundNum(A),R.commission_price_percentage=k,R.commission_price=timRoundNum(L),R.net_price=timRoundNum(O),R.pickup_price=0,R.dropoff_price=0,R.discount_price=timRoundNum(w),R.subtotal_price=timRoundNum(H),R.tax_price_percentage=F,R.tax_price=timRoundNum(U),R.tax_exoneration_price_percentage=M,R.tax_exoneration_price=timRoundNum(q),R.net_tax_price_percentage=j,R.net_tax_price=timRoundNum(J),R.total_price=timRoundNum(Q);var V=C?R.total_price:R.subtotal_price;R.exchange_rate_value=P.exchangeRateValue,R.priceListIdByProvider=e.priceListIdByProvider;var z="";z=l?(R.booking_item_id=l,"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timUpdateItemFromOrder("+JSON.stringify(R)+")' disabled>"+B.updateOrder+"</button>"):"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timAddItemToOrder("+JSON.stringify(R)+")' disabled>"+B.bookNow+"</button>";B=timLabels;var Y="";0<R.tax_price_percentage&&(Y+='<div style="tim-totals-price-note">+'+B.taxes.toLowerCase()+"</div>");var G="";I&&(G=" / <b>"+B.children+":</b> "+I),t="<ul><li>"+h+"</li><li>&nbsp;</li><li><b>"+B.adults+":</b> "+b+G+"</li><li><b>"+B.roomNights+":</b> "+g+'</li><li class="tim-totals-price"><div class="tim-totals-price-label">'+B.totalPrice+'</div><div class="tim-totals-price-amount">'+s+" <span>"+u+timCurrencyFormat(V)+"</span></div>"+Y+"</li></ul>"+z}else t=B.enterOneRoom,D=!0;var K=document.querySelector(".tim-totals-box-wrapper");K.classList.add("tim-transition-in"),setTimeout(function(){K.classList.remove("tim-transition-in"),K.classList.add("tim-transition-out")},500),document.getElementById("timTotalsBoxResult").innerHTML=t,document.getElementById("timAddItemBtn")&&(document.getElementById("timAddItemBtn").disabled=D)}function timCheckPackageRates(){}function timCheckPackageForm(){setButton();var e=0,t=document.getElementById("timFromDB").value,i=document.getElementById("timAdults").value,a=document.getElementById("timChildren").value,n=document.getElementById("timInfants").value,o=document.getElementById("timCustomerName").value,r=document.getElementById("timCustomerEmail").value,m=getTodayDate();if(t&&t<=m)alert("Invalid date");else{if(e=validateEmail("timCustomerEmail",e),e=validateInput("timCustomerName",e),e=validateInput("timAdults",e),e=validateInput("timFrom",e))return setButton(1),!1;var l={action:"check_package_request_api",f_nonce:timData.f_nonce,package_id:document.getElementById("timPackageId").value,package_date:t,adults:parseInt(i),children:parseInt(a),infants:parseInt(n),name:o,email:r,lang:document.getElementById("timCL").value};timShowSpinner("tim_travel_form_spinner"),timPostAjax(timData.ajaxurl,l,function(e){if("false"==e)return!1;var t=document.getElementById("timRequestPackageFormMsg"),i=document.getElementById("timLabelRequestPackageSent").value;t.innerHTML='<br /><div class="tim_alert tim_alert_lg tim_alert_success">'+i+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timRequestPackageFormMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timFrom").value="",document.getElementById("timAdults").value="",document.getElementById("timChildren").value=0,document.getElementById("timInfants").value=0,document.getElementById("timCustomerName").value="",document.getElementById("timCustomerEmail").value="",timHideSpinner("tim_spinner")})}}function setDayPrice(e,t,i,a,n,o,r){return applyExchangeRateConversion("per_person"===t?i*e.adult_price+a*e.child_price+n*e.infant_price+o*e.senior_price:e.service_price,r)}function setBasePrice(e,t,i){return t&&i?e/((i.reduce(function(e,t){return e+t.value},0)-i.reduce(function(e,t){return t.exoneration?t.exoneration.percentage:0},0))/100+1):e}function setProductTaxesAmounts(t,e){return 0===e.length?e:e.map(function(e){return e.amount="percentage"===e.computation_type?t*(e.value/100):e.value,"percentage"===e.computation_type&&e.exoneration&&(e.exoneration.amount=t*(e.exoneration.percentage/100)),e})}function getProductTaxesTotalPercentage(e){return 0===e.length?0:e.reduce(function(e,t){return e+t.value},0)}function getProductTaxesTotalAmount(e){return 0===e.length?0:timRoundNum(e.reduce(function(e,t){return e+t.amount},0))}function getProductTaxesTotalExonerationPercentage(e){return 0===e.length?0:e.reduce(function(e,t){return e+(t.exoneration?t.exoneration.percentage:0)},0)}function getProductTaxesTotalExonerationAmount(e){return 0===e.length?0:timRoundNum(e.reduce(function(e,t){return e+(t.exoneration?t.exoneration.amount:0)},0))}function applyExchangeRateConversion(e,t){if(0===e)return e;var i;switch(t.conversion){case"multiply":i=e*t.value;break;case"divide":i=e/t.value;break;default:i=e*t.value[0]/t.value[1]}return timRoundNum(i)}function getRatePerRoomOccupancy(e,t,i,a){var n=0;switch(e){case 1:n=i["single_"+a];break;case 2:n=i["double_"+a];break;case 3:n=i["triple_"+a];break;case 4:n=i["quadruple_"+a];break;default:n=i["quadruple_"+a]+(e-4)*i["additional_person_"+a]}return n+=t*i["child_"+a]}

// Payments
function timSelectPaymentGateway(t,e){var n={action:"load_payment_form",f_nonce:timData.f_nonce,option:t,lang:e};timShowSpinner("tim_travel_form_spinner");var m=document.getElementById("timPaymentBox");m.innerHTML="",timPostAjax(timData.ajaxurl,n,function(e){m.innerHTML=e,"bac_ecommerce"===t?document.getElementById("ccnumber").focus():"paypal"===t&&loadPaypalPayment(),document.querySelector(".tim-policies").style.display="inline-block",timHideSpinner("tim_travel_form_spinner")})}function timProcessBacEcommercePayment(){setButton();var e=0;if(e=validateCreditCardNumber("ccnumber",e=timValidateClientDetails()),e=validateCreditCardExpirationDate("expDate",e=validateInput("cvv",e)),e=validateInput("ccName",e))return setButton(1),!1;var t=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),n={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:t,pg:"bac"},m=document.getElementById("timClientId").value;m&&(n.client_id=m),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bac";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bac_endpoint").value,n.submit()})}function timProcessBcrEcommercePayment(){setButton();if(timValidateClientDetails())return setButton(1),!1;var e=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),t={action:"process_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:e,pg:"bcr"},n=document.getElementById("timClientId").value;n&&(t.client_id=n),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bcr";document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bcr_endpoint").value,n.submit()})}function timProcessPayLaterPayment(){setButton();if(timValidateClientDetails())return setButton(1),!1;var n=document.getElementById("timCL").value,e={action:"process_pay_later_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:n,payment_gateway:document.getElementById("timPaymentGateway").value},t=document.getElementById("timClientId").value;t&&(e.client_id=t);var m=document.getElementById("timCustomerBookingFormErrorMsg");m.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,e,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).errors)setButton(1),m.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=done&oid="+e.id+"&onm="+e.booking_number+"&lng="+n}})}function loadPaypalPayment(){var n=document.getElementById("timCL").value,e=(function(e){var t;switch(e){case"es":t="es_ES";break;case"de":t="de_DE";break;default:t="en_US"}}(n),document.getElementById("timApiUrl").value),m=document.getElementById("timBookingId").value,a=document.getElementById("timSubdomain").value,i=document.getElementById("timCompanyApiKey").value,o=document.getElementById("timDomainApiKey").value,t=e+"/create_paypal_payment",u=e+"/execute_paypal_payment",d=document.getElementById("timPaymentGateway").value,l=document.getElementById("timCustomerBookingFormErrorMsg");function r(e){var t=!0;return document.getElementById("timGuestName").value&&document.getElementById("timGuestLastName").value&&function(){var e=!0,t=document.getElementById("timGuestEmail").value;if(t){/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(t)||(e=!1)}else e=!1;return e}()&&function(){var e=!0,t=document.getElementById("timGuestPhoneNumber").value;if(t){/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(t)||(e=!1)}else e=!1;return e}()&&document.getElementById("timGuestCountry").value&&document.getElementById("timGuestTaxIdCode").value&&document.getElementById("timGuestTaxIdNumber").value||(t=!1),t?e.enable():e.disable()}l.innerHTML="";var c=document.getElementById("timClientId").value;paypal.Buttons({style:{size:"medium",color:"blue",shape:"pill",label:"checkout"},validate:function(e){var t;if(document.getElementById("timIsClientLogged").value)return e.enable();r(e),t=function(){r(e)},jQuery("#timGuestName").on("change",t),jQuery("#timGuestLastName").on("change",t),jQuery("#timGuestEmail").on("change",t),jQuery("#timGuestPhoneNumber").on("change",t),jQuery("#timGuestCountry").on("change",t),jQuery("#timGuestTaxIdCode").on("change",t),jQuery("#timGuestTaxIdNumber").on("change",t)},onClick:function(){return setButton(),!timValidateClientDetails(0)||(setButton(1),!1)},createOrder:function(){var e={sub:a,cak:i,dak:o,id:m,payment_gateway:d,email:document.getElementById("timGuestEmail").value,lang:n};return c&&(e.client_id=c),fetch(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return e.id})},onApprove:function(e){var t={orderID:e.orderID,sub:a,cak:i,dak:o,id:m,payment_gateway:d,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:n};return c&&(t.client_id=c),timShowSpinner("tim_spinner"),fetch(u,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(t){if(t.errors)return timHideSpinner("tim_spinner"),l.innerHTML='<div class="tim_alert tim_alert_danger">'+t.errors+"</div><br />",void(t.emailInUse&&document.getElementById("timGuestEmail").classList.add("tim_error_input"));var e={action:"paypal_order_completed",f_nonce:timData.f_nonce,bookingItemData:t};document.getElementById("tim_checkout_form").reset(),timPostAjax(timData.ajaxurl,e,function(){timHideSpinner("tim_spinner");var e=document.getElementById("timHomeUrl").value+"order/";window.location=e+"?act=done&oid="+t.id+"&onm="+t.booking_number+"&lng="+n})})}}).render("#paypal-button")}function timValidateClientDetails(e){return document.getElementById("timIsClientLogged").value||(e=validateInput("timGuestName",e),e=validateInput("timGuestLastName",e),e=validateInput("timGuestCountry",e),e=validatePhone("timGuestPhoneNumber",e),e=validateEmail("timGuestEmail",e),e=validateInput("timGuestTaxIdCode",e),e=validateTaxIdNumber("timGuestTaxIdNumber",e)),e}function validateCreditCardNumber(e,t){var n=document.getElementById(e);n.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove();var m=0;if(""==n.value)m=1;else{var a="";n.value.match(/^(?:4[0-9]{12}(?:[0-9]{3})?)$/)?a="Visa":n.value.match(/^(?:5[1-5][0-9]{14})$/)?a="Mastercad":n.value.match(/^(?:3[47][0-9]{13})$/)?a="American Express":n.value.match(/^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/)?a="Discover":n.value.match(/^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/)?a="Dinersclub":n.value.match(/^(?:(?:2131|1800|35\d{3})\d{11})$/)?a="Jcb":m=1}return m?(n.classList.add("tim_error_input"),1):(document.getElementById("ccType").value=a,t)}function validateCreditCardExpirationDate(e,t){var n=document.getElementById("expMonth"),m=document.getElementById("expYear");n.classList.remove("tim_error_input"),m.classList.remove("tim_error_input");var a=(new Date).getDate(),i=n.value+"/"+a+"/"+m.value,o=setCurrentDate();if(document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),Date.parse(o)>Date.parse(i))return n.classList.add("tim_error_input"),m.classList.add("tim_error_input"),1;var u=n.value+m.value.substr(-2);return document.getElementById("ccexp").value=u,t}function setCurrentDate(){var e=new Date,t=e.getDate();t<10&&(t="0"+t);var n=e.getMonth()+1;return n<10&&(n="0"+n),e=n+"/"+t+"/"+e.getFullYear()}function timApplyDiscountCoupon(){var n=document.getElementById("timApplyCodeBtn");n.disable=!0;var e=0;if(e=validateInput("timCouponCode",e))return n.disable=!1;var t={action:"apply_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,coupon_code:document.getElementById("timCouponCode").value,lang:document.getElementById("timCL").value},m=document.getElementById("timCouponCodeInvalid");m.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){if(timHideSpinner("tim_spinner"),"error"!==e)document.getElementById("timCheckoutTotals").innerHTML=e;else{n.disable=!1;var t=document.getElementById("timLabelErrorCoupon").value;m.innerHTML='<div class="tim_error_input_msg">'+t+"</div>"}})}function timDeleteDiscountCoupon(){var e={action:"delete_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,e,function(e){"error"!==e&&(document.getElementById("timCheckoutTotals").innerHTML=e)})}

// Timer
var TIM_TIMEOUT_WARNING_ID,TIM_TIMEOUT_NOW_ID,isTimerWarningModalOpened=!1;function timSetBookingTimers(){0!=parseInt(document.getElementById("timBTI").value)&&(document.addEventListener("mousemove",timResetTimer,!1),document.addEventListener("mousedown",timResetTimer,!1),document.addEventListener("keypress",timResetTimer,!1),document.addEventListener("touchmove",timResetTimer,!1),document.addEventListener("onscroll",timResetTimer,!1),timStartBookingTimer())}function timStartBookingTimer(){var e=document.getElementById("timTO").value;isTimerWarningModalOpened=!1,TIM_TIMEOUT_WARNING_ID=setTimeout("timExecuteTimeOutWarning()",60*e*1e3)}function timResetTimer(){isTimerWarningModalOpened||(timClearTimers(),timStartBookingTimer())}function timClearTimers(){clearTimeout(TIM_TIMEOUT_WARNING_ID),clearTimeout(TIM_TIMEOUT_NOW_ID)}function timExecuteTimeOutWarning(){var e=document.getElementById("timBID").value;clearTimeout(TIM_TIMEOUT_WARNING_ID),TIM_TIMEOUT_NOW_ID=setTimeout("timExecuteTimeOutNow('"+e+"')",6e4),document.createElement("div").id="booking-inactivity";var t={action:"open_modal",f_nonce:timData.f_nonce,option:"booking-inactivity",id:e};timPostAjax(timData.ajaxurl,t,function(e){openModal(e,{autoSize:!0,preventCloseOutside:!0,hideCloseBtn:!0})}),isTimerWarningModalOpened=!0}function timExecuteTimeOutNow(e){timCancelBooking(e,!0)}function timContinueWithBooking(e){jQuery.fancybox.close("booking-inactivity"),timClearTimers(),timSetBookingTimers(e)}function timCancelBooking(e,t){var i={action:"delete_booking_api",f_nonce:timData.f_nonce,bookingId:e,lang:document.getElementById("timCL").value};t&&(i.deletedBySystem=!0),jQuery.post(timData.ajaxurl,i,function(e){if("false"==e)return!1;timClearTimers(),jQuery.fancybox.close("booking-inactivity"),window.location=document.getElementById("timHomeUrl").value})}