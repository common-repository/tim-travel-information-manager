function timInitializeMap(e,t){null==e&&(e="");var i=document.getElementById("tim_googleMap"+e);if(null!==i&&"undefined"!=typeof google){var n=document.getElementById("timMapType"+e);if(null!==n)"waypoints"===n.value?timGoogleRouteWayPointsMap(i,t):"multiple"===n.value&&timLoadMultiLocationMap(i,t);else{var a=document.getElementById("tim_geoLat"+e).value,o=document.getElementById("tim_geoLng"+e).value,r=document.getElementById("tim_geoZoom"+e).value,m=new google.maps.LatLng(a,o),l={center:m,zoom:parseInt(r),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},d=new google.maps.Map(i,l);new google.maps.Marker({position:m}).setMap(d),google.maps.event.trigger(d,"resize")}}}function timGoogleRouteWayPointsMap(e,t){var i=new google.maps.DirectionsRenderer,n=new google.maps.DirectionsService,a={zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Map(e,a);i.setMap(o),calculateAndDisplayRoute(n,i,t)}function calculateAndDisplayRoute(e,i,t){var n={lat:t.departure.lat,lng:t.departure.lng},a={lat:t.arrival.lat,lng:t.arrival.lng},o=[];if(t.waypoints&&0<t.waypoints.length)for(var r=0;r<t.waypoints.length;r++){var m=t.waypoints[r],l=!!m.stop_on_route;o.push({location:new google.maps.LatLng(m.location.lat,m.location.lng),stopover:l})}e.route({origin:n,destination:a,waypoints:o,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING},function(e,t){"OK"===t?i.setDirections(e):window.alert("Directions request failed due to "+t)})}function timLoadMultiLocationMap(e,t){if(void 0!==navigator.geolocation){coords=timGroupLocations(t);var i={zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(e,i),a=[];for(r=0;r<coords.length;r++)a.push(new google.maps.LatLng(coords[r].lat,coords[r].lng));for(var o=new google.maps.LatLngBounds,r=0;r<a.length;r++){o.extend(a[r]);var m=new google.maps.Marker({map:n,position:a[r]});if(0<coords[r].locations.length){for(var l="",d=0;d<coords[r].locations.length;d++)l+='<li title="Day '+coords[r].locations[d].day_number+" - "+coords[r].locations[d].name+'">'+coords[r].locations[d].day_number+"</li>";new google.maps.InfoWindow({content:'<div class="tim_map_labels"><ul>'+l+"</ul></div>"}).open(n,m)}}new google.maps.Polyline({map:n,path:a,strokeColor:"#0000FF",strokeOpacity:.7,strokeWeight:2}),n.fitBounds(o)}else alert("Your browser doesnt support the Geolocation API")}function timGroupLocations(e){for(var t,i,n,a=[],o=[],r=e.length,m=0;m<r;m++)a[(t=e[m]).lat]||(a[t.lat]={lat:t.lat,lng:t.lng,locations:[]});for(var l in a)for(i=a[l].lat,m=0;m<r;m++)n={day_number:(t=e[m]).day_number,name:t.name},i===t.lat&&a[l].locations.push(n);for(var l in a)o.push(a[l]);var d=a[e[r-1].lat]={lat:e[r-1].lat,lng:e[r-1].lng,locations:[]};return o.push(d),o}function timAjaxContent(e,t){var i={action:"open_modal",f_nonce:timData.f_nonce,option:e,lang:document.getElementById("timCL").value};t&&(i.id=t),timPostAjax(timData.ajaxurl,i,function(e){openModal(e)})}function openModal(e,t){var i={content:e,type:"ajax",autoSize:!1,maxWidth:1100,maxHeight:800,width:"95%",afterShow:function(){timLoadModalSlider()}};t&&(t.preventCloseOutside&&(i.helpers={overlay:{closeClick:!1}}),t.hideCloseBtn&&(i.closeBtn=!1),t.autoSize&&(i.autoSize=!0)),jQuery.fancybox.open(i)}function timLoadModalSlider(){jQuery("div.tim_detail_slider_modal").length&&setTimeout(function(){new Swiper(".tim_detail_slider_modal",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}})},500)}function timLoadSwiper(){new Swiper(".tim-detail-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0}}),new Swiper(".tim-rooms-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),new Swiper(".tim-carrousel-slider",{pagination:".swiper-pagination",nextButton:".swiper-button-next",prevButton:".swiper-button-prev",paginationClickable:!0,grabCursor:!1,spaceBetween:20,slidesPerView:3,breakpoints:{992:{slidesPerView:2,spaceBetween:20},768:{slidesPerView:1,spaceBetween:20},320:{slidesPerView:1,spaceBetween:10}}})}function timTabContent(e,t,i){var n,a,o;for(a=document.getElementsByClassName("tim_tab_content"),n=0;n<a.length;n++)a[n].style.display="none";if(!i){for(o=document.getElementsByClassName("tablink"),n=0;n<a.length;n++)void 0!==o[n]&&(o[n].className=o[n].className.replace(" active",""));e.currentTarget.className+=" active"}document.getElementById(t).style.display="block","timTabMap"==t&&timInitializeMap("Tab")}function timToggleContent(e){var t=document.getElementById(e);"none"===t.style.display?t.style.display="block":t.style.display="none"}function timScrollTo(e){return document.getElementById(e).scrollIntoView({behavior:"smooth"}),!1}function timShowErrorLabelApi(e){var t=document.getElementById("timGuestEmail");t.classList.remove("tim_error_input"),t.classList.add("tim_error_input"),t.insertAdjacentHTML("afterend",'<div id="timGuestEmailErrorMsg" class="tim_error_input_msg">'+e+"</div>"),t.focus()}function timLoadData(e,t){var i={action:e,f_nonce:timData.f_nonce,lang:t||document.getElementById("timCL").value},n=document.getElementById("timLoadDataResult");timPostAjax(timData.ajaxurl,i,function(e){n.innerHTML=e})}function timCheckLoginForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value,i=document.getElementById("timCustomerPassword").value;if(e=validateEmail("timCustomerEmail",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var n={action:"create_client_login_api",f_nonce:timData.f_nonce,email:t,password:i,lang:document.getElementById("timCL").value},a=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),a.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>"):location.reload(),timHideSpinner("tim_spinner")})}function timLogout(){var e={action:"client_logout",f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,e,function(e){location.reload()})}function timCheckSignupForm(){setButton();var e=0,t=document.getElementById("timCustomerName").value,i=document.getElementById("timCustomerLastName").value,n=document.getElementById("timCustomerEmail").value,a=document.getElementById("timCustomerPhoneNumber").value,o=document.getElementById("timCustomerPhoneCode").value,r=document.getElementById("timCustomerCountry").value,m=document.getElementById("timGuestTaxIdCode").value,l=document.getElementById("timGuestTaxIdNumber").value,d=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timGuestTaxIdCode",e),e=validateInput("timGuestTaxIdNumber",e),e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var u=r.split("-")[0],s={action:"create_client_signup_api",f_nonce:timData.f_nonce,name:t,last_name:i,tax_id_code:m,tax_id_number:l,email:n,phone_number:a,phone_code:o,country_id:u,password:d,lang:document.getElementById("timCL").value},c=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,s,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var i in e.errors)t=e.errors[i].join(", ");c.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else location.reload();timHideSpinner("tim_spinner")})}function timSelectCountry(e,t){var i=document.getElementById("tim"+[t]+"PhoneNumber"),n=document.getElementById("tim"+[t]+"PhoneCode");i.value="",n.value="",i.disabled=!e;var a=e.split("-")[1];n.value=a,jQuery("#tim"+[t]+"PhoneNumber").inputmask({mask:"("+n.value+") 9{0,20}",autoUnmask:!0,removeMaskOnSubmit:!0,greedy:!1})}function timCheckPasswordRecoveryForm(){setButton();var e=0,t=document.getElementById("timCustomerEmail").value;if(e=validateEmail("timCustomerEmail",e))return setButton(1),!1;var i={action:"create_client_password_api",f_nonce:timData.f_nonce,email:t,lang:document.getElementById("timCL").value},n=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,i,function(e){if("false"==e)return!1;(e=JSON.parse(e)).errors?(setButton(1),n.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />"):(timLoadData("load_edit_password_form"),document.getElementById("timClientEmail").value=e.email),timHideSpinner("tim_spinner")})}function timCheckUpdatePassword(){setButton();var e=0,t=document.getElementById("timCustomerCode").value,i=document.getElementById("timCustomerPassword").value;if(e=validateInput("timCustomerPassword",e),e=validateInput("timCustomerCode",e))return setButton(1),!1;var n=document.getElementById("timClientEmail").value,a={action:"update_client_password_api",f_nonce:timData.f_nonce,email:n,code:t,password:i,lang:document.getElementById("timCL").value},o=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,a,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors)setButton(1),o.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div>";else{timLoadData("load_login_form");var t=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_success">'+t+".</div><br />"}timHideSpinner("tim_spinner")})}function timCheckUpdateClientProfile(){setButton();var e=0,t=document.getElementById("timCustomerId").value,i=document.getElementById("timCustomerName").value,n=document.getElementById("timCustomerLastName").value,a=document.getElementById("timCustomerEmail").value,o=document.getElementById("timCustomerPhoneNumber").value,r=document.getElementById("timCustomerPhoneCode").value,m=document.getElementById("timCustomerCountry").value;if(e=validateInput("timCustomerCountry",e),e=validateInput("timCustomerLastName",e=validateEmail("timCustomerEmail",e=validatePhone("timCustomerPhoneNumber",e))),e=validateInput("timCustomerName",e))return setButton(1),!1;var l=m.split("-")[0],d={action:"update_client_profile_api",f_nonce:timData.f_nonce,id:t,name:i,last_name:n,email:a,phone_number:o,phone_code:r,country_id:l,lang:document.getElementById("timCL").value},u=document.getElementById("timClientProfileFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,d,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var i in e.errors)t=e.errors[i].join(", ");u.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var n=document.getElementById("timLabelProfileUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+n+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timCloseAlert(e){document.getElementById(e).innerHTML=""}function timCheckUpdateClientPassword(){setButton();var e=0,t=document.getElementById("timCustomerId").value,i=document.getElementById("timCustomerPassword").value;if(document.getElementById("timCustomerPasswordConfirmation").value,e=validateInput("timCustomerPasswordConfirmation",e),e=validatePasswordConfirmation("timCustomerPassword","timCustomerPasswordConfirmation",e=validateInput("timCustomerPassword",e)))return setButton(1),!1;var n={action:"update_client_profile_password_api",f_nonce:timData.f_nonce,id:t,password:i,lang:document.getElementById("timCL").value},a=document.getElementById("timClientPasswordFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){if("false"==e)return!1;if((e=JSON.parse(e)).errors){setButton(1);var t=[];for(var i in e.errors)t=e.errors[i].join(", ");a.innerHTML='<div class="tim_alert tim_alert_danger">'+t+"</div>"}else{var n=document.getElementById("timLabelPasswordUpdated").value;document.getElementById("timCustomerFormSuccessMsg").innerHTML='<div class="tim_alert tim_alert_lg tim_alert_success">'+n+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timCustomerFormSuccessMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timCustomerPassword").value="",document.getElementById("timCustomerPasswordConfirmation").value="",timLoadData("load_client_profile")}timHideSpinner("tim_spinner")})}function timProcessSecondaryPriceList(e){var t={action:"accept_secondary_price_list",f_nonce:timData.f_nonce};timPostAjax(timData.ajaxurl,t,function(){location.reload()})}function validateInput(e,t){var i=document.getElementById(e);if(i.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==i.value||0==i.value){if(i.classList.add("tim_error_input"),document.getElementById(e+"Error")){var n=document.getElementById(e+"Error").value;i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")}t=1}return t}function validateEmail(e,t){var i=document.getElementById(e);if(i.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==i.value){if(i.classList.add("tim_error_input"),document.getElementById(e+"Error")){var n=document.getElementById(e+"Error").value;i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")}t=1}else/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(i.value)||(i.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(n=document.getElementById(e+"Invalid").value,i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")),t=1);return t}function validatePhone(e,t){var i=document.getElementById(e);if(i.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==i.value||0==i.value){if(i.classList.add("tim_error_input"),document.getElementById(e+"Error")){var n=document.getElementById(e+"Error").value;i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")}t=1}else/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(i.value)||(i.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(n=document.getElementById(e+"Invalid").value,i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")),t=1);return t}function validateTaxIdNumber(e,t){var i=document.getElementById(e);if(i.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),""==i.value||0==i.value){if(i.classList.add("tim_error_input"),document.getElementById(e+"Error")){var n=document.getElementById(e+"Error").value;i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")}t=1}else{var a;switch(document.getElementById("timGuestTaxIdCode").value){case"01":a=9;break;case"02":case"03":case"04":a=10;break;case"06":a=9}i.value.length<a&&(i.classList.add("tim_error_input"),document.getElementById(e+"Invalid")&&(n=document.getElementById(e+"Invalid").value,i.insertAdjacentHTML("afterend",'<div id="'+e+'Err" class="tim_error_input_msg">'+n+"</div>")),t=1)}return t}function validatePasswordConfirmation(e,t,i){var n=document.getElementById(e),a=getElementById(t),o=document.getElementById("timClientPasswordFormErrorMsg");if((o.innerHTML="")!=n.value&&""!=a.value&&n.value!=a.value){if(n.className="tim_error_input",a.className="tim_error_input",document.getElementById(id+"Error")){var r=getElementById(id+"Error").value;o.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+r+"</div>"}i=1}return i}function setButton(e){if(void 0!==document.getElementsByClassName("timSendButton")[0]){var t=!e;document.getElementsByClassName("timSendButton")[0].disabled=t}}function timShowSpinner(e){document.getElementsByClassName(e)[0].style.display="inline"}function timHideSpinner(e){document.getElementsByClassName(e)[0].style.display="none"}function timRemoveItemFromArray(e,t,i){var n=timFindArrayIndex(e,t,i);return e.splice(n,1),e}function timFindItemInArray(e,t,i){for(var n=0;n<e.length;n++)if(e[n][t]===i)return e[n];return null}function timFindArrayIndex(e,t,i){for(var n=0;n<e.length;n++)if(e[n][t]===i)return n;return null}function setTimePicker(e,t){var i={timeSeparator:":"};t&&(i.now=t),jQuery("."+e).wickedpicker(i)}function timConvertTimeToDB(e){var t=e.split(" "),i=t[0].split(":"),n=i[0],a=i[1];if(n<10&&(n="0"+n),"PM"===t[1])switch(n){case"01":n="13";break;case"02":n="14";break;case"03":n="15";break;case"04":n="16";break;case"05":n="17";break;case"06":n="18";break;case"07":n="19";break;case"07":n="20";break;case"09":n="21";break;case"10":n="22";break;case"11":n="23";break;case"12":n="24"}return n+":"+a}function timParseDate(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])}function timGetDiffInDays(e,t){return Math.round((t-e)/864e5)}function increaseDate(e,t){var i=e.split("-"),n=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10));return n.setDate(n.getDate()+1),i[0]=""+n.getFullYear(),i[1]=""+(n.getMonth()+1),i[1].length<2&&(i[1]="0"+i[1]),i[2]=""+n.getDate(),i[2].length<2&&(i[2]="0"+i[2]),i.join("-")}function getTodayDate(){var e=new Date,t=String(e.getDate()).padStart(2,"0"),i=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+"-"+i+"-"+t}function timFormatHour(e){var t=e.split(":"),i=t[0];return t[1],value=(e="00:00"==e?"12:00":e)+" "+(i<"12"?"AM":"12"==i?"MD":"PM"),value}function timRoundNum(e,t){return e=isNaN(e)?0:e,t=t||2,Number(Math.round(e+"e"+t)+"e-"+t)}function timOnlyNumbers(e){if(e.keyCode?code=e.keyCode:e.which&&(code=e.which),8==code||9==code||13==code)return!0;var t=String.fromCharCode(code);return"0"<=t&&t<="9"}function timCurrencyFormat(e,t){return t=t||2,e.toFixed(t).replace(/\.?0*$/g,"")}function timPostAjax(e,t,i){var n="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){3<a.readyState&&200==a.status&&i(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(n),a}function setTaxIdNumberMask(e){var t,i=jQuery("#timGuestTaxIdNumber");if(i.val(""),e){var n;switch(t=!1,e){case"01":n="9 9999 9999";break;case"02":n="9 999 999 999";break;case"03":n="999999999999"}i.inputmask({mask:n,autoUnmask:!0,removeMaskOnSubmit:!0})}else t=!0;i.prop("disabled",t)}function timAddItemToOrder(e){var t=document.getElementById("timUserCurrency").value,i=document.getElementById("departureTime");i&&(e.departure_time=timConvertTimeToDB(i.value)),document.getElementById("timProviderId")&&(e.provider_id=document.getElementById("timProviderId").value);var n={action:"add_item_to_order_api",f_nonce:timData.f_nonce,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:e};if(document.getElementById("timAvailabilityResult")){var a=document.getElementById("timAvailabilityResult");a.style.opacity=.5}timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,n,function(e){if("false"==e)return!1;timHideSpinner("tim_spinner"),document.getElementById("timAvailabilityResult")&&(a.style.opacity=1),window.location=document.getElementById("timHomeUrl").value+"cart/"})}function timOpenEditItemFromOrder(e,t,i){var n={action:"open_modal",f_nonce:timData.f_nonce,option:"cart",id:e,type:t,pLId:i,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,n,function(e){openModal(e)})}function timUpdateItemFromOrder(e){var t={action:"update_item_from_order_api",f_nonce:timData.f_nonce,bookingItemData:e,lang:document.getElementById("timCL").value};timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,t,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,timHideSpinner("tim_spinner"),jQuery.fancybox.close()})}function timApplyPlacesToItemOrder(e){var t={booking_item_id:e},i=document.getElementById("timPickupPlaceId_"+e).value;i&&(t.pickup_place_id=i);var n=document.getElementById("timDropoffPlaceId_"+e).value;n&&(t.dropoff_place_id=n);var a={action:"apply_places_to_order_api",f_nonce:timData.f_nonce,bookingItemData:t,lang:document.getElementById("timCL").value};timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,a,function(e){if("false"==e)return!1;document.getElementById("timCartDetail").innerHTML=e,timHideSpinner("tim_spinner")})}function timRemoveItemFromOrder(e){timShowSpinner("tim_spinner");var t={action:"remove_item_from_order_api",f_nonce:timData.f_nonce,bookingItemId:e,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,t,function(e){if("false"==e)return!1;timHideSpinner("tim_spinner");var t=document.getElementById("timTotalBookingItems").value-1;document.getElementById("timCartDetail").innerHTML=e,document.getElementById("timBTI").innerHTML=t,document.getElementById("timOTI")&&(document.getElementById("timOTI").innerHTML=t)})}function timSelectPickupPlace(e,t){var i=!0,n=!0;if("both"==e||"pickup"==e){var a=document.getElementById("timPickupPlaceId_"+t).value;a&&null!=a||(i=!1)}if("both"==e||"dropoff"==e){var o=document.getElementById("timDropoffPlaceId_"+t).value;o&&null!=o||(n=!1)}i&&n&&(document.getElementById("addPlaces_"+t).disabled=!1)}function timUnavailableProductDates(e){var t=document.getElementById("unavailableDates")?JSON.parse(document.getElementById("unavailableDates").value):[],i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();n<10&&(n="0"+n),a<10&&(a="0"+a);var o=i+"-"+n+"-"+a;return-1!=jQuery.inArray(o,t)?[!1,"disabled",""]:[!0,"",""]}function timProductDatePicker(i,e,t,n,a){jQuery.datepicker.setDefaults(jQuery.datepicker.regional[""+t]);var o=jQuery("#timFrom");if("hotel"===i)var r=jQuery("#timTo");var m,l="yy-mm-dd";if(o.datepicker({firstDay:1,minDate:0,numberOfMonths:e,altField:"#timFromDB",altFormat:l,onSelect:function(){if(_(),n||"hotel"===i){if(r){var e=o.datepicker("getDate"),t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);r.datepicker("option","minDate",t),setTimeout(function(){document.getElementById("timTo").focus()},10),document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}}else switch(i){case"tour":timCheckTourRates();break;case"transportation":timCheckTransportationRates()}}}).datepicker("widget").wrap('<div class="tim-datepicker"/>'),n){var d=(m=n.split("-"))[0],u=m[1]-1,s=m[2];o.datepicker("setDate",new Date(d,u,s))}if("hotel"===i){var c=o.datepicker("getDate"),p=c?new Date(c.getFullYear(),c.getMonth(),c.getDate()+1):"+1D";r.datepicker({minDate:p,numberOfMonths:1,altField:"#timToDB",altFormat:l,onSelect:function(){document.getElementById("timAvailabilityResult").innerHTML="",document.getElementById("timAvailabilityResultMsg").style.display="block"}})}a&&(d=(m=a.split("-"))[0],u=m[1]-1,s=m[2],r.datepicker("setDate",new Date(d,u,s)));function _(){if(document.getElementById("timAvailabilityFor")){var e=timLabels.availabilityFor+": <b>"+o.val()+"</b>";document.getElementById("timAvailabilityFor").innerHTML=e}}"package"!==i&&_()}function timVerifyOrderForm(){setButton();var e=0,t=document.getElementById("timOrderId").value,i=document.getElementById("timCustomerEmail").value;if(e=validateInput("timOrderId",e=validateEmail("timCustomerEmail",e)))return setButton(1),!1;var n=document.getElementById("timCL").value,a={action:"verify_order_api",f_nonce:timData.f_nonce,bookingNumber:t,clientEmail:i,lang:document.getElementById("timCL").value},o=document.getElementById("timCustomerFormErrorMsg");timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,a,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).error)setButton(1),o.innerHTML='<br /><div class="tim_alert tim_alert_danger">'+e.error+"</div>";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=view&oid="+e.id+"&onm="+e.booking_number+"&lng="+n}})}function timCheckTourRates(e){var t=document.getElementById("timUserCurrency").value,i=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),n=(new Date).toISOString(),a=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_tour_rates_api",f_nonce:timData.f_nonce,currentUTCDate:n,lang:document.getElementById("timCL").value,currency_id:t,bookingItemData:{booking_type:"tour",start_date:document.getElementById("timFromDB").value,adults:parseInt(a),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),tour_id:document.getElementById("timTourId").value,tour_content_id:document.getElementById("timTourContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTourRatesEdit(e,l,i)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),timCheckTourRatesAdd(l,i))}function timCheckTourRatesAdd(N,M){var A=document.getElementById("timTourOptions");A.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,N,function(e){var t=timLabels,i="";if("false"==e)i='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var n=JSON.parse(e),a=n.tour_options,o=n.saleTaxes,r=n.documentDateExchangeRate,m=n.taxesIncluded;if(N.bookingItemData.exchange_rate_value=r.value,N.bookingItemData.spl_accepted=N.spl_accepted||!1,N.bookingItemData.priceListIdByProvider=n.priceListIdByProvider,a){for(var l=N.bookingItemData.adults,d=N.bookingItemData.children,u=N.bookingItemData.infants,s=N.bookingItemData.seniors,c=l+d+u+s,p=!1,_=!1,g=JSON.parse(document.getElementById("unavailableDates").value),v=document.getElementById("timFromDB"),y=0;y<a.length;y++){var I=a[y],f="";if(0<I.schedules.length)for(var b=0;b<I.schedules.length;b++){var E,B=I.schedules[b];N.bookingItemData.subtotal_price=0;var h=B.date_rates;N.bookingItemData.tour_option_id=I.id,N.bookingItemData.tour_option_schedule_id=B.id,N.bookingItemData.departure_time=B.departure,N.bookingItemData.quantity=c,N.bookingItemData.adult_price=0<l?applyExchangeRateConversion(h.adult_price,r):0,N.bookingItemData.child_price=0<d?applyExchangeRateConversion(h.child_price,r):0,N.bookingItemData.infant_price=0<u?applyExchangeRateConversion(h.infant_price,r):0,N.bookingItemData.senior_price=0<s?applyExchangeRateConversion(h.senior_price,r):0;var D=setDayPrice(h,"per_person",l,d,u,s,r),k=setBasePrice(D,m,o),C=k*(h.client_commission_percentage/100),x=k-C,T=0+x,P=setDayTaxesTotalPercentage(o);N.bookingItemData.sale_taxes=setDayTaxes(T,o);var L=setDayTaxesTotalAmount(N.bookingItemData.sale_taxes),S=T+L;N.bookingItemData.item_price=timRoundNum(D),N.bookingItemData.base_price=timRoundNum(k),N.bookingItemData.commission_price_percentage=h.client_commission_percentage,N.bookingItemData.commission_price=timRoundNum(C),N.bookingItemData.net_price=timRoundNum(x),N.bookingItemData.pickup_price=0,N.bookingItemData.dropoff_price=0,N.bookingItemData.discount_price=timRoundNum(0),N.bookingItemData.subtotal_price=timRoundNum(T),N.bookingItemData.tax_price_percentage=P,N.bookingItemData.tax_price=timRoundNum(L),N.bookingItemData.total_price=timRoundNum(S);var w=m?N.bookingItemData.total_price:N.bookingItemData.subtotal_price;B.is_available&&B.isCutOffValid?(E=c>=B.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(N.bookingItemData)+")'>"+t.book+"</a>":"<br /><b><small>"+t.errorMinPaxRequired+":</small> "+B.min_pax_required+"</b>",p=!0):E='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",h.day&&(_=!0),f+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+t.departure+"</span>"+timFormatHour(B.departure)+'</div><div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+B.duration+" <small>"+B.duration_time_unit+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+M+timCurrencyFormat(w)+'</div><div class="tim-book">'+E+"</div></div>"}else f+='<div class="tim-option-content"><b>* '+t.errorSelectEarlierDate+"</b></div>";i+='<div class="tim-options-wrapper"><div class="tim-option-title">'+I.name+'</div><div class="tim-option-body">'+f+"</div></div>"}if(!p&&_){g.push(v.value);var R=increaseDate(v.value,1);v.value=R,document.getElementById("unavailableDates").value=JSON.stringify(g),jQuery("#timFrom").datepicker("option","beforeShowDay",timUnavailableProductDates).datepicker("refresh")}}else i='<div style="text-align:center;"><b>No rates found.</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTourOptions").innerHTML=i,A.style.opacity=1})}function timCheckTourRatesEdit(e,x,T){var t=document.getElementById("timPickupPlaceId"),i=t.value;if(t.classList.remove("tim_error_input"),!i||null==i)return t.classList.add("tim_error_input"),t.focus(),!1;var n=document.getElementById("timdropOffPlaceId"),a=n.value;if(n.classList.remove("tim_error_input"),!a||null==a)return n.classList.add("tim_error_input"),n.focus(),!1;var o=document.forms.tim_update_cart.elements.schedule.value.split("-"),r=o[0],m=o[1],l=o[2];x.bookingItemData.booking_item_id=e,x.bookingItemData.tour_option_id=r,x.bookingItemData.tour_option_schedule_id=m,x.bookingItemData.departure_time=l,x.bookingItemData.pickup_place_id=i,x.bookingItemData.dropoff_place_id=a;var P=document.getElementById("timAvailabilityResult");P.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,x,function(e){if("false"==e)return!1;var t=timLabels,i=JSON.parse(e);if(i.error){var n='<br /><div class="tim_alert tim_alert_danger"><b>'+i.error+"</b></div>";P.innerHTML=n}else{var a=i.tour_options,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded,l=i.booking,d=a.date_rates,u=x.bookingItemData.adults,s=x.bookingItemData.children,c=x.bookingItemData.infants,p=x.bookingItemData.seniors;x.bookingItemData.adult_price=0<u?applyExchangeRateConversion(d.adult_price,r):0,x.bookingItemData.child_price=0<s?applyExchangeRateConversion(d.child_price,r):0,x.bookingItemData.infant_price=0<c?applyExchangeRateConversion(d.infant_price,r):0,x.bookingItemData.senior_price=0<p?applyExchangeRateConversion(d.senior_price,r):0;var _=setDayPrice(d,"per_person",u,s,c,p,r),g=setBasePrice(_,m,o),v=g*(d.client_commission_percentage/100),y=g-v,I=applyExchangeRateConversion(a.pickup_price,r),f=applyExchangeRateConversion(a.dropoff_price,r),b=0+y+I-f,E=setDayTaxesTotalPercentage(o);l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?b-=f=b*(l.discount_coupon.value/100):b=(_+0+I-(f=applyExchangeRateConversion(l.discount_coupon.value,r)))/(E/100+1)),x.bookingItemData.sale_taxes=setDayTaxes(b,o);var B=setDayTaxesTotalAmount(x.bookingItemData.sale_taxes),h=b+B;x.bookingItemData.item_price=timRoundNum(_),x.bookingItemData.base_price=timRoundNum(g),x.bookingItemData.commission_price_percentage=d.client_commission_percentage,x.bookingItemData.commission_price=timRoundNum(v),x.bookingItemData.net_price=timRoundNum(y),x.bookingItemData.pickup_price=0,x.bookingItemData.dropoff_price=I,x.bookingItemData.discount_price=timRoundNum(f),x.bookingItemData.subtotal_price=timRoundNum(b),x.bookingItemData.tax_price_percentage=E,x.bookingItemData.tax_price=timRoundNum(B),x.bookingItemData.total_price=timRoundNum(h);var D=m?x.bookingItemData.total_price:x.bookingItemData.subtotal_price,k=x.bookingItemData.pickup_price+x.bookingItemData.dropoff_price,C='<div class="tim_align_center" style="font-size:14px;">';k&&(C="<br />"+C+"<hr />"+t.subtotal+": <b>"+T+x.bookingItemData.subtotal_price+"</b><br /><small>(+) "+t.transportation+":</small> "+T+k+"<br />"),C=C+"<br /><hr /><b>"+t.totalPrice+": "+T+timCurrencyFormat(D)+"</b><br /><br /><button type='button' class='tim_btn tim_btn_big' onclick='timUpdateItemFromOrder("+JSON.stringify(x.bookingItemData)+")'>"+t.updateOrder+"</button></div>",P.innerHTML=C}timHideSpinner("tim_spinner")})}function timCheckTransportationRates(e){var t=document.getElementById("timUserCurrency").value,i=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),n=(new Date).toISOString(),a=document.getElementById("timAdults")?document.getElementById("timAdults").value:0,o=document.getElementById("timChildren")?document.getElementById("timChildren").value:0,r=document.getElementById("timInfants")?document.getElementById("timInfants").value:0,m=document.getElementById("timSeniors")?document.getElementById("timSeniors").value:0,l={action:"check_transportation_rates_api",f_nonce:timData.f_nonce,currentUTCDate:n,lang:document.getElementById("timCL").value,currency_id:t,scheduleType:document.getElementById("timTransportationScheduleType").value,bookingItemData:{booking_type:"transportation",start_date:document.getElementById("timFromDB").value,adults:parseInt(a),children:parseInt(o),infants:parseInt(r),seniors:parseInt(m),transportation_id:document.getElementById("timTransportationId").value,transportation_content_id:document.getElementById("timTransportationContentId").value}};e?(l.booking_id=document.getElementById("timBookingId").value,l.price_list_id=document.getElementById("timBookingPriceListId").value,timCheckTransportationRatesEdit(e,l,i)):(document.getElementById("timSPLAccepted")&&(l.spl_accepted=document.getElementById("timSPLAccepted").value),timCheckTransportationRatesAdd(l,i))}function timCheckTransportationRatesAdd(A,j){var H=document.getElementById("timAvailabilityResult");H.style.opacity=.5,timShowSpinner("tim-inline-spinner"),jQuery.post(timData.ajaxurl,A,function(e){var t=timLabels,i="";if("false"==e)i='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var n=JSON.parse(e),a=n.transportation_schedules,o=n.saleTaxes,r=n.documentDateExchangeRate,m=n.taxesIncluded;A.bookingItemData.exchange_rate_value=r.value,A.bookingItemData.spl_accepted=A.spl_accepted||!1,A.bookingItemData.priceListIdByProvider=n.priceListIdByProvider;var l=!0,d=t.departure;if("open"===A.scheduleType&&(l=!1,d=t.selectTime),a){var u,s=A.bookingItemData.adults,c=A.bookingItemData.children,p=A.bookingItemData.infants,_=A.bookingItemData.seniors,g=s+c+p+_,v=!1,y=!1,I=JSON.parse(document.getElementById("unavailableDates").value),f=document.getElementById("timFromDB"),b="";if(0<a.length)for(var E=0;E<a.length;E++){var B,h=a[E],D="";A.bookingItemData.subtotal_price=0;var k=h.date_rates;A.bookingItemData.transportation_schedule_id=h.id,A.bookingItemData.departure_time=h.departure,A.bookingItemData.quantity=1,u="per_service","fixed"===A.scheduleType&&(A.bookingItemData.quantity=g,u="per_person",A.bookingItemData.adult_price=0<s?applyExchangeRateConversion(k.adult_price,r):0,A.bookingItemData.child_price=0<c?applyExchangeRateConversion(k.child_price,r):0,A.bookingItemData.infant_price=0<p?applyExchangeRateConversion(k.infant_price,r):0,A.bookingItemData.senior_price=0<_?applyExchangeRateConversion(k.senior_price,r):0);var C=setDayPrice(k,u,s,c,p,_,r),x=setBasePrice(C,m,o),T=x*(k.client_commission_percentage/100),P=x-T,L=0+P,S=setDayTaxesTotalPercentage(o);A.bookingItemData.sale_taxes=setDayTaxes(L,o);var w=setDayTaxesTotalAmount(A.bookingItemData.sale_taxes),R=L+w;A.bookingItemData.item_price=timRoundNum(C),A.bookingItemData.base_price=timRoundNum(x),A.bookingItemData.commission_price_percentage=k.client_commission_percentage,A.bookingItemData.commission_price=timRoundNum(T),A.bookingItemData.net_price=timRoundNum(P),A.bookingItemData.pickup_price=0,A.bookingItemData.dropoff_price=0,A.bookingItemData.discount_price=timRoundNum(0),A.bookingItemData.subtotal_price=timRoundNum(L),A.bookingItemData.tax_price_percentage=S,A.bookingItemData.tax_price=timRoundNum(w),A.bookingItemData.total_price=timRoundNum(R);var N=m?A.bookingItemData.total_price:A.bookingItemData.subtotal_price;h.is_available&&h.isCutOffValid?(B=g>=h.min_pax_required?"<a href='javascript:void(0)' class='tim-option-btn' onclick='timAddItemToOrder("+JSON.stringify(A.bookingItemData)+")'>"+t.book+"</a>":"<b><small>"+t.errorMinPaxRequired+":</small> "+h.min_pax_required+"</b>",v=!0):(B='<br /><span class="tim_label tim_label_md tim_label_danger">'+t.errorNotAvailable+"</span>",D=" tim_text_disabled"),k.day&&(y=!0),b+='<div class="tim-option-content"><div class="tim-departure"><span class="tim-option-content-title">'+d+"</span>",b+=l?timFormatHour(h.departure):D?"-":'<input type="text" id="departureTime" name="departureTime" class="timepicker" />',b+="</div>",b+='<div class="tim-duration"><span class="tim-option-content-title">'+t.duration+"</span>"+h.duration+" <small>"+h.duration_time_unit+'</small></div><div class="tim-price"><span class="tim-option-content-title">'+t.price+"</span>"+j+timCurrencyFormat(N)+'</div><div class="tim-book">'+B+"</div>",b+="</div>"}else b+='<div class="tim-option-content"><b>* '+t.errorSelectEarlierDate+"</b></div>";if(i+='<div class="tim-options-wrapper"><div class="tim-option-body">'+b+"</div></div>",!v&&y){I.push(f.value);var M=increaseDate(f.value,1);f.value=M,document.getElementById("unavailableDates").value=JSON.stringify(I),jQuery("#timFrom").datepicker("option","beforeShowDay",timUnavailableProductDates).datepicker("refresh")}}else i='<div style="text-align:center;"><b>No rates found.</b></div>'}timHideSpinner("tim-inline-spinner"),document.getElementById("timTransportationSchedules").innerHTML=i,l||setTimePicker("timepicker"),H.style.opacity=1})}function timCheckTransportationRatesEdit(e,P,L){var t=document.getElementById("timPickupPlaceId"),i=t.value;if(t.classList.remove("tim_error_input"),!i||null==i)return t.classList.add("tim_error_input"),t.focus(),!1;var n=document.getElementById("timdropOffPlaceId"),a=n.value;if(n.classList.remove("tim_error_input"),!a||null==a)return n.classList.add("tim_error_input"),n.focus(),!1;var o,r,m=document.forms.tim_update_cart;if(r=document.getElementById("departureTime").value)o=document.getElementById("timScheduleId").value,r=timConvertTimeToDB(r);else{var l=m.elements.schedule.value.split("-");o=l[0],r=l[1]}P.bookingItemData.booking_item_id=e,P.bookingItemData.transportation_schedule_id=o,P.bookingItemData.departure_time=r,P.bookingItemData.pickup_place_id=i,P.bookingItemData.dropoff_place_id=a;var S=document.getElementById("timAvailabilityResult");S.innerHTML="",timShowSpinner("tim_spinner"),jQuery.post(timData.ajaxurl,P,function(e){if("false"==e)return!1;var t=timLabels,i=JSON.parse(e);if(i.error){var n='<br /><div class="tim_alert tim_alert_danger"><b>'+e.error+"</b></div>";S.innerHTML=n}else{var a=i.transportation_schedules,o=i.saleTaxes,r=i.documentDateExchangeRate,m=i.taxesIncluded,l=i.booking,d=a.date_rates,u=P.bookingItemData.adults,s=P.bookingItemData.children,c=P.bookingItemData.infants,p=P.bookingItemData.seniors,_=u+s+c+p;P.bookingItemData.quantity=1;var g="per_service";"fixed"===P.scheduleType&&(P.bookingItemData.quantity=_,g="per_person",P.bookingItemData.adult_price=0<u?applyExchangeRateConversion(d.adult_price,r):0,P.bookingItemData.child_price=0<s?applyExchangeRateConversion(d.child_price,r):0,P.bookingItemData.infant_price=0<c?applyExchangeRateConversion(d.infant_price,r):0,P.bookingItemData.senior_price=0<p?applyExchangeRateConversion(d.senior_price,r):0);var v=setDayPrice(d,g,u,s,c,p,r),y=setBasePrice(v,m,o),I=y*(d.client_commission_percentage/100),f=y-I,b=applyExchangeRateConversion(a.pickup_price,r),E=applyExchangeRateConversion(a.dropoff_price,r),B=0+f+b-E,h=setDayTaxesTotalPercentage(o);l.discount_coupon_id&&("percentage"==l.discount_coupon.discount_type?B-=E=B*(l.discount_coupon.value/100):B=(v+0+b-(E=applyExchangeRateConversion(l.discount_coupon.value,r)))/(h/100+1)),P.bookingItemData.sale_taxes=setDayTaxes(B,o);var D=setDayTaxesTotalAmount(P.bookingItemData.sale_taxes),k=B+D;P.bookingItemData.item_price=timRoundNum(v),P.bookingItemData.base_price=timRoundNum(y),P.bookingItemData.commission_price_percentage=d.client_commission_percentage,P.bookingItemData.commission_price=timRoundNum(I),P.bookingItemData.net_price=timRoundNum(f),P.bookingItemData.pickup_price=0,P.bookingItemData.dropoff_price=b,P.bookingItemData.discount_price=timRoundNum(E),P.bookingItemData.subtotal_price=timRoundNum(B),P.bookingItemData.tax_price_percentage=h,P.bookingItemData.tax_price=timRoundNum(D),P.bookingItemData.total_price=timRoundNum(k);var C=m?P.bookingItemData.total_price:P.bookingItemData.subtotal_price,x=P.bookingItemData.pickup_price+P.bookingItemData.dropoff_price,T='<div class="tim_align_center" style="font-size:14px;">';x&&(T="<br />"+T+"<hr />"+t.subtotal+": <b>"+L+P.bookingItemData.subtotal_price+"</b><br /><small>(+) "+t.transportation+":</small> "+L+x+"<br />"),T=T+"<br /><hr /><b>"+t.totalPrice+": "+L+timCurrencyFormat(C)+"</b><br /><br /><button type='button' class='tim_btn tim_btn_big' onclick='timUpdateItemFromOrder("+JSON.stringify(P.bookingItemData)+")'>"+t.updateOrder+"</button></div>",S.innerHTML=T}timHideSpinner("tim_spinner")})}function timSearchTransportation(){setButton();var e=0;if(e=validateInput("timDepartureLocation",e),e=validateInput("timArrivalLocation",e),e=validateInput("timFrom",e),e=validateInput("timDepartureTime",e))return setButton(1),!1;var t=document.getElementById("timUserCurrency").value,h=document.getElementById("timUserCurrencySymbol").value,i=(new Date).toISOString(),o=document.getElementById("timFromDB").value,D=parseInt(document.getElementById("timAdults").value),k=parseInt(document.getElementById("timChildren").value),C=parseInt(document.getElementById("timInfants").value),n={action:"search_transportations_rates_api",f_nonce:timData.f_nonce,currentUTCDate:i,lang:document.getElementById("timCL").value,currency_id:t,departureLocationId:document.getElementById("timDepartureLocation").value,arrivalLocationId:document.getElementById("timArrivalLocation").value,start_date:o,departure_time:document.getElementById("timDepartureTime").value,adults:D,children:k,infants:C};timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,n,function(e){timHideSpinner("tim_spinner"),setButton(1);var y=timLabels,t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),n=i.transportations,I=i.documentDateExchangeRate,f=i.taxesIncluded,b={booking_type:"transportation",start_date:o,adults:D,children:k,infants:C,seniors:0,exchange_rate_value:I.value},a="";if(0<n.length){var E,B=D+k+C+0;n.forEach(function(e){b.transportation_id=e.transportation_id,b.transportation_content_id=e.transportation_content_id,b.provider_id=e.provider_id,b.priceListIdByProvider=e.priceListIdByProvider;var u,s,c,p,_=e.saleTaxes,g=e.schedule_type,v="";e.transportation_schedules.forEach(function(e){if(b.subtotal_price=0,e.is_available&&e.isCutOffValid){p=e.date_rates,b.transportation_schedule_id=e.id,b.departure_time=e.departure,b.quantity=1,E="per_service","fixed"===g&&(b.quantity=B,E="per_person",b.adult_price=0<D?applyExchangeRateConversion(p.adult_price,I):0,b.child_price=0<k?applyExchangeRateConversion(p.child_price,I):0,b.infant_price=0<C?applyExchangeRateConversion(p.infant_price,I):0,b.senior_price=0);var t=setDayPrice(p,E,D,k,C,0,I),i=setBasePrice(t,f,_),n=i*(p.client_commission_percentage/100),a=i-n,o=0+a,r=setDayTaxesTotalPercentage(_);b.sale_taxes=setDayTaxes(o,_);var m=setDayTaxesTotalAmount(b.sale_taxes),l=o+m;b.item_price=timRoundNum(t),b.base_price=timRoundNum(i),b.commission_price_percentage=p.client_commission_percentage,b.commission_price=timRoundNum(n),b.net_price=timRoundNum(a),b.pickup_price=0,b.dropoff_price=0,b.discount_price=timRoundNum(0),b.subtotal_price=timRoundNum(o),b.tax_price_percentage=r,b.tax_price=timRoundNum(m),b.total_price=timRoundNum(l);var d=f?b.total_price:b.subtotal_price;s=B>=e.min_pax_required?"<a href='javascript:void(0)' class='tim_btn' onclick='timAddItemToOrder("+JSON.stringify(b)+")'>"+y.book+"</a>":"<b><small>"+y.errorMinPaxRequired+":</small> "+e.min_pax_required+"</b>"}else s='<br /><span class="tim_label tim_label_md tim_label_danger">'+y.errorNotAvailable+"</span>";u="fixed"===g?y.fixed:y.open,c="fixed"===g?timFormatHour(e.departure):document.getElementById("timDepartureTime").value,v+='<tr><td class="tim_align_center">'+u+'</td><td class="tim_align_center">'+e.duration+" <small>"+e.duration_time_unit+'</small></td><td class="tim_align_center">'+c+'</td><td class="tim_align_center"><b>'+h+timCurrencyFormat(d)+'</b></td><td class="tim_align_center">'+s+"</td>"}),a+='<h3 class="tim_align_center">'+e.transportation_content_name+'</h3><table class="tim_table tim_table_no_border"><thead><tr><th class="tim_align_center">'+y.scheduleType+'</th><th class="tim_align_center">'+y.duration+'</th><th class="tim_align_center">'+y.pickupTime+'</th><th class="tim_align_center" style="width: 100px;">'+y.price+'</th><th class="tim_align_center" style="width: 210px;"></th></tr></thead><tbody>'+v+"</tbody></table><br />"})}else a='<div style="text-align:center;"><b>No rates found.</b></div>';t+=a}document.getElementById("timTransportations").innerHTML=t})}var timRoomsSelected;function timCheckHotelAvailability(){var e=0;e=validateInput("timTo",e),e=validateInput("timFrom",e);var t=getTodayDate(),i=document.getElementById("timFromDB").value,n=document.getElementById("timToDB").value;if(i&&(i<t||n<=i))alert("Invalid date");else{if(e)return!1;var k=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",a=document.getElementById("timUserCurrency").value,C=(document.getElementById("timUserCurrencyCode").value,document.getElementById("timUserCurrencySymbol").value),o=(new Date).toISOString(),x={action:"check_hotel_availability_api",f_nonce:timData.f_nonce,currentUTCDate:o,lang:document.getElementById("timCL").value,currency_id:a,bookingItemData:{booking_type:"hotel",start_date:i,end_date:n,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value}};if(k){var T=timBookedRooms;x.booking_id=document.getElementById("timBookingId").value,x.price_list_id=document.getElementById("timBookingPriceListId").value,x.bookingItemData.booking_item_id=k}else document.getElementById("timSPLAccepted")&&(x.spl_accepted=document.getElementById("timSPLAccepted").value);var P=timLabels,L=document.getElementById("timAvailabilityResult");L.style.opacity=.5,document.getElementById("timAvailabilityResultMsg").style.display="none",timShowSpinner("tim_travel_form_spinner"),jQuery.post(timData.ajaxurl,x,function(e){var t="";if("false"==e)t='<div style="text-align:center;"><b>Invalid access.</b><br />Contact the website owner.</div>';else{var i=JSON.parse(e),n=i.hotel_rooms,a={saleTaxes:i.saleTaxes,documentDateExchangeRate:i.documentDateExchangeRate,taxesIncluded:i.taxesIncluded,priceListIdByProvider:i.priceListIdByProvider,booking:i.booking,spl_accepted:x.spl_accepted||!1};timRoomsSelected=[];for(var o,r,m,l,d,u,s,c,p,_,g="",v="",y="",I="",f="",b="",E=0;E<n.length;E++){if(r=(o=n[E]).id,m=o.min_availability,s="",p=2,_=c=0,k&&0<o.date_rates.length){for(var B=0;B<T.length;B++)if(T[B].id===r){var h=(s=T[B]).unitsPerRoom;c=s.unitsPerRoom,p=s.units[0].adults,_=s.units[0].children;break}m+=h}if((v="")!==o.logo.url&&null!==o.logo.url&&(v+='<img src="'+o.logo.url+'" alt="'+o.name+'" class="tim-table-product-image" />'),l=o.bed_configuration?" ("+o.bed_configuration+")":"",v+='<div class="tim_table_td_title">'+o.name+'</div><i class="fa fa-bed"></i> <b>'+o.occupancy_type.name+"</b>"+l+"<br />",o.wifi&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.wifi+"</span>"),o.not_smoking&&(v+=' <span class="tim_label tim_label_success tim_label_rd">'+P.notSmoking+"</span>"),y="",0<m&&(y=C+timCurrencyFormat(o.price_from)),m<5&&(y+='<div style="font-size: 11px; color: #f00;">',y+=0<m?P.only+" <b>"+m+"</b> "+P.left:P.notAvailable,y+="</div>"),I='<div class="tim_pax_selector">',I+="<label>"+P.rooms+"</label>",0<m+c){for(u=9<m?9:m,I+="<select id='timUnitsPerRoom_"+r+"'",I+=" onchange='timAddHotelRoomUnit("+JSON.stringify(o)+", "+JSON.stringify(s)+", true, "+JSON.stringify(a)+")' class='tim_select_highlighted'>",d=0;d<=u;d++)I+='<option value="'+d+'"'+(d===c?" selected":"")+">"+d+"</option>";I+="</select>"}else I+="-";if(I+="</div>",f='<div class="tim_pax_selector">',f+="<label>"+P.adults+"</label>",0<m+c){for(f+="<select id='timAdults_"+r+"[0]' name='timAdults_"+r+"[0]' disabled",f+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(o)+", 0, "+JSON.stringify(a)+")'>",d=1;d<=o.max_occupancy;d++)f+='<option value="'+d+'"'+(d===p?" selected":"")+">"+d+"</option>";f+="</select>"}else f+="-";if(f+="</div>",b='<div class="tim_pax_selector">',b+="<label>"+P.children+"</label>",0<m+c&&2<o.max_occupancy&&o.children_allowed){for(b+="<select id='timChildren_"+r+"[0]' name='timChildren_"+r+"[0]' disabled",b+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(a)+")'>",d=0;d<=o.max_children_occupancy;d++)b+='<option value="'+d+'"'+(d===_?" selected":"")+">"+d+"</option>";b+="</select>"}else b+="-";b+="</div>";var D="-";o.children_allowed&&(D='<div title="test"><i class="fa fa-child"></i> '+o.max_children_occupancy+"</div>"),g+='<tr class="tim_table_tr_align_top"><td>'+v+'</td><td data-th="'+P.priceFrom+'">'+y+'</td><td data-th="'+P.max+'"><i class="fa fa-user"></i> '+o.max_occupancy+D+'</td><td data-th="'+P.rooms+'"><div class="tim_room_selector_wrapper"><div class="tim_rooms_selector">'+I+'</div><div class="tim_paxes_selector"><div>'+f+b+'</div><div id="timAdditionalPaxContainer_'+r+'"></div></div></div></td></tr>'}t='<div class="tim_clr"><div class="tim_col_9"><table class="tim_table tim_table_no_border tim_table_align_top"><thead><tr><th>'+P.roomType+'</th><th style="width: 100px;" class="tim_align_center">'+P.priceFrom+'</th><th style="width: 60px;" class="tim_align_center">'+P.max+'</th><th style="width: 210px;" class="tim_align_center">'+P.rooms+"</th></tr></thead><tbody>"+g+'</tbody></table></div><div class="tim_col_3"><div class="tim-totals-box-wrapper"><div class="tim-totals-box-title">'+P.accommodations+'</div><div class="tim-totals-box"><div id="timTotalsBoxResult">'+P.enterOneRoom+"</div></div></div></div></div>"}if(timHideSpinner("tim_travel_form_spinner"),L.style.opacity=1,L.innerHTML=t,k&&0<o.date_rates.length){for(E=0;E<n.length;E++)for(r=(o=n[E]).id,B=0;B<T.length;B++)if(T[B].id===r){s=T[B],document.getElementById("timUnitsPerRoom_"+r).value=s.unitsPerRoom,timAddHotelRoomUnit(o,s,!1,a);break}calculateHotelRoomsTotalPrice(a)}})}}function timAddHotelRoomUnit(e,t,i,n){var a,o=e.id,r=parseInt(document.getElementById("timUnitsPerRoom_"+o).value),m="",l="",d="",u=(timLabels,!(0<r));if(document.querySelector('[name="timAdults_'+o+'[0]"]').disabled=u,document.querySelector('[name="timChildren_'+o+'[0]"]')&&(document.querySelector('[name="timChildren_'+o+'[0]"]').disabled=u),0===r)timRemoveItemFromArray(timRoomsSelected,"id",o);else{var s=timFindItemInArray(timRoomsSelected,"id",o);s?s.unitsPerRoom=r:(e.unitsPerRoom=r,timRoomsSelected.push(e))}if(1<r)for(var c,p,_=1;_<r;_++){for(c=t&&t.units[_]?t.units[_].adults:2,p=t&&t.units[_]?t.units[_].children:0,l='<div class="tim_pax_selector">',l+="<select id='timAdults_"+o+"["+_+"]' name='timAdults_"+o+"["+_+"]'",l+=" onchange='timCheckHotelRoomUnitPax("+JSON.stringify(e)+", "+_+", "+JSON.stringify(n)+")'>",a=1;a<=e.max_occupancy;a++)l+='<option value="'+a+'"'+(a===c?" selected":"")+">"+a+"</option>";if(l+="</select>",l+="</div>",d='<div class="tim_pax_selector">',2<e.max_occupancy&&e.children_allowed){for(d+="<select id='timChildren_"+o+"["+_+"]' name='timChildren_"+o+"["+_+"]'",d+=" onchange='calculateHotelRoomsTotalPrice("+JSON.stringify(n)+")'>",a=0;a<=e.max_children_occupancy;a++)d+='<option value="'+a+'"'+(a===p?" selected":"")+">"+a+"</option>";d+="</select>"}else d+="<label>-</label>";m+="<div>"+l+(d+="</div>")+"</div>"}document.getElementById("timAdditionalPaxContainer_"+o).innerHTML=m,i&&calculateHotelRoomsTotalPrice(n)}function timCheckHotelRoomUnitPax(e,t,i){var n=e.id,a=document.querySelector('[name="timAdults_'+n+"["+t+']"]').value;if(2<e.max_occupancy&&e.children_allowed){var o=document.querySelector('[name="timChildren_'+n+"["+t+']"]'),r=parseInt(e.max_occupancy)-parseInt(a),m=r>e.max_children_occupancy?e.max_children_occupancy:r;if(0<m){for(var l=o.length;l<=m;l++){var d=new Option(l,l);o.add(d,void 0)}if(o.length-1>=m){for(l=o.length-1;m<l;l--)o.remove(l);o.value>m&&(o.value=0)}}else o.innerHTML='<option value="0" selected>0</option>'}calculateHotelRoomsTotalPrice(i)}function calculateHotelRoomsTotalPrice(e){for(var t,i,n,a,o,r,m,l=document.getElementById("timBookingItemId")?document.getElementById("timBookingItemId").value:"",d=document.getElementById("timFromDB").value,u=document.getElementById("timToDB").value,s=(document.getElementById("timUserCurrency").value,document.getElementById("timUserCurrencyCode").value),c=document.getElementById("timUserCurrencySymbol").value,p=timGetDiffInDays(timParseDate(d),timParseDate(u)),_=totalPricePerRoom=0,g=0,v=0,y=0,I=0,f=0,b=!1,E=[],B="",h=0;h<timRoomsSelected.length;h++)if(o=timRoomsSelected[h],r=o.id,0<o.unitsPerRoom){for(_+=o.unitsPerRoom,m=0;m<o.unitsPerRoom;m++)a=m+1,i=parseInt(document.querySelector('[name="timAdults_'+r+"["+m+']"]').value)||0,n=document.querySelector('[name="timChildren_'+r+"["+m+']"]')?parseInt(document.querySelector('[name="timChildren_'+r+"["+m+']"]').value):0,g+=i,v+=n,o.date_rates.forEach(function(e){y=getRatePerRoomOccupancy(i,n,e,"price"),E.push({day:e.day,unit_number:a,adults:i,children:n,item_price:y,hotel_id:document.getElementById("timHotelId").value,hotel_room_id:r}),I+=y,f=e.client_commission_percentage});B+=o.name+" (x"+o.unitsPerRoom+")<br />"}var D=timLabels;if(0<_){var k={booking_type:"hotel",start_date:d,end_date:u,quantity:_,adults:g,children:v,infants:0,seniors:0,total_rooms:_,hotel_id:document.getElementById("timHotelId").value,hotel_content_id:document.getElementById("timHotelContentId").value,booking_item_hotel_dates:E,spl_accepted:e.spl_accepted},C=e.saleTaxes,x=e.documentDateExchangeRate,T=e.taxesIncluded,P=e.booking,L=applyExchangeRateConversion(I,x),S=setBasePrice(L,T,C),w=S*(f/100),R=S-w,N=0,M=0+R-N,A=setDayTaxesTotalPercentage(C);P.discount_coupon_id&&("percentage"==P.discount_coupon.discount_type?M-=N=M*(P.discount_coupon.value/100):M=(L+0+0-(N=applyExchangeRateConversion(P.discount_coupon.value,x)))/(A/100+1)),k.sale_taxes=setDayTaxes(M,C);var j=setDayTaxesTotalAmount(k.sale_taxes),H=M+j;k.item_price=timRoundNum(L),k.base_price=timRoundNum(S),k.commission_price_percentage=f,k.commission_price=timRoundNum(w),k.net_price=timRoundNum(R),k.pickup_price=0,k.dropoff_price=0,k.discount_price=timRoundNum(N),k.subtotal_price=timRoundNum(M),k.tax_price_percentage=A,k.tax_price=timRoundNum(j),k.total_price=timRoundNum(H);var O=T?k.total_price:k.subtotal_price;k.exchange_rate_value=x.value,k.priceListIdByProvider=e.priceListIdByProvider;var F;F=l?(k.booking_item_id=l,"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timUpdateItemFromOrder("+JSON.stringify(k)+")' disabled>"+D.updateOrder+"</button>"):"<button type='button' class='tim-btn' id='timAddItemBtn' onclick='timAddItemToOrder("+JSON.stringify(k)+")' disabled>"+D.bookNow+"</button>",D=timLabels;var G="";0<k.tax_price_percentage&&(G+='<div style="tim-totals-price-note">+'+D.taxes.toLowerCase()+"</div>");var U="";v&&(U=" / <b>"+D.children+":</b> "+v),t="<ul><li>"+B+"</li><li>&nbsp;</li><li><b>"+D.adults+":</b> "+g+U+"</li><li><b>"+D.roomNights+":</b> "+p+'</li><li class="tim-totals-price"><div class="tim-totals-price-label">'+D.totalPrice+'</div><div class="tim-totals-price-amount">'+s+" <span>"+c+timCurrencyFormat(O)+"</span></div>"+G+"</li></ul>"+F}else t=D.enterOneRoom,b=!0;var q=document.querySelector(".tim-totals-box-wrapper");q.classList.add("tim-transition-in"),setTimeout(function(){q.classList.remove("tim-transition-in"),q.classList.add("tim-transition-out")},500),document.getElementById("timTotalsBoxResult").innerHTML=t,document.getElementById("timAddItemBtn")&&(document.getElementById("timAddItemBtn").disabled=b)}function timCheckPackageRates(){}function timCheckPackageForm(){setButton();var e=0,t=document.getElementById("timFromDB").value,i=document.getElementById("timAdults").value,n=document.getElementById("timChildren").value,a=document.getElementById("timInfants").value,o=document.getElementById("timCustomerName").value,r=document.getElementById("timCustomerEmail").value,m=getTodayDate();if(t&&t<=m)alert("Invalid date");else{if(e=validateInput("timCustomerName",e=validateEmail("timCustomerEmail",e)),e=validateInput("timAdults",e),e=validateInput("timFrom",e))return setButton(1),!1;var l={action:"check_package_request_api",f_nonce:timData.f_nonce,package_id:document.getElementById("timPackageId").value,package_date:t,adults:parseInt(i),children:parseInt(n),infants:parseInt(a),name:o,email:r,lang:document.getElementById("timCL").value};timShowSpinner("tim_travel_form_spinner"),timPostAjax(timData.ajaxurl,l,function(e){if("false"==e)return!1;var t=document.getElementById("timRequestPackageFormMsg"),i=document.getElementById("timLabelRequestPackageSent").value;t.innerHTML='<br /><div class="tim_alert tim_alert_lg tim_alert_success">'+i+' <a href="javascript:void(0);" onclick="timCloseAlert(\'timRequestPackageFormMsg\')" class="tim_alert_close">x</a></div>',document.getElementById("timFrom").value="",document.getElementById("timAdults").value="",document.getElementById("timChildren").value=0,document.getElementById("timInfants").value=0,document.getElementById("timCustomerName").value="",document.getElementById("timCustomerEmail").value="",timHideSpinner("tim_spinner")})}}function setDayPrice(e,t,i,n,a,o,r){return applyExchangeRateConversion("per_person"===t?i*e.adult_price+n*e.child_price+a*e.infant_price+o*e.senior_price:e.service_price,r)}function setBasePrice(e,t,i){return t&&i?e/(i.reduce(function(e,t){return e+t.value},0)/100+1):e}function setDayTaxes(t,e){return 0===e.length?e:e.map(function(e){return e.amount="percentage"===e.computation_type?t*(e.value/100):e.value,e})}function setDayTaxesTotalPercentage(e){return 0===e.length?0:e.reduce(function(e,t){return e+t.value},0)}function setDayTaxesTotalAmount(e){return 0===e.length?0:timRoundNum(e.reduce(function(e,t){return e+t.amount},0))}function applyExchangeRateConversion(e,t){if(0===e)return e;var i;switch(t.conversion){case"multiply":i=e*t.value;break;case"divide":i=e/t.value;break;default:i=e*t.value[0]/t.value[1]}return timRoundNum(i)}function getRatePerRoomOccupancy(e,t,i,n){var a=0;switch(e){case 1:a=i["single_"+n];break;case 2:a=i["double_"+n];break;case 3:a=i["triple_"+n];break;case 4:a=i["quadruple_"+n];break;default:a=i["quadruple_"+n]+(e-4)*i["additional_person_"+n]}return a+t*i["child_"+n]}function timSelectPaymentGateway(t,e){var i={action:"load_payment_form",f_nonce:timData.f_nonce,option:t,lang:e};timShowSpinner("tim_travel_form_spinner");var n=document.getElementById("timPaymentBox");n.innerHTML="",timPostAjax(timData.ajaxurl,i,function(e){n.innerHTML=e,"bac_ecommerce"===t?document.getElementById("ccnumber").focus():"paypal"===t&&loadPaypalPayment(),document.querySelector(".tim-policies").style.display="inline-block",timHideSpinner("tim_travel_form_spinner")})}function timProcessBacEcommercePayment(){setButton();var e=0;if(e=validateCreditCardExpirationDate("expDate",e=validateInput("cvv",e=validateCreditCardNumber("ccnumber",e=timValidateClientDetails()))),e=validateInput("ccName",e))return setButton(1),!1;var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bac&id="+document.getElementById("timBookingId").value+"&name="+document.getElementById("timGuestName").value+"&last_name="+document.getElementById("timGuestLastName").value+"&email="+document.getElementById("timGuestEmail").value+"&country_id="+document.getElementById("timGuestCountry").value.split("-")[0]+"&phone_number="+document.getElementById("timGuestPhoneNumber").value+"&phone_code="+document.getElementById("timGuestPhoneCode").value+"&tax_id_code="+document.getElementById("timGuestTaxIdCode").value+"&tax_id_number="+document.getElementById("timGuestTaxIdNumber").value+"&notes="+document.getElementById("timNotes").value+"&lng="+document.getElementById("timCL").value+"&ccType="+document.getElementById("ccType").value+"&ccName="+document.getElementById("ccName").value,i=document.getElementById("timClientId").value;i&&(t+="&client_id="+i),timShowSpinner("tim_spinner"),document.getElementById("redirect").value=t;var n=document.getElementById("tim_checkout_form");n.action=document.getElementById("bac_endpoint").value,n.submit()}function timProcessBcrEcommercePayment(){if(setButton(),timValidateClientDetails())return setButton(1),!1;var e=document.getElementById("timPaymentGateway").value+"_"+document.getElementById("timCurrencyCode").value.toLowerCase(),t={action:"process_bcr_ecommerce_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:document.getElementById("timCL").value,payment_gateway:e,pg:"bcr"},i=document.getElementById("timClientId").value;i&&(t.client_id=i),timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){var t=document.getElementById("timHomeUrl").value+"order/?act=paid&pg=bcr";document.getElementById("redirect").value=t;var i=document.getElementById("tim_checkout_form");i.action=document.getElementById("bcr_endpoint").value,i.submit()})}function timProcessPayLaterPayment(){if(setButton(),timValidateClientDetails())return setButton(1),!1;var i=document.getElementById("timCL").value,e={action:"process_pay_later_payment",f_nonce:timData.f_nonce,id:document.getElementById("timBookingId").value,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:i,payment_gateway:document.getElementById("timPaymentGateway").value},t=document.getElementById("timClientId").value;t&&(e.client_id=t);var n=document.getElementById("timCustomerBookingFormErrorMsg");n.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,e,function(e){if("false"==e)return!1;if(timHideSpinner("tim_spinner"),(e=JSON.parse(e)).errors)setButton(1),n.innerHTML='<div class="tim_alert tim_alert_danger">'+e.errors+"</div><br />";else{var t=document.getElementById("timHomeUrl").value+"order/";window.location=t+"?act=done&oid="+e.id+"&onm="+e.booking_number+"&lng="+i}})}function loadPaypalPayment(){var i=document.getElementById("timCL").value,e=(function(){switch(i){case"es":0;break;case"de":0;break;default:0}}(),document.getElementById("timApiUrl").value),n=document.getElementById("timBookingId").value,a=document.getElementById("timSubdomain").value,o=document.getElementById("timCompanyApiKey").value,r=document.getElementById("timDomainApiKey").value,t=e+"/create_paypal_payment",m=e+"/execute_paypal_payment",l=document.getElementById("timPaymentGateway").value,d=document.getElementById("timCustomerBookingFormErrorMsg");function u(e){var t,i,n,a,o=!0;return document.getElementById("timGuestName").value&&document.getElementById("timGuestLastName").value&&(n=!0,(a=document.getElementById("timGuestEmail").value)&&/^[A-Za-z][A-Za-z0-9_.]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/.test(a)||(n=!1),n)&&(t=!0,(i=document.getElementById("timGuestPhoneNumber").value)&&/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g.test(i)||(t=!1),t)&&document.getElementById("timGuestCountry").value&&document.getElementById("timGuestTaxIdCode").value&&document.getElementById("timGuestTaxIdNumber").value||(o=!1),o?e.enable():e.disable()}d.innerHTML="";var s=document.getElementById("timClientId").value;paypal.Buttons({style:{size:"medium",color:"blue",shape:"pill",label:"checkout"},validate:function(e){var t;if(document.getElementById("timIsClientLogged").value)return e.enable();u(e),t=function(){u(e)},jQuery("#timGuestName").on("change",t),jQuery("#timGuestLastName").on("change",t),jQuery("#timGuestEmail").on("change",t),jQuery("#timGuestPhoneNumber").on("change",t),jQuery("#timGuestCountry").on("change",t),jQuery("#timGuestTaxIdCode").on("change",t),jQuery("#timGuestTaxIdNumber").on("change",t)},onClick:function(){return setButton(),!timValidateClientDetails(0)||(setButton(1),!1)},createOrder:function(){var e={sub:a,cak:o,dak:r,id:n,payment_gateway:l,email:document.getElementById("timGuestEmail").value,lang:i};return s&&(e.client_id=s),fetch(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return e.id})},onApprove:function(e){var t={orderID:e.orderID,sub:a,cak:o,dak:r,id:n,payment_gateway:l,name:document.getElementById("timGuestName").value,last_name:document.getElementById("timGuestLastName").value,email:document.getElementById("timGuestEmail").value,country_id:document.getElementById("timGuestCountry").value.split("-")[0],phone_number:document.getElementById("timGuestPhoneNumber").value,phone_code:document.getElementById("timGuestPhoneCode").value,tax_id_code:document.getElementById("timGuestTaxIdCode").value,tax_id_number:document.getElementById("timGuestTaxIdNumber").value,notes:document.getElementById("timNotes").value,lang:i};return s&&(t.client_id=s),timShowSpinner("tim_spinner"),fetch(m,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(t){if(t.errors)return timHideSpinner("tim_spinner"),d.innerHTML='<div class="tim_alert tim_alert_danger">'+t.errors+"</div><br />",void(t.emailInUse&&document.getElementById("timGuestEmail").classList.add("tim_error_input"));var e={action:"paypal_order_completed",f_nonce:timData.f_nonce,bookingItemData:t};document.getElementById("tim_checkout_form").reset(),timPostAjax(timData.ajaxurl,e,function(){timHideSpinner("tim_spinner");var e=document.getElementById("timHomeUrl").value+"order/";window.location=e+"?act=done&oid="+t.id+"&onm="+t.booking_number+"&lng="+i})})}}).render("#paypal-button")}function timValidateClientDetails(e){return document.getElementById("timIsClientLogged").value||(e=validateInput("timGuestName",e),e=validateInput("timGuestLastName",e),e=validateInput("timGuestCountry",e),e=validateTaxIdNumber("timGuestTaxIdNumber",e=validateInput("timGuestTaxIdCode",e=validateEmail("timGuestEmail",e=validatePhone("timGuestPhoneNumber",e))))),e}function validateCreditCardNumber(e,t){var i=document.getElementById(e);i.classList.remove("tim_error_input"),document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove();var n=0;if(""==i.value)n=1;else{var a="";i.value.match(/^(?:4[0-9]{12}(?:[0-9]{3})?)$/)?a="Visa":i.value.match(/^(?:5[1-5][0-9]{14})$/)?a="Mastercad":i.value.match(/^(?:3[47][0-9]{13})$/)?a="American Express":i.value.match(/^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/)?a="Discover":i.value.match(/^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/)?a="Dinersclub":i.value.match(/^(?:(?:2131|1800|35\d{3})\d{11})$/)?a="Jcb":n=1}return n?(i.classList.add("tim_error_input"),1):(document.getElementById("ccType").value=a,t)}function validateCreditCardExpirationDate(e,t){var i=document.getElementById("expMonth"),n=document.getElementById("expYear");i.classList.remove("tim_error_input"),n.classList.remove("tim_error_input");var a=(new Date).getDate(),o=i.value+"/"+a+"/"+n.value,r=setCurrentDate();if(document.getElementById(e+"Err")&&document.getElementById(e+"Err").remove(),Date.parse(r)>Date.parse(o))return i.classList.add("tim_error_input"),n.classList.add("tim_error_input"),1;var m=i.value+n.value.substr(-2);return document.getElementById("ccexp").value=m,t}function setCurrentDate(){var e=new Date,t=e.getDate();t<10&&(t="0"+t);var i=e.getMonth()+1;return i<10&&(i="0"+i),i+"/"+t+"/"+e.getFullYear()}function timApplyDiscountCoupon(){var i=document.getElementById("timApplyCodeBtn");i.disable=!0;var e=0;if(e=validateInput("timCouponCode",e))return i.disable=!1;var t={action:"apply_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,coupon_code:document.getElementById("timCouponCode").value,lang:document.getElementById("timCL").value},n=document.getElementById("timCouponCodeInvalid");n.innerHTML="",timShowSpinner("tim_spinner"),timPostAjax(timData.ajaxurl,t,function(e){if(timHideSpinner("tim_spinner"),"error"!==e)document.getElementById("timCheckoutTotals").innerHTML=e;else{i.disable=!1;var t=document.getElementById("timLabelErrorCoupon").value;n.innerHTML='<div class="tim_error_input_msg">'+t+"</div>"}})}function timDeleteDiscountCoupon(){var e={action:"delete_discount_coupon_to_order_api",f_nonce:timData.f_nonce,booking_id:document.getElementById("timBookingId").value,lang:document.getElementById("timCL").value};timPostAjax(timData.ajaxurl,e,function(e){"error"!==e&&(document.getElementById("timCheckoutTotals").innerHTML=e)})}!function(i){i(function(){i("a.tim_fancybox").length&&i("a.tim_fancybox").fancybox(),i('.tim_list_search_filter_form select[name="sort"]').change(function(){"all"!==i(this).val()&&i(".tim_list_search_filter_form").submit()}),i(".tim-currency-value").click(function(){var e=i(this).attr("id"),t={action:"set_currency_value",f_nonce:timData.f_nonce,currency:e};i.post(timData.ajaxurl,t,function(e){location.reload()})}),i("#tim-tab-map").click(function(e){setTimeout(timInitializeMap,1e3)}),i(".tim-tabs .tim-tabs-links a").on("click",function(e){var t=i(this).attr("href");i(".tim-tabs "+t).show().siblings().hide(),i(this).parent("li").addClass("active").siblings().removeClass("active"),e.preventDefault()}),i(".swipper.tim-tabs-links a").click(function(){timLoadSwiper()})})}(jQuery);var TIM_TIMEOUT_WARNING_ID,TIM_TIMEOUT_NOW_ID,isTimerWarningModalOpened=!1;function timSetBookingTimers(){0!=parseInt(document.getElementById("timBTI").value)&&(document.addEventListener("mousemove",timResetTimer,!1),document.addEventListener("mousedown",timResetTimer,!1),document.addEventListener("keypress",timResetTimer,!1),document.addEventListener("touchmove",timResetTimer,!1),document.addEventListener("onscroll",timResetTimer,!1),timStartBookingTimer())}function timStartBookingTimer(){var e=document.getElementById("timTO").value;isTimerWarningModalOpened=!1,TIM_TIMEOUT_WARNING_ID=setTimeout("timExecuteTimeOutWarning()",60*e*1e3)}function timResetTimer(){isTimerWarningModalOpened||(timClearTimers(),timStartBookingTimer())}function timClearTimers(){clearTimeout(TIM_TIMEOUT_WARNING_ID),clearTimeout(TIM_TIMEOUT_NOW_ID)}function timExecuteTimeOutWarning(){var e=document.getElementById("timBID").value;clearTimeout(TIM_TIMEOUT_WARNING_ID),TIM_TIMEOUT_NOW_ID=setTimeout("timExecuteTimeOutNow('"+e+"')",6e4),document.createElement("div").id="booking-inactivity";var t={action:"open_modal",f_nonce:timData.f_nonce,option:"booking-inactivity",id:e};timPostAjax(timData.ajaxurl,t,function(e){openModal(e,{autoSize:!0,preventCloseOutside:!0,hideCloseBtn:!0})}),isTimerWarningModalOpened=!0}function timExecuteTimeOutNow(e){timCancelBooking(e,!0)}function timContinueWithBooking(e){jQuery.fancybox.close("booking-inactivity"),timClearTimers(),timSetBookingTimers(e)}function timCancelBooking(e,t){var i={action:"delete_booking_api",f_nonce:timData.f_nonce,bookingId:e,lang:document.getElementById("timCL").value};t&&(i.deletedBySystem=!0),jQuery.post(timData.ajaxurl,i,function(e){if("false"==e)return!1;timClearTimers(),jQuery.fancybox.close("booking-inactivity"),window.location=document.getElementById("timHomeUrl").value})}